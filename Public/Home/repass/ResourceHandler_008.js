$(function(){var userInfo={},consignee={},password={},invoice={},boxes={},bindbox=function(obj,bindto){if(bindto.length>0){}},msgbox=function(options){var defaults={msg:"",prevstr:"",bindto:"",type:""};$.extend(defaults,options);var wrapper,obj,parent;if(defaults.prevstr&&defaults.bindto){parent=$(defaults.bindto).closest("dd");parent.find("[altype='errorbox']").hide();if(!boxes[defaults.prevstr]){wrapper=$('<p altype="errorbox"></p>').html("<i></i><em><b></b></em>").addClass("clr");parent.append(wrapper);obj=boxes[defaults.prevstr]=wrapper}else{obj=boxes[defaults.prevstr]}if(defaults.type=="error"){parent.addClass("error");obj.find("i").show();obj.find("em").empty().append("<b></b>"+defaults.msg);obj.show();parent.find("i.form_succeed").hide()}else{if(defaults.type=="success"){parent.removeClass("error");obj.find("i").hide();obj.find("em").empty().append("<b></b>"+defaults.msg);obj.hide();if(parent.find("i.form_succeed").length==0){parent.append('<i class="form_succeed">&nbsp;</i>')}else{parent.find("i.form_succeed").show()}}else{if(obj.find("em").has("b")){parent.removeClass("error");parent.find("i.form_succeed").hide();obj.find("i").hide();obj.find("em").empty().append("<b></b>"+defaults.msg);obj.show()}}}}},msgboxhide=function(prevstr){boxes[prevstr]&&boxes[prevstr].hide()},valid=SP.plug.valid;userInfo.group=SP.plug.formcheck.group("userinfo");consignee.group=SP.plug.formcheck.group("consignee");password.group=SP.plug.formcheck.group("password");invoice.group=SP.plug.formcheck.group("invoice");if($("#info_username").length>0){$("#info_username").bind("focus",function(){msgbox({msg:"此项为必填项，方便我们与您联系",prevstr:"usernameMsg",bindto:$("#info_username"),type:"normal"})});userInfo.username=userInfo.group.add({elem:"#info_username",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写您的真实姓名");return}else{if(val.length<2){this.reject("姓名不得少于2个字");return}else{if(val.length>20){this.reject("姓名不得超过20个字");return}else{if(!charValid(val,"ChsAndEnChar")){this.reject("真实姓名包含非法字符");return}}}}this.resolve("用户名填写正确")},done:function(){msgbox({msg:"此项为必填项，方便我们与您联系",prevstr:"usernameMsg",bindto:$("#info_username"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"usernameMsg",bindto:$("#info_username"),type:"error"})}})}if($("#info_mobile").length>0){userInfo.mobile=userInfo.group.add({elem:"#info_mobile",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写手机号码");return}else{if(!valid(val,"mobile")){this.reject("请输入正确联系方式！");return}}this.resolve("手机号码填写正确")},done:function(){msgbox({msg:"",prevstr:"mobileMsg",bindto:$("#info_mobile"),type:"success"});$("#mobilearea dd div").show()},fail:function(){msgbox({msg:this.message,prevstr:"mobileMsg",bindto:$("#info_mobile"),type:"error"});$("#mobilearea dd div").hide()}})}if($("#info_email").length>0){userInfo.email=userInfo.group.add({elem:"#info_email",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写邮箱地址");return}else{if(!valid(val,"email")){this.reject("邮箱地址有误，请重新输入");return}}this.resolve("邮箱地址填写正确")},done:function(){msgbox({msg:"",prevstr:"emailMsg",bindto:$("#info_email"),type:"success"});$("#emailarea dd div").show()},fail:function(){msgbox({msg:this.message,prevstr:"emailMsg",bindto:$("#info_email"),type:"error"});$("#emailarea dd div").hide()}})}if($("#info_code").length>0){userInfo.code=userInfo.group.add({elem:"#info_code",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.resolve("邮政编码填写正确");return}if(val!=""){if(!valid(val,"postcode")){this.reject("邮政编码有误，请重新输入");return}}this.resolve("邮政编码填写正确")},done:function(){msgbox({msg:"",prevstr:"codeMsg",bindto:$("#info_code"),type:"success"});if($("#info_code").val().length==0){$("#info_code").parent().siblings(".form_succeed").remove()}$("#codearea dd div").show()},fail:function(){msgbox({msg:this.message,prevstr:"codeMsg",bindto:$("#info_code"),type:"error"});$("#codearea dd div").hide()}})}if($("#info_phone").length>0){userInfo.phone=userInfo.group.add({elem:"#info_phone",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val.length!=0){if(!valid(val,"phone")){this.reject("请输入正确联系方式！");return}else{if(!valid(val,"phone")){this.reject("请输入正确联系方式！");return}}}this.resolve("固定电话填写正确")},done:function(){msgbox({msg:"",prevstr:"phoneMsg",bindto:$("#info_phone"),type:"success"});if($("#info_phone").val().length==0){$("#info_phone").parent().siblings(".form_succeed").remove()}},fail:function(){msgbox({msg:this.message,prevstr:"phoneMsg",bindto:$("#info_phone"),type:"error"})}})}if($("#info_submit").length>0){$("#info_submit").bind("click",function(){userInfo.group.submit(function(){InfomationSubmit()})}).hover(function(){userInfo.group.preventAll()},function(){userInfo.group.promiseAll()});$("#info_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();userInfo.group.submit(function(){InfomationSubmit()})}})}if($("#consnee_name").length>0){consignee.consneename=consignee.group.add({elem:"#consnee_name",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人姓名");return}else{if(val.length>20){this.reject("收货人姓名不得超过20个字");return}else{if(val.length<2){this.reject("收货人姓名不能小于2个字");return}else{if(!charValid(val,"ChsAndEnChar")){this.reject("真实姓名包含非法字符");return}}}}this.resolve("收货人姓名填写正确")},done:function(){msgbox({msg:"",prevstr:"consnee_nameMsg",bindto:$("#consnee_name"),type:"success"});$("#consnee_nameBox dd div").hide()},fail:function(){msgbox({msg:this.message,prevstr:"consnee_nameMsg",bindto:$("#consnee_name"),type:"error"});$("#consnee_nameBox dd div").hide()}})}if($(".consignee_Addr select").length>0){consignee.city=consignee.group.add({elem:"#ProvinceId,#CityId,#AreaId,#TownId",event:"change",value:function(){var $dom=$(".consignee_Addr select"),ret=-1,val;for(var i=0,len=$dom.length;i<len;i++){val=$($dom[i]).val();if(val==-1){return -1}ret=val}return ret},check:function(){this.init();var val=this.value(),that=this;if(val<0){this.reject("请选择地区");return}this.resolve("ok")},done:function(){msgbox({msg:"",prevstr:"consignee_city",bindto:$("#TownId"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"consignee_city",bindto:$("#TownId"),type:"error"})}})}if($("#consigneeArea select").length>0){consignee.city=consignee.group.add({elem:"#ProvinceId,#CityId,#AreaId,#TownId",event:"change",value:function(){var $dom=$("#consigneeArea select"),ret=-1,val;for(var i=0,len=$dom.length;i<len;i++){val=$($dom[i]).val();if(val==-1){return -1}ret=val}return ret},check:function(){this.init();var val=this.value(),that=this;if(val<0){this.reject("请选择地区");return}this.resolve("ok")},done:function(){msgbox({msg:"",prevstr:"consignee_city",bindto:$("#TownId"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"consignee_city",bindto:$("#TownId"),type:"error"})}})}if($("#consnee_addr").length>0){consignee.consneeaddr=consignee.group.add({elem:"#consnee_addr",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人地址");return}else{if(val.length<5||val.length>100){this.reject("请输入正确收货地址！");return}}this.resolve("收货人地址填写正确")},done:function(){msgbox({msg:"",prevstr:"consnee_addrMsg",bindto:$("#consnee_addr"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"consnee_addrMsg",bindto:$("#consnee_addr"),type:"error"})}})}if($("#consnee_code").length>0){consignee.consneecode=consignee.group.add({elem:"#consnee_code",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人邮编");return}else{if(!valid(val,"isnumber")){this.reject("收货人邮编有误，请重新输入");return}else{if(val.length!=6){this.reject("请输入6位邮政编码");return}}}this.resolve("收货人邮编填写正确")},done:function(){msgbox({msg:"",prevstr:"consnee_codeMsg",bindto:$("#consnee_code"),type:"success"});$("#consnee_phone1, #consnee_phone3").removeAttr("disabled")},fail:function(){msgbox({msg:this.message,prevstr:"consnee_codeMsg",bindto:$("#consnee_code"),type:"error"})}})}if($("#consnee_mobile").length>0){consignee.consneemobile=consignee.group.add({elem:"#consnee_mobile",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,phone1val=$.trim($("#consnee_phone1").val()),phone2val=$.trim($("#consnee_phone2").val()),phone3val=$.trim($("#consnee_phone3").val());if(val==""&&phone2val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&!valid(val,"mobile")){this.reject("请输入正确联系方式！");return}else{if(phone1val!=""&&!valid(phone1val,"isnumber")){this.reject("请输入正确联系方式！");$("#consnee_phone1").closest("span").removeClass("normal");return}else{if(phone2val!=""&&(!valid(phone2val,"isnumber")||phone1val=="")){this.reject("请输入正确联系方式！");return}else{if(phone3val!=""&&(!valid(phone3val,"isnumber")||phone2val==""||phone1val=="")){this.reject("请输入正确联系方式！");$("#consnee_phone3").closest("span").removeClass("normal");return}}}}}this.resolve("手机号码填写正确")},done:function(){msgbox({msg:"",prevstr:"consnee_mobileMsg",bindto:$("#consnee_mobile"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"consnee_mobileMsg",bindto:$("#consnee_mobile"),type:"error"});$("#consnee_mobile").closest("span").removeClass("normal")}})}if($("#consnee_phone1").length>0){consignee.phone1=consignee.group.add({elem:"#consnee_phone1",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#consnee_mobile").val()),phone2val=$.trim($("#consnee_phone2").val()),phone3val=$.trim($("#consnee_phone3").val());if(mobval==""&&phone2val==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&(!valid(val,"isnumber")||val.length<3)){this.reject("请输入正确联系方式！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone1").closest("span").removeClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#consnee_phone1").closest("span").addClass("normal");return}else{if(phone2val!=""&&(!valid(phone2val,"isnumber")||!valid(phone2val,"phone"))){this.reject("请输入正确联系方式！");$("#consnee_phone2").closest("span").removeClass("normal");$("#consnee_mobile").closest("span").addClass("normal");return}else{if(phone3val!=""&&!valid(phone3val,"isnumber")){this.reject("请输入正确联系方式！");$("#consnee_phone3").closest("span").removeClass("normal");$("#consnee_mobile").closest("span").addClass("normal");return}}}}}this.resolve("区号正确")},done:function(){msgbox({msg:"",prevstr:"consnee_phone1",bindto:$("#consnee_phone1"),type:"success"});if($("#consnee_phone1").val().length==0&&$("#consnee_phone2").val().length==0&&$("#consnee_phone3").val().length==0){$("#consnee_phone1").parent().siblings(".form_succeed").remove()}$("#consnee_mobile,#consnee_phone1,#consnee_phone2,#consnee_phone3").closest("span").addClass("normal")},fail:function(){msgbox({msg:this.message,prevstr:"consnee_phone1",bindto:$("#consnee_phone1"),type:"error"})}})}if($("#consnee_phone2").length>0){consignee.phone2=consignee.group.add({elem:"#consnee_phone2",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#consnee_mobile").val()),phone1val=$.trim($("#consnee_phone1").val()),phone3val=$.trim($("#consnee_phone3").val());if(mobval==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&phone1val==""){this.reject("请输入区号！");$("#consnee_phone2").closest("span").removeClass("normal");$("#consnee_mobile").closest("span").addClass("normal");return}else{if(val!=""&&(!valid(val,"isnumber")||!valid(val,"phone"))){this.reject("请输入正确联系方式！");$("#consnee_phone2").closest("span").removeClass("normal");$("#consnee_mobile").closest("span").addClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#consnee_phone2").closest("span").addClass("normal");return}else{if(phone1val!=""&&(!valid(phone1val,"isnumber")||phone1val.length<3)){this.reject("请输入正确联系方式！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone1").closest("span").removeClass("normal");return}else{if(phone3val!=""&&!valid(phone3val,"isnumber")){this.reject("请输入正确联系方式！");$("#consnee_phone3").closest("span").removeClass("normal");$("#consnee_mobile").closest("span").addClass("normal");return}}}}}}this.resolve("电话号码正确")},done:function(){msgbox({msg:"",prevstr:"consnee_phone2",bindto:$("#consnee_phone2"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"consnee_phone2",bindto:$("#consnee_phone2"),type:"error"});$("#consnee_phone2").closest("span").removeClass("normal")}})}if($("#consnee_phone3").length>0){consignee.phone3=consignee.group.add({elem:"#consnee_phone3",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#consnee_mobile").val()),phone1val=$.trim($("#consnee_phone1").val()),phone2val=$.trim($("#consnee_phone2").val());if(mobval==""&&phone2val==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&(phone1val==""||phone2val=="")){this.reject("请输入区号及电话号码！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone1").closest("span").removeClass("normal");$("#consnee_phone2").closest("span").removeClass("normal");return}else{if(val!=""&&!valid(val,"isnumber")){this.reject("请输入正确联系方式！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone3").closest("span").removeClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#consnee_phone3").closest("span").addClass("normal");return}else{if(phone1val!=""&&(!valid(phone1val,"isnumber")||phone1val.length<3)){this.reject("请输入正确联系方式！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone1").closest("span").removeClass("normal");return}else{if(phone2val!=""&&(!valid(phone2val,"isnumber")||!valid(phone2val,"phone")||phone1val=="")){this.reject("请输入正确联系方式！");$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone2").closest("span").removeClass("normal");return}}}}}}this.resolve("分机号正确")},done:function(){msgbox({msg:"",prevstr:"consnee_phone3",bindto:$("#consnee_phone3"),type:"success"});$("#consnee_mobile,#consnee_phone1,#consnee_phone2,#consnee_phone3").closest("span").addClass("normal")},fail:function(){msgbox({msg:this.message,prevstr:"consnee_phone3",bindto:$("#consnee_phone3"),type:"error"})}})}if($("#consnee_submit").length>0){$("#consnee_submit").bind("click",function(){consignee.group.submit(function(){$("#consnee_submit").siblings("i.form_succeed").show();insAddr()})}).hover(function(){consignee.group.preventAll()},function(){consignee.group.promiseAll()});$("#consnee_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();consignee.group.submit(function(){$("#consnee_submit").siblings("i.form_succeed").show();insAddr()})}})}if($("#consnee_save_submit").length>0){$("#consnee_save_submit").bind("click",function(){consignee.group.submit(function(){updAddr()})}).hover(function(){consignee.group.preventAll()},function(){consignee.group.promiseAll()});$("#consnee_save_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();consignee.group.submit(function(){updAddr()})}})}if($("#consnee_account_submit").length>0){$("#consnee_account_submit").bind("click",function(){consignee.group.submit(function(){$("#consnee_account_submit").attr("disabled",true);SaveConsignee();$("#consnee_account_submit").attr("disabled",false)})}).hover(function(){consignee.group.preventAll()},function(){consignee.group.promiseAll()});$("#consnee_account_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();consignee.group.submit(function(){$("#consnee_account_submit").attr("disabled",true);SaveConsignee();$("#consnee_account_submit").attr("disabled",false)})}})}if($("#invoice_name").length>0){invoice.invoicename=invoice.group.add({elem:"#invoice_name",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人姓名");return}else{if(val.length>20){this.reject("收货人姓名不得超过20个字");return}}this.resolve("收货人姓名填写正确")},done:function(){msgbox({msg:"",prevstr:"invoice_nameMsg",bindto:$("#invoice_name"),type:"success"});$("#invoice_nameBox dd div").hide()},fail:function(){msgbox({msg:this.message,prevstr:"invoice_nameMsg",bindto:$("#invoice_name"),type:"error"});$("#invoice_nameBox dd div").hide()}})}if($("#invoice_addr").length>0){invoice.invoiceaddr=invoice.group.add({elem:"#invoice_addr",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人地址");return}else{if(val.length<5||val.length>100){this.reject("请输入正确收货地址！");return}}this.resolve("收货人地址填写正确")},done:function(){msgbox({msg:"",prevstr:"invoice_addrMsg",bindto:$("#invoice_addr"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"invoice_addrMsg",bindto:$("#invoice_addr"),type:"error"})}})}if($(".invoice_Addr_new select").length>0){invoice.city=invoice.group.add({elem:"#fpProvinceId,#fpCityId,#fpAreaId,#fpTownId",event:"change",value:function(){var $dom=$(".invoice_Addr_new select"),ret=-1,val;for(var i=0,len=$dom.length;i<len;i++){val=$($dom[i]).val();if(val==-1){return -1}ret=val}return ret},check:function(){this.init();var val=this.value(),that=this;if(val<0){this.reject("请选择地区");return}this.resolve("ok")},done:function(){msgbox({msg:"",prevstr:"invoice_city",bindto:$("#fpTownId"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"invoice_city",bindto:$("#fpTownId"),type:"error"})}})}if($("#invoice_code").length>0){invoice.invoicecode=invoice.group.add({elem:"#invoice_code",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("请填写收货人邮编");return}else{if(!valid(val,"isnumber")){this.reject("收货人邮编有误，请重新输入");return}else{if(val.length!=6){this.reject("请输入6位邮政编码");return}}}this.resolve("收货人邮编填写正确")},done:function(){msgbox({msg:"",prevstr:"invoice_codeMsg",bindto:$("#invoice_code"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"invoice_codeMsg",bindto:$("#invoice_code"),type:"error"})}})}if($("#invoice_mobile").length>0){invoice.invoicemobile=invoice.group.add({elem:"#invoice_mobile",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,phone1val=$.trim($("#invoice_phone1").val()),phone2val=$.trim($("#invoice_phone2").val()),phone3val=$.trim($("#invoice_phone3").val());if(val==""&&phone2val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&!valid(val,"mobile")){this.reject("请输入正确联系方式！");return}else{if(phone1val!=""&&!valid(phone1val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone1").closest("span").removeClass("normal");return}else{if(phone2val!=""&&!valid(phone2val,"isnumber")){this.reject("请输入正确联系方式！");return}else{if(phone3val!=""&&!valid(phone3val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone3").closest("span").removeClass("normal");return}}}}}this.resolve("手机号码填写正确")},done:function(){msgbox({msg:"",prevstr:"invoice_mobileMsg",bindto:$("#invoice_mobile"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"invoice_mobileMsg",bindto:$("#invoice_mobile"),type:"error"});$("#invoice_mobile").closest("span").removeClass("normal")}})}if($("#invoice_phone1").length>0){invoice.phone1=invoice.group.add({elem:"#invoice_phone1",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#invoice_mobile").val()),phone2val=$.trim($("#invoice_phone2").val()),phone3val=$.trim($("#invoice_phone3").val());if(mobval==""&&phone2val==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&!valid(val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone1").closest("span").removeClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#invoice_phone1").closest("span").addClass("normal");return}else{if(phone2val!=""&&!valid(phone2val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone2").closest("span").removeClass("normal");$("#invoice_mobile").closest("span").addClass("normal");return}else{if(phone3val!=""&&!valid(phone3val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone3").closest("span").removeClass("normal");$("#invoice_mobile").closest("span").addClass("normal");return}}}}}this.resolve("区号正确")},done:function(){msgbox({msg:"",prevstr:"invoice_phone1",bindto:$("#invoice_phone1"),type:"success"});$("#invoice_mobile,#invoice_phone1,#invoice_phone2,#invoice_phone3").closest("span").addClass("normal")},fail:function(){msgbox({msg:this.message,prevstr:"invoice_phone1",bindto:$("#invoice_phone1"),type:"error"})}})}if($("#invoice_phone2").length>0){invoice.phone2=invoice.group.add({elem:"#invoice_phone2",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#invoice_mobile").val()),phone1val=$.trim($("#invoice_phone1").val()),phone3val=$.trim($("#invoice_phone3").val());if(mobval==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&phone1val==""){this.reject("请输入区号！");$("#invoice_phone1").closest("span").removeClass("normal");$("#invoice_mobile").closest("span").addClass("normal");return}else{if(val!=""&&!valid(val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone2").closest("span").removeClass("normal");$("#invoice_mobile").closest("span").addClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#invoice_phone2").closest("span").addClass("normal");return}else{if(phone1val!=""&&(!valid(phone1val,"isnumber")&&phone1val.length<3)){this.reject("请输入正确联系方式！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone1").closest("span").removeClass("normal");return}else{if(phone3val!=""&&!valid(phone3val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_phone3").closest("span").removeClass("normal");$("#invoice_mobile").closest("span").addClass("normal");return}}}}}}this.resolve("电话号码正确")},done:function(){msgbox({msg:"",prevstr:"invoice_phone2",bindto:$("#invoice_phone2"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"invoice_phone2",bindto:$("#invoice_phone2"),type:"error"});$("#invoice_phone2").closest("span").removeClass("normal")}})}if($("#invoice_phone3").length>0){invoice.phone3=invoice.group.add({elem:"#invoice_phone3",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this,mobval=$.trim($("#invoice_mobile").val()),phone1val=$.trim($("#invoice_phone1").val()),phone2val=$.trim($("#invoice_phone2").val());if(mobval==""&&phone2val==""&&val==""){this.reject("固话、手机至少填写一项");return}else{if(val!=""&&(phone1val==""||phone2val=="")){this.reject("请输入区号及电话号码！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone1").closest("span").removeClass("normal");$("#invoice_phone2").closest("span").removeClass("normal");return}else{if(val!=""&&!valid(val,"isnumber")){this.reject("请输入正确联系方式！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone3").closest("span").removeClass("normal");return}else{if(mobval!=""&&!valid(mobval,"mobile")){this.reject("请输入正确联系方式！");$("#invoice_phone3").closest("span").addClass("normal");return}else{if(phone1val!=""&&(!valid(phone1val,"isnumber")||phone1val.length<3)){this.reject("请输入正确联系方式！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone1").closest("span").removeClass("normal");return}else{if(phone2val!=""&&(!valid(phone2val,"isnumber")||!valid(phone2val,"phone")||phone1val=="")){this.reject("请输入正确联系方式！");$("#invoice_mobile").closest("span").addClass("normal");$("#invoice_phone2").closest("span").removeClass("normal");return}}}}}}this.resolve("分机号正确")},done:function(){msgbox({msg:"",prevstr:"invoice_phone3",bindto:$("#invoice_phone3"),type:"success"});$("#invoice_mobile,#invoice_phone1,#invoice_phone2,#invoice_phone3").closest("span").addClass("normal")},fail:function(){msgbox({msg:this.message,prevstr:"invoice_phone3",bindto:$("#invoice_phone3"),type:"error"})}})}if($("#invoice_submit").length>0){$("#invoice_submit").bind("click",function(){invoice.group.submit(function(){insInvoiceAddr()})}).hover(function(){invoice.group.preventAll()},function(){invoice.group.promiseAll()});$("#invoice_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();invoice.group.submit(function(){insInvoiceAddr()})}})}if($("#invoice_save_submit").length>0){$("#invoice_save_submit").bind("click",function(){invoice.group.submit(function(){updInvoiceAddr()})}).hover(function(){invoice.group.preventAll()},function(){invoice.group.promiseAll()});$("#invoice_save_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();invoice.group.submit(function(){updInvoiceAddr()})}})}var autoLocation=function(ele,count){window.setTimeout(function(){count--;if(count>0){$(ele).find("i").html(count);autoLocation(ele,count)}else{location.href="/login"}},1000)};if($(".autoLocation").length>0){autoLocation(".autoLocation","5")}if($("#oldpsd").length>0){$("#oldpsd").bind("focus",function(){msgbox({msg:"密码由6-20位字符组成",prevstr:"oldpsdMsg",bindto:$("#oldpsd"),type:"normal"})});password.oldpsd=password.group.add({elem:"#oldpsd",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("密码不能为空");return}else{if(val.length<6||val.length>20){this.reject("密码由6-20位字符组成");return}}var res=CheckPassword(val);if(res){var json=eval("("+res.responseText+")").UserData;if(json.Success!="1"){this.reject("原密码错误");return}}this.resolve("密码填写正确")},done:function(){msgbox({msg:"密码由6-20位字符组成",prevstr:"oldpsdMsg",bindto:$("#oldpsd"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"oldpsdMsg",bindto:$("#oldpsd"),type:"error"})}})}if($("#newpsd").length>0){$("#newpsd").bind("focus",function(){msgbox({msg:"密码由6-20位字符组成",prevstr:"newpsdMsg",bindto:$("#newpsd"),type:"normal"})});password.newpsd=password.group.add({elem:"#newpsd",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("密码不能为空");return}else{if(val.length<6||val.length>20){this.reject("密码由6-20位字符组成");return}}this.resolve("密码填写正确")},done:function(){msgbox({msg:"密码由6-20位字符组成",prevstr:"newpsdMsg",bindto:$("#newpsd"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"newpsdMsg",bindto:$("#newpsd"),type:"error"})}})}if($("#reppsd").length>0){password.reppsd=password.group.add({elem:"#reppsd",event:"blur",check:function(){this.init();var val=$.trim(this.value()),that=this;if(val==""){this.reject("密码不能为空");return}else{if(val.length<6||val.length>20){this.reject("密码由6-20位字符组成");return}else{if(val!=$("#newpsd").val()){this.reject("两次输入的密码不一致");return}}}this.resolve("密码填写正确")},done:function(){msgbox({msg:"",prevstr:"reppsdMsg",bindto:$("#reppsd"),type:"success"})},fail:function(){msgbox({msg:this.message,prevstr:"reppsdMsg",bindto:$("#reppsd"),type:"error"})}})}var ResetPwd=function(){var serverUrl=$("#formchangepwd").attr("action");$.ajax({type:"POST",url:serverUrl,data:$("#formchangepwd").serialize(),timeout:12000,error:function(xmlHttpRequest,error){password.reppsd.reject(error)},success:function(data){if(!data.UserData.Success){if(data.UserData.ErrCode=="a0e4572c"){password.newpsd.reject(error);return false}password.reppsd.reject(data.UserData.Message);return false}window.location.href="/login/changepwdsuccess"},dataType:"JSON"})};if($("#spGetpwd_sb").length>0){$("#spGetpwd_sb").bind("click",function(){password.group.submit(function(){ResetPwd()})}).hover(function(){password.group.preventAll()},function(){password.group.promiseAll()});$("#newpsd,#reppsd,#spGetpwd_sb").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();password.group.submit(function(){ResetPwd()})}});$("#consnee_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();password.group.submit(function(){var serverUrl=$("#formchangepwd").attr("action");$.ajax({type:"POST",url:serverUrl,data:$("#formchangepwd").serialize(),timeout:12000,error:function(xmlHttpRequest,error){password.reppsd.reject(error)},success:function(data){if(!data.UserData.Success){if(data.UserData.ErrCode=="a0e4572c"){password.newpsd.reject(error);return false}password.reppsd.reject(data.UserData.Message);return false}window.location.href=""},dataType:"JSON"})})}})}if($("#passwordAccount_submit").length>0){$("#passwordAccount_submit").bind("click",function(){password.group.submit(function(){SubmitChangePasswordForm()})}).hover(function(){password.group.preventAll()},function(){password.group.promiseAll()});$("#passwordAccount_submit").bind("keypress",function(e){if(e.keyCode==13){e.preventDefault();password.group.submit(function(){SubmitChangePasswordForm()})}})}function TearoomRoom(year,month,day,startYear,endYear){if(null==startYear){startYear="1900"}if(null==endYear){endYear=new Date().getFullYear()}for(;endYear>=startYear;endYear--){$("#"+year).append("<option value="+endYear+">"+endYear+"</option>")}for(var i=1;i<=12;i++){$("#"+month).append("<option value="+i+">"+i+"</option>")}if(null!=day){$(function(){$("#"+year).change(function(){displaySelectDay($("#"+year).val(),$("#"+month).val(),day)});$("#"+month).change(function(){displaySelectDay($("#"+year).val(),$("#"+month).val(),day)})});displaySelectDay($("#"+year).val(),$("#"+month).val(),day)}}function isLeapYear(year){if((year%4==0&&year%100!=0)||(year%400==0)){return true}return false}function displaySelectDay(year,month,selectDayId){if(null!=year&&null!=month&&!isNaN(year)&&!isNaN(month)){var monthArr=[31,28,31,30,31,30,31,31,30,31,30,31];var day=(isLeapYear(year)&&month==2)?monthArr[month-1]+1:monthArr[month-1];$("#"+selectDayId+">option").remove();$("#"+selectDayId).append("<option value='0'>请选择</option>");for(var i=1;i<=day;i++){$("#"+selectDayId).append("<option value="+i+">"+i+"</option>")}}}new TearoomRoom("year","month","day","1900",new Date().getFullYear());function SaveConsignee(){var data=$("#ConsigneeAddress").serialize();var url="/account/ConsigneeAddressAdd?"+new Date().getTime();$.ajax({type:"POST",url:url,data:data,timeout:12000,dataType:"json",error:function(xmlHttpRequest,error){},success:function(data){if(data.UserData.Success=="1"){ShowConsigneeSaveSuccess()}else{var errorCode=data.UserData.ErrorCode;if(errorCode=="50447bc0"||errorCode=="263ca896"||errorCode=="c5f0cf64"||errorCode=="6e15a651"){consignee.consneename.reject(data.UserData.Message);return}if(errorCode=="4fdb48a1"||errorCode=="37a06a53"){consignee.consneemobile.reject(data.UserData.Message);return}if(errorCode=="d09f9f95"){consignee.phone1.reject(data.UserData.Message);$("#consnee_mobile").closest("span").addClass("normal");$("#consnee_phone1").closest("span").removeClass("normal");$("#consnee_phone2").closest("span").removeClass("normal");$("#consnee_phone3").closest("span").removeClass("normal");return}if(errorCode=="121d1bf7"||errorCode=="a905893a"){consignee.consneeaddr.reject(data.UserData.Message);return}if(errorCode=="357d50b6"){consignee.consneecode.reject(data.UserData.Message);return}}}})}function InfomationSubmit(){var info_username=$.trim($("#info_username").val());var sex=$("#man").parent().find(":checked").val();var mobile=$.trim($("#info_mobile").val());var email=$.trim($("#info_email").val());var phone=$.trim($("#info_phone").val());var year=$("#year").val();var month=$("#month ").val();var day=$("#day").val();var serverUrl="/account/Information";$.ajax({async:false,type:"post",url:serverUrl+"?ran="+Math.random(),data:$("#accountfrom").serialize(),success:function(msg){var json=eval(msg);if(json.UserData.Success=="1"){$(".body_typebox input").each(function(){if($(this).val()==""){$(this).val("0")}});$(".userInfoSize input").each(function(){if($(this).val()==""){$(this).val("0")}});windowAlert("提示","个人信息修改成功",true)}else{var errorCode=json.UserData.ErrorCode;if(errorCode=="263ca896"||errorCode=="c5f0cf64"||errorCode=="a1793643"){userInfo.username.reject(json.UserData.Message);return false}if(errorCode=="4fdb48a1"){userInfo.mobile.reject(json.UserData.Message);return false}if(errorCode=="d09f9f95"){userInfo.phone.reject(json.UserData.Message);return false}if(errorCode=="d09f9f95"){userInfo.email.reject(json.UserData.Message);return false}windowAlert("提示","个人信息修改失败")}}})}function SubmitChangePasswordForm(){var serverUrl=$("#ChangePassword").attr("action")+"?"+new Date().getTime();$.ajax({type:"POST",url:serverUrl,data:$("#ChangePassword").serialize(),timeout:12000,error:function(xmlHttpRequest,error){},success:function(data){if(data.UserData.Success=="1"){var s='<div id="changePsd_tips" ><p><b class="ac_green">您的密码已经修改成功！</b></p><p><a href="/account/Information" title="" class="ac_gold">[马上去完善]</a>其他个人信息，以便我们为您提供更优质的服务。</p></div>';windowAlert("提示",s,true)}else{if(data.UserData.ErrorCode=="7b2343a9"){password.oldpsd.reject(data.UserData.Message);return}if(data.UserData.ErrorCode=="password"){password.oldpsd.reject(data.UserData.Message);return}if(data.UserData.ErrorCode=="newpassword"){password.newpsd.reject(data.UserData.Message);return}if(data.UserData.ErrorCode=="renewpassword"){password.reppsd.reject(data.UserData.Message);return}if(data.UserData.ErrorCode=="9d1dfdb4"){password.newpsd.reject(data.UserData.Message);return}windowAlert("提示","修改失败")}},dataType:"JSON"})}function CheckPassword(pass){var serverUrl="/account/CheckPassword?"+new Date().getTime();var rtn=false;return $.ajax({type:"POST",url:serverUrl,data:{pass:pass},timeout:12000,dataType:"json",async:false})}function charValid(val,reg){for(var i=0;i<val.length;i++){var item=val.substr(i,1);if(!valid(item,reg)){return false}}return true}});