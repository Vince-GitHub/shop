var bindWindow;var emailcodeurl=$("#NewShangpinLoginDomainUrl").val()+"/login/VerifyLoginHandlerII?type=shangpin_account_bind1&v=";var mobilecodeurl=$("#NewShangpinLoginDomainUrl").val()+"/login/VerifyLoginHandlerII?type=shangpin_account_bind2&v=";function BindEmailContent(b){b=$.trim(b);var a='<div class="titA">验证码已发至邮箱：<span>'+b+'</span><br>请注意查收邮件。</div><div class="step90 clearfix">    <div class="accont clearfix">        <label class="name pd11 pd21">输入验证码：</label>        <div class="click"><input type="text" id=\'mailBindVerCode\' name=\'\' /></div>        <label class="name pd11 pd21">验证码：</label>         <div><input style="height:25px;width:70px;vertical-align:middle;margin-left:4px;" type="text" id="code" name="" /> <img id="spSignin_captchCode" alt="验证码" style="cursor:pointer;vertical-align:middle;padding-right:10px;padding-left:10px"   onclick="changeCaptchCode(\''+emailcodeurl+'\');" src="'+emailcodeurl+Math.random()+'"/><a href="javascript:;" onclick="changeCaptchCode(\''+emailcodeurl+'\')">换一换</a></div>    </div>    <div id="errdiv" style="padding-left:14px;" class="prmA"></div></div><input type="hidden" value="'+b+"\" name=\"mailaddress\" id=\"mailaddress\" /><input type='button'  class='sencondv' id='firstvmail'  />";return a}function BindMobileContent(a){a=$.trim(a);return'<div class="titA">请输入正确手机号，确保收到验证码。</div><div class="step90 clearfix">    <div class="accont clearfix">        <label class="name pd11 pd21">输入手机号：</label>        <div class="click"><input type="text" id="txtMobile" name="txtMobile" value="'+a+'" maxlength=\'11\' /></div>    </div>    <div id="errdiv" class="prmA"></div></div>'}function EditMobileContent(a){a=$.trim(a);return'<div class="email_hTxt"><div class="titA">请输入您的新手机号码：<br>修改后，您可以用新的手机号登录。</div><div class="step90 clearfix titA">    <div class="accont clearfix">        <div class="click"><input type="text" id="txtMobile" name="txtMobile" value="'+a+'"  maxlength=\'11\' /></div>    </div>    <div id="errdiv" class="prmA"></div></div></div>'}function EditEmailContent(a){a=$.trim(a);return'<div class="titA">修改后不会改变您的注册邮箱。</div><div class="step90 clearfix">    <div class="accont clearfix">        <label class="name pd11 pd21">输入邮箱：</label>        <div class="click"><input type="text" id="mailaddress" name="mailaddress" value="'+a+'" /></div>    </div>    <div id="errdiv" class="prmA"></div></div>'}function BindMobileContentNext(b){b=$.trim(b);var a='<div class="titA">验证码已发至手机：<span>'+b+'</span>请注意查看手机短信。 </div><div class="step90 clearfix">    <div class="accont clearfix">        <label class="name pd11 pd21">手机验证码：</label>        <div class="click"><input type="text" id="varcod" name="" /></div>        <label class="name pd11 pd21">&nbsp;验证码：</label>         <div>&nbsp;<input style="height:25px;width:70px;vertical-align:middle;margin-left:4px;" type="text" id="code" name="" /> <img id="spSignin_captchCode" alt="验证码" style="cursor:pointer;vertical-align:middle;padding-right:10px;padding-left:10px"   onclick="changeCaptchCode(\''+mobilecodeurl+'\');" src="'+mobilecodeurl+Math.random()+'"/><a href="javascript:;" onclick="changeCaptchCode(\''+mobilecodeurl+'\')">换一换</a></div>    </div>    <div id="errdiv" class="prmA"></div></div><input type="hidden" value="'+b+"\" name=\"mailaddress\" id=\"mailaddress\" /><div id='sendarea' class='btnB'><input type='button'  class='sencondv' id='firstv' /></div>";return a}function changeCaptchCode(a){$("#spSignin_captchCode").attr("src",a+Math.random())}function BindBottomContent(a){return'<a href="javascript:void(0);"  id="sendit" class="spOrder_window_submit">'+a+'</a><a href="#" class="spOrder_window_delbtn">取消</a>'}function SendVerCode(divid,emailormobileControlName,sendType,isEditOrBind){var email=$.trim($("#"+divid).find("#"+emailormobileControlName).val());$("#"+divid).find("#errdiv").html("&nbsp;");if(sendType==1){if($.trim(email)==""){$("#"+divid).find("#errdiv").html("请填写邮箱");return"0"}else{if(!isValid(email,"email")){$("#"+divid).find("#errdiv").html("邮箱地址不正确");return"0"}}}else{if($.trim(email)==""){$("#"+divid).find("#errdiv").html("请填写手机号码");return"0"}else{if(!isValid(email,"mobile")){$("#"+divid).find("#errdiv").html("手机号码不正确");return"0"}}}email=$.trim(email);var s=$.ajax({async:false,type:"post",url:"/account/SendVerCode?"+new Date().getTime(),data:{MobileNo:email,SendType:sendType},success:function(data){if(data.UserData.Success=="1"){if(sendType==2){ChangeBindMobileWindow(divid,emailormobileControlName)}if(sendType==1){if(isEditOrBind==2){ChangeBindEmailWindow(divid,emailormobileControlName)}else{}}}else{if(isEditOrBind==2){$("#"+divid).find("#errdiv").html(data.UserData.Message)}else{AlreadyBind(data.UserData.Message)}}}});if(s){var json=eval("("+s.responseText+")").UserData}return json.Success}function ChangeBindMobileWindow(a,b){var c=$("#"+a).find("#"+b).val();if(!isValid(c,"mobile")){$("#"+a).find("#errdiv").html("手机号码不正确");return false}if(bindWindow!=null){bindWindow.close(false)}bindWindow=spWindow({id:"window_BindMobile",style:{wrapper:{width:"400px"}},title:"验证手机",content:BindMobileContentNext(c),bottom:BindBottomContent("确认"),closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#window_BindMobile").find("#sendit").bind("click",function(){BindConfirm("window_BindMobile","mailaddress","varcod",2);return false});$("#window_BindMobile").find("#firstv").bind("click",function(){SendVerCode("window_BindMobile","mailaddress",2,1);setRetime("#window_BindMobile #firstv","重新发送验证码",60);return false})}});bindWindow.show(function(){setRetime("#window_BindMobile #firstv","重新发送验证码",60);$("#window_BindMobile").find("#mailaddress").val(c);$("#window_BindMobile").find("span").text(c);$("#window_BindMobile").find("#varcod").val("");$("#window_BindMobile").find("#code").val("");$("#window_BindMobile").find("#errdiv").text("")})}function ChangeBindEmailWindow(a,c){var b=$("#"+a).find("#"+c).val();if(!isValid(b,"email")){$("#"+a).find("#errdiv").html("邮箱地址不正确");return false}if(bindWindow!=null){bindWindow.close(false)}bindWindow=spWindow({id:"window_Bindemail",style:{wrapper:{width:"400px"}},title:"验证邮箱",content:BindEmailContent(b),bottom:BindBottomContent("确认"),closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#window_Bindemail").find("#sendit").bind("click",function(){BindConfirm("window_Bindemail","mailaddress","mailBindVerCode",1);return false});$("#window_Bindemail").find("#firstvmail").bind("click",function(){SendVerCode("window_Bindemail","mailaddress",1,1);setRetime("#window_Bindemail #firstvmail","重新发送验证码",60);return false})}});bindWindow.show(function(){$("#window_Bindemail").find("#mailaddress").val(b);$("#window_Bindemail").find("span").text(b);$("#window_Bindemail").find("#mailBindVerCode").val("");$("#window_Bindemail").find("#errdiv").text();setRetime("#window_Bindemail #firstvmail","重新发送验证码",60)})}function BindSuccess(b){var a="";if(b=="1"){a="邮箱验证成功"}else{a="手机验证成功"}if(bindWindow!=null){bindWindow.close(false)}spWindow({id:"window_BindMobileSuccess",style:{wrapper:{width:"360px"}},title:"验证手机",content:a,bottom:'<div class="btnClose"><a href="#" class="spOrder_window_delbtn" onclick="window.location.reload();" >关闭</a></div>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}function BindConfirm(divid,mobileemailControlName,verifyControlName,bindType){var email=$("#"+divid).find("#"+mobileemailControlName).val();var verifyCode=$("#"+divid).find("#"+verifyControlName).val();var code=$("#code").val();if($.trim(verifyCode)==""&&bindType==1){$("#"+divid).find("#errdiv").html("请输入邮箱验证码。");return false}if($.trim(verifyCode)==""&&bindType==2){$("#"+divid).find("#errdiv").html("请输入手机验证码");return false}if($.trim(code)==""){$("#"+divid).find("#errdiv").html("请输入验证码");return false}var serverUrl="";var Data;if(bindType=="1"){if(!isValid(email,"email")){$("#"+divid).find("#errdiv").html("邮箱地址不正确");return false}if(!isValid(verifyCode,"isnumber")){$("#"+divid).find("#errdiv").html("邮箱验证码不正确");return false}serverUrl="/account/BindEmail";Data={VerifyCode:verifyCode,VerifyObject:bindType,EmailAddress:email,code:code}}else{if(!isValid(email,"mobile")){$("#"+divid).find("#errdiv").html("手机号码不正确");return false}if(!isValid(verifyCode,"isnumber")){$("#"+divid).find("#errdiv").html("手机验证码不正确");return false}serverUrl="/account/BindMobile?"+new Date().getTime();Data={VerifyCode:verifyCode,VerifyObject:bindType,MobileNo:email,code:code}}$.ajax({async:false,type:"post",url:serverUrl,data:Data,success:function(msg){var result=eval(msg);if(result.UserData.Success=="1"){BindSuccess(bindType)}else{var message=result.UserData.Message;if(result.UserData.Result!=0){if(bindType==2){message=message.replace("验证码","手机验证码")}else{message=message.replace("验证码","邮箱验证码")}}$("#"+divid).find("#errdiv").html(message)}}});return false}function CancelBindBottom(b){var a='<a href="#"  onclick="CancelBind(\''+b+'\')" id="sendit" class="spOrder_window_submit">确 认</a><a href="#" class="spOrder_window_delbtn">取 消</a>';return a}function CancelBind(a){$.ajax({type:"POST",url:"/account/CancelBind?"+new Date().getTime(),data:{MobileNo:a},dataType:"json",success:function(b){if(b.UserData.Success=="1"){CancelBindSuccess()}else{alert("取消失败！")}}})}function CancelBindSuccess(){if(bindWindow!=null){bindWindow.close(false)}spWindow({id:"window_CancelBindSuccess",style:{wrapper:{width:"360px"}},title:"取消验证",content:"您已解除验证手机",bottom:'<div class="btnClose"><a href="#" class="spOrder_window_delbtn" onclick="window.location.reload();" >关闭</a></div>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}function isBind(){var rtn=$.ajax({async:false,type:"POST",url:"/account/IsBindMobile?"+new Date().getTime(),dataType:"json",success:function(msg){if(msg.UserData.Success=="1"){return"1"}else{return"0"}}});return eval("("+rtn.responseText+")").UserData.Success}function AlreadyBind(a){if(bindWindow!=null){bindWindow.close(false)}spWindow({id:"window_AlreadyBind",style:{wrapper:{width:"360px"}},title:"验证提示",content:a,bottom:'<div class="btnClose"><a href="#"  class="spOrder_window_delbtn">关闭</a></div>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}var isValid=(function(){var b={email:/^([\w]+[_|\_|\-|\.]?)*[\w]+@([\w]+[_|\_|\-|\.]?)*[\w]+\.[a-zA-Z]{2,3}$/i,mobile:/^1\d{10}$/,isnumber:/^\d+$/},a=function(h,g,d,c){var e=b[g]||null,f=false;d=$.isFunction(d)?d:null;c=c||window;if(e){f=e.test(h)}else{f=true}if(f&&d){return d.call(c,h)}return f};return a})();$(function(){var a='<a href="javascript:;" id="send_btn" class="spOrder_window_submit activeComm_btns">确定</a><a href="#" class="spOrder_window_delbtn">取消</a>',b='<div id="activate"><p class="big">还差一步，为了更好地为您服务，验证完手机号之后，就可以领取成功了~</p><ul><li class="active_step2box"><label for="">手机号：</label><input type="text" name="" id="phone_numb" phdata="请输入手机号码"/><span class="active_tips"></span><br/><input type="button" id="numb_btn" class="commGray_btn activeComm_btns" value="获取验证码"/><span class="active_tips2 non"></span></li><li class="active_step3box"><label for="">验证码：</label><input type="text" name="" id="txt_msg" phdata="请输入验证码"/><span class="active_tips"></span></li></ul></div>',d=null,c=null;$(".coupon_btn").bind("click",function(h){var f=$(this).attr("id"),g=$(this).attr("dataurl");var i=$.ajax({async:false,type:"post",url:"/XieMo/isBindMobile?"+new Date().getTime(),success:function(j){if(j.UserData.Success=="1"){e(j.UserData.ActiveCode,f)}else{var k=spWindow({id:"window_"+f,style:{wrapper:{width:"600px"},content:{"font-size":"12px"}},title:"",content:b,bottom:a,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){var l=function(n,m){var r=$(n),o=true,v=60,u=null,s=r.find(".active_step2box"),t=r.find(".active_step3box"),p=false,q=false;$("#window_"+f).delegate("#phone_numb","blur",function(){var w=$("#phone_numb").val(),x=/^1\d{10}$/;if(!x.test(w)){s.find(".active_tips").removeClass("test_ok").text("请填入正确的手机号");$("#phone_numb").val("").focus()}else{s.find(".active_tips").addClass("test_ok").text("")}});$("#phone_numb, #txt_msg").focus(function(){$(this).css("border","1px solid #999")}).blur(function(){$(this).css("border","1px solid #ccc")});r.delegate(".activeComm_btns","click",function(){var w=$(this),A=w.attr("id");if(A=="numb_btn"&&o){var y=$("#phone_numb").val(),z=/^1\d{10}$/;if(!z.test(y)){s.find(".active_tips").text("请填入正确的手机号");$("#phone_numb").val("").focus()}else{s.find(".active_tips").addClass("test_ok").text("");$.ajax({type:"post",url:"/XieMo/SendVerCode?"+new Date().getTime(),data:{MobileNo:$("#phone_numb").val(),SendType:2},success:function(B){if(B.UserData.Success=="0"){s.find(".active_tips").removeClass("test_ok");s.find(".active_tips").text(B.UserData.Message);$("#phone_numb").val("").focus()}else{if(B.UserData.Success=="1"){$("#send_btn").css("opacity","1");s.find(".active_tips2").addClass("test_ok").text("验证码已发送，请注意查收！");p=true;w.prop("disabled",true);$("#numb_btn").show(0,function(){var C=$(this);C.val(""+v+"s后重新获取");clearInterval(u);u=null;v=60;C.val(""+v+"s后重新获取");u=setInterval(function(){v--;C.val(""+v+"s后重新获取");if(v<0){clearInterval(u);u=null;C.val("获取验证码");w.prop("disabled",false);s.find(".active_tips2").removeClass("test_ok").text("")}},1000)})}}}})}}if(A=="send_btn"&&p){var x=$("#txt_msg").val();if(x==""){t.find(".active_tips").text("请输入验证码");return false}$.ajax({type:"POST",data:{VerifyCode:x,VerifyObject:2,MobileNo:$("#phone_numb").val()},url:"/XieMo/BindMobile?"+new Date().getTime(),success:function(B){if(B.UserData.Success=="0"){t.find(".active_tips").text("请输入正确的验证码")}else{if(B.UserData.Success=="1"){q=true;o=false;clearInterval(u);u=null;$("#numb_btn").val("获取验证码");if(p&&q&&m){m()}}}}})}else{if(A=="send_btn"&&!p){return}}return false})};l("#window_"+f,function(){k.close();e(j.UserData.ActiveCode,f)})}}).show(function(){$("#window_"+f).find(".active_tips,.active_tips2").removeClass("test_ok").text("")})}}});return false});var e=function(i,f){var h=$("#"+f).attr("dataurl");var g=1;if(f=="Ticket200"){g=1}else{if(f=="Ticket650"){g=2}}$.ajax({type:"POST",url:"/XieMo/ActiveBindMobileCashTicket?"+new Date().getTime(),data:{couponType:g,mobileNo:$("#phone_numb").val()},timeout:12000,dataType:"json",success:function(j){var k=j.UserData.CashTicketNo;if(j.UserData.Success=="1"){if(f=="Ticket200"){$("#Ticket200").attr("dataurl","/xiemo/CouponSuccess/?cashTicketNo="+k)}h=$("#"+f).attr("dataurl");window.location=h}else{g=$("#hidCouponType").val();c(f,g)}}})};d=function(i,h){var f='<a href="#" id="quit_it" class="spOrder_window_delbtn activeComm_btns">关闭</a>';var j="";if(h==1){j='<div class="cash_getsuccess"><p>您的手机已成功绑定</p><p>恭喜您！成功领取了一张200元优惠券！</p><p>立刻点击查看<a href="/account/CashCoupons/0/1" title="" class="ac_blue">我的账户-我的优惠券</a></p></div>'}else{j='<div class="cash_getsuccess"><p>您的手机已成功绑定</p><p>恭喜您！成功领取了一个6.5折优惠码！</p><p>立刻点击查看<a href="/account/Notice" title="" class="ac_blue">我的账户-尚品通知</a></p></div>'}var g=i;spWindow({id:"window_"+g,style:{wrapper:{width:"480px"},content:{"font-size":"12px"}},title:"领取成功",content:j,bottom:f,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){}}).show()};c=function(i,j){var f='<a href="#" id="fail_btn" class="spOrder_window_delbtn activeComm_btns">关闭</a>';var h="";if(j=="1"){h='<div class="cash_getsuccess"><p>每个账号只能领取一次!您已领取过优惠券！</p><p>立刻点击查看<a href="/account/CashCoupons/0/1" title="" class="ac_blue">我的账户-我的优惠券</a></p></div>'}else{if(j=="2"){h='<div class="cash_getsuccess"><p>每个账号只能领取一次!您已领取过优惠码！</p><p>立刻点击查看<a href="/account/Notice" title="" class="ac_blue">我的账户-尚品通知</a></p></div>'}}var g=i;spWindow({id:"window_"+g,style:{wrapper:{width:"480px"},content:{"font-size":"12px"}},title:"领取失败",content:h,bottom:f,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){h=""}}).show()}});function SetDefaultConsignee(a){var c="/account/SetDefaultConsignee?"+new Date().getTime();var b=false;return $.ajax({type:"POST",url:c,data:{Id:a},timeout:12000,dataType:"json",error:function(e,d){},success:function(d){if(d.UserData.Success=="1"){window.location.href="/account/ConsigneeAddress"}else{alert(d.UserData.Message)}}})}function DeleteConsignee(a){var c="/account/DeleteConsignee?"+new Date().getTime();var b=false;$.ajax({type:"POST",url:c,data:{Id:a},timeout:12000,dataType:"json",error:function(e,d){},success:function(d){if(d.UserData.Success=="1"){window.location.href="/account/ConsigneeAddress"}else{alert(d.UserData.Message)}}})}function ShowConsigneeSaveSuccess(){spWindow({id:"window_ShowConsigneeSaveSuccess",style:{wrapper:{width:"380px"}},title:"保存提示",content:'<i class="form_succeed">保存成功</i>',bottom:'<a href="#" onclick="window.location.href=\'/account/ConsigneeAddress\';" class="spOrder_window_delbtn">确定</a>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}function ShowConsigneeSaveFail(){spWindow({id:"window_ShowConsigneeSaveFail",style:{wrapper:{width:"380px"}},title:"保存提示",content:'<i class="form_failed">保存失败</i>',bottom:'<a href="#"  class="spOrder_window_delbtn">确定</a>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}$(".addr_handel").find("a[value]").click(function(){var a=$(this).attr("value");$(".myinfo_Notice span").text("修改收货地址");$(".newAddr_Btn").hide();setTimeout(function(){initControl(a)},100);return false});function initControl(a){$(".new_Addr").show();cancelConsignee();var b=$("#hdConsignee_"+a).val().split("|");$("#ConsigneeId").val(b[0]);$("#consnee_name").val(b[1]);$("#ProvinceId").val(b[2]);fillCity($("#CityId").val());$("#CityId").val(b[3]);fillArea($("#AreaId").val());$("#AreaId").val(b[4]);$("#consnee_addr").val(b[5]);$("#consnee_code").val(b[6]);$("#consnee_mobile").val(b[7]);var c=b[8].split("-");$("#consnee_phone1").val(c[0]);if(c.length>1){$("#consnee_phone2").val(c[1])}if(c.length>2){$("#consnee_phone3").val(c[2])}if(b[9]=="2"||b[9]=="3"){$("#LastFlag").attr("checked",true);$("#LastFlag").val(b[9])}else{$("#LastFlag").attr("checked",false);$("#LastFlag").val("0")}}function cancelConsignee(){$("#ConsigneeId").val("0");$("#consnee_name").val("");$("#ProvinceId").val(-1);$("#CityId").val(-1);$("#AreaId").val(-1);$("#consnee_addr").val("");$("#consnee_code").val("");$("#consnee_mobile").val("");$("#consnee_phone1").val("");$("#consnee_phone2").val("");$("#consnee_phone3").val("");$("#LastFlag").attr("checked","checked");$("#LastFlag").val("2");var a=$(".addr_form").children("dl").children("dd");a.removeClass("error").find("i").remove();a.find("p").hide();a.find("div").show();return false}$("#LastFlag").click(function(){if($(this).attr("checked")=="checked"){$(this).val("2")}else{$(this).val("0")}});function AddFavoriteBrand(a){var c="/account/AddFavoriteBrand";var b=false;return $.ajax({type:"POST",url:c,data:{brandNo:a},timeout:12000,dataType:"json",error:function(e,d){},success:function(d){if(d.UserData.Success=="1"){return true}else{return false}}})}function logStatus(){var a=$.ajax({type:"post",url:"/login/IsAuthenticated",async:false});return a}function checkLoginStatus(){var a=0;$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp",async:false}).done(function(b){if(b){return b.IsAuthenticated}});return a}function AddFavoriteProductNoNew(g,a,e,b){var f=$("#topicno").val();var d=$("#NewShangpinAccountDomainUrl").val()+"/account/AddFavoriteProductNew";var c=$.ajax({type:"get",url:d,jsonp:"callback",dataType:"jsonp",data:{type:g,productNo:a,skuNo:e,price:b,topicno:f}});return c}$(function(){$("#spDetail_b_col").bind("click",function(){var a=$("#NewShangpinLoginDomainUrl").val();$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp"}).done(function(e){if(e.IsAuthenticated==1){var h=$("#favmsg"),b=$("#spDetail_sb_msg");var j=$("#proId").val();var i=$("#SP_ProdPrice").val();var d=$("#spDetail_proColor");var l="";if(d.length>0){d=d.find("span.limg_on,span.limg_ison");if(d.length==0){b.html("&nbsp;");h.html("请选择商品颜色");return}else{l=d.attr("skuno")}}var c=$("#spDetail_proChima");if(c&&c.length>0){if(c.find("li.lcm_on,li.lcm_ison").length==0){b.html("&nbsp;");h.html("请选择商品尺码");return}else{c=c.find("li.lcm_on,li.lcm_ison");l=c.attr("skuno")}}if($("#spDetail_proColor").length==0&&c.length==0){l=$("#skuno").val()}h.html("&nbsp;");b.html("&nbsp;");var g=j+"_"+d.attr("value");if(c.length>0){g=g+"_"+c.find("li.lcm_on,li.lcm_ison").attr("val")}$.ajax({url:$("#NewShangpinAccountDomainUrl").val()+"/account/AddFavoriteProductNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp",data:{type:"2",productNo:j,skuNo:l,price:i,topicno:$("#topicno").val()}}).done(function(n){if(n.UserData!=null&&n.UserData.Success=="1"){if(!$(".collection_commodity").hasClass("already_collection")){$("#spDetail_b_col").parent().addClass("already_collection");$("#spDetail_b_col").html("已收藏成功！")}}else{h.css({color:"red","background-image":"",display:"block"}).html("收藏失败!")}setTimeout(function(){h.html("&nbsp;").css({"background-image":"","padding-left":"0px"})},1500)})}else{var m=$("#topicno").val();var f=parseInt($("#gender").val(),0)==1?"/men":"/women";var k=$("#NewShangpinDomainUrl").val();if(m!=undefined&&m!=""){location.href=a+"/register?returnUrl="+k+escape("/product/"+m+"/"+$("#proId").val())}else{location.href=a+"/register?returnUrl="+k+escape("/product/"+$("#proId").val())}}})})});function AddFavoriteProductNo(g,a,e,b){var f=$("#topicno").val();var d="/account/AddFavoriteProduct";var c=$.ajax({type:"post",url:d,async:false,data:{type:g,productNo:a,skuNo:e,price:b,topicno:f}});return c}function addShopCart(d,e,b,a,c){DirectAddSHopcart(d,e,b,a)}function DirectAddSHopcart(c,d,b,a){$.ajax({type:"POST",url:"/account/AddFavoriteProductToCart",data:{productNo:c,productHashText:a,topicNo:b},dataType:"json",success:function(e){if(e.Success){window.location.href="/trade/Cart"}else{alert(e.Err)}}})}function getFavoriteProductColorAndSize(b,h,f,e,g,a){var d="/account/GetProductColorAndSize";var c=false;return $.ajax({type:"POST",url:d,data:{productNo:b,skuNo:h,skuAttrText:f,sizeStandard:e,skuHashText:g,productCategoryNo:a},timeout:12000,async:false,dataType:"json",success:function(i){if(i.UserData.Success=="1"){$("span#"+h).text(i.UserData.Message)}}})}function elCardUrlHref(a){window.location.href=a}$(function(){var i=null,h=null,k=null,l=null,j=null,g=null,n=null,e;if($("#checkFlag").length==0){$("#checkFlag").val("0")}var a=$("#NewShangpinAccountDomainUrl").val();var b=a+"/account/ActiveGiftCard";i=function(r,t,s){var u='<a href="javascript:;" id="send_btn1" class="spOrder_window_submit activeComm_btns">下一步</a>';var v='<div class="bind_mobile">';v+='<ul class="bind_step clr">';v+='<li class="step1_curr">绑定手机<span class="arrow_50"></span></li>';v+='<li class="step2">设置支付密码<span class="arrow_50"></span></li>';v+='<li class="step3">绑定激活</li>';v+="</ul>";v+='<p class="padb20">您已经绑定手机：'+s+'</p><p class="pdt110">我们会将礼品卡的消费短信发送到绑定手机。</p>';var q=r;var p=spWindow({id:"window_"+q,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:v,bottom:u,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#send_btn1").on("click",function(){p.close(false);if(!t){k("payPassword")}else{l("payPassSucc")}})}}).show()};k=function(r,s){var q='<div class="bind_mobile">';q+='<ul class="bind_step clr">';q+='<li class="step1">绑定手机<span class="arrow_50"></span></li>';q+='<li class="step2_curr">设置支付密码<span class="arrow_50"></span></li>';q+='<li class="step3">绑定激活</li>';q+="</ul>";q+='<p class="padb20">开户支付密码可保障您的账户奖金安全，当您使用账户金额或卡账户余额支付订单时，会提示您好输入</p>';q+='<div id="noticepass" class="ac_red"></div>';q+='<dl class="clr">';q+="<dt>请输入支付密码：</dt>";q+='<dd><input type="password" id="oncePassWord" /><span class="mobile_tips">支付密码不能为空</span></dd>';q+="</dl>";q+='<dl class="clr">';q+="<dt>请再次输入支付密码：</dt>";q+='<dd><input type="password" id="rePassWord" /><span class="mobile_tips"></span></dd></dd>';q+="</dl>";q+="</div>";var u='<a href="javascript:;" id="send_btn2" class="spOrder_window_submit activeComm_btns">确定</a>';var p=r;var t=spWindow({id:"window_"+p,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:q,bottom:u,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){var w=$("#window_"+p),v=w.find("#noticepass"),y=w.find("#oncePassWord"),z=w.find("#rePassWord"),x=w.find("#oncePassWord,#rePassWord");$("#send_btn2").on("click",function(){var C=y.val(),D=z.val(),A=C.length,B=D.length,E=y.val(),F=z.val();if(A==0||B==0){v.html("请输入支付密码")}else{if(A<6||B<6){v.html("密码长度6-20位")}else{if(A>20||B>20){v.html("密码长度6-20位")}else{if(E==F){t.close(false);$.ajax({type:"GET",dataType:"jsonp",url:b,data:{GiftCardNo:$("#checkFlag").val()=="0"?$("#giftCard").val():$("#giftCardNo").val(),PassWord:$("#passWord").val(),VerifyCode:"",CheckFlag:$("#checkFlag").val(),CheckStepFlag:3,MobileNo:"",MobileVerifyCode:"",PayPassWord:E},success:function(G){if(G.Success){if(!s){j("giftative",1)}}else{if(!s){if(G.Result!=null){$(".giftactives span").html("");j("giftative",0,G.ErrorMsg)}else{k("payPassword");v.html(G.ErrorMsg)}}}}})}else{if(E!==F){v.html("两次输入密码不一致")}}}}}});x.on("focus",function(){v.html("")})}}).show()};l=function(q,r){var t='<a href="javascript:;" id="send_btn3" class="spOrder_window_submit activeComm_btns">下一步</a>';var u='<div class="bind_mobile"><ul class="bind_step clr">';u+='<li class="next step1">';u+="绑定手机";u+='<span class="arrow_50">';u+="</span>";u+="</li>";u+='<li class="step2_curr">';u+="设置支付密码";u+='<span class="arrow_50">';u+="</span>";u+="</li>";u+='<li class="step3">';u+="绑定激活";u+="</li>";u+="</ul>";u+='<div class="pay_getsuccess">';u+='<p style="text-align:left" class="padb20">开户支付密码可保障您的账户奖金安全，当您使用账户金额或卡账户余额支付订单时，会提示您好输入</p>';u+='<p style="color:#212121">您已经设置了支付密码</p>';u+="</div>";u+="</div>";var p=q;var s=spWindow({id:"window_"+p,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:u,bottom:t,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#send_btn3,.ac_gold").on("click",function(){s.close(false);$.ajax({type:"GET",dataType:"jsonp",url:b,data:{GiftCardNo:$("#checkFlag").val()=="0"?$("#giftCard").val():$("#giftCardNo").val(),PassWord:$("#passWord").val(),VerifyCode:"",CheckFlag:$("#checkFlag").val(),CheckStepFlag:3,MobileNo:"",MobileVerifyCode:"",PayPassWord:""},success:function(v){if(v.Success){if(!r){j("giftative",1)}}else{if(!r){$(".giftactives span").html("");j("giftative",0,v.ErrorMsg)}}}})})}}).show()};j=function(u,x,r){var v=x==1?"卡片激活成功！":r;var q=x==1?"":"erro";var w='<li class="spOrder_window_submit activeComm_btns"></li>';var s='<div class="bind_mobile">';s+='<ul class="bind_step clr">';s+='<li class="step1">绑定手机<span class="arrow_50"></span></li>';s+='<li class="step2">设置支付密码<span class="arrow_50"></span></li>';s+='<li class="step3_curr">绑定激活</li>';s+="</ul>";s+='<div class="bind_sucess">绑定成功！</div>';s+="</div>";var p=u;var t=spWindow({id:"window_"+p,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:s,bottom:w,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#send_btn4").on("click",function(){t.close();if(x==1){if(n=="false"){getGiftData("#gift-hookbox",false)}else{getGiftData(".gifts_content",true)}$("#gift-activebox input").val("");ChangeVerifyCode(1);if($("#bindCard").length>0){window.open("/account/GiftCard","_blank")}}$("#gift-activebox input").val("");ChangeVerifyCode(1);if($("#checkFlag").val()=="1"){document.location.href=a+"/account/GiftCard"}})}}).show();$(".giftactives span").html(v)};g=function(s){var t='<a href="javascript:;" id="send_btn5" class="spOrder_window_submit activeComm_btns">完成</a>';var r='<div class="bind_mobile">';r+='<ul class="bind_step clr">';r+='<li class="step1">绑定手机111<span class="arrow_50"></span></li>';r+='<li class="step2">设置支付密码<span class="arrow_50"></span></li>';r+='<li class="step3_curr">绑定激活</li>';r+="</ul>";r+='<div class="bind_sucess">绑定成功！</div>';r+="</div>";var p=s;var q=spWindow({id:"window_"+p,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:r,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#send_btn5").on("click",function(){if(n=="false"){if($("#checkFlag").val()=="1"){document.location.href=a+"/account/GiftCard"}}if($("#bindCard").length>0){window.open(a+"/account/GiftCard","_blank")}$.ajax({type:"Get",url:"/trade/gitcardinfo.html?orderno="+$("#orderId").val()+"&s="+Math.random(),jsonp:"callback",dataType:"json",success:function(u){alert(111);if(u.Success=="0"){$(".giftactives span").html(resultStr)}else{$("#giftcardInfo").html(u.Html);$(".gifts_content").show()}},error:function(){}});$("#giftsCard").attr("checked","checked");q.close()})}}).show()};if($("#btn-look").length>0){$("#btn-look").on("click",function(){if($("#giftCard").val().length==0){$("#giftCard").siblings(".active_tips").text("请输入卡号");$("#passWord, #verifyCode").siblings(".active_tips").text("");return false}else{if($("#giftCard").val().length!=16){$("#giftCard").siblings(".active_tips").text("您输入的卡号有误");$("#passWord, #verifyCode").siblings(".active_tips").text("");return false}else{if($("#passWord").val().length==0){$("#passWord").siblings(".active_tips").text("请输入密码");$("#giftCard, #verifyCode").siblings(".active_tips").text("");return false}else{if($("#passWord").val().length!=10){$("#passWord").siblings(".active_tips").text("您输入的密码有误");$("#giftCard, #verifyCode").siblings(".active_tips").text("");return false}else{if($("#verifyCode").val().length==0){$("#verifyCode").siblings(".active_tips").text("请输入验证码");$("#giftCard, #passWord").siblings(".active_tips").text("");return false}else{$("#giftCard, #passWord, #verifyCode").siblings(".active_tips").text("")}}}}}var q=$("#giftCard").val();$.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",url:$("#NewShangpinAccountDomainUrl").val()+"/account/GetGiftCardInfo?giftCardNo="+q+"&verifyCode="+verifyCode,success:function(u){if(u.Success){amountDateStr=u.CurrentAmount+"|"+u.DateEnd}else{$("#verifyCode").siblings(".active_tips").text(u.ErrorMsg);$("#giftCard, #passWord").siblings(".active_tips").text("")}}});var s='<a href="javascript:;" id="send_btnlook" class="spOrder_window_submit activeComm_btns">确定</a>';var t='<div class="looksy"><p>您查询的卡片余额为：<span class="ac_red">'+amountDateEnd.split("|")[0].toString("#########.##")+"</span>元</p><p>卡片有效期：<b>"+amountDateEnd.split("|")[1]+'</b></p><p class="padt10">为确保卡内资金的安全，我们建议您尽快绑定激活卡片。</p></div>';var p=$(this).attr("id");var r=spWindow({id:"window_"+p,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"卡片余额查询",content:t,bottom:s,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#window_"+p).find("#send_btnlook").on("click",function(){r.close()})}}).show();return false})}$("#spAccount_favorite").delegate(".consumption-log","click",function(){var p=$(this).attr("logid"),r='<a href="javascript:;" id="lookLog" class="spOrder_window_submit activeComm_btns">返回</a>',s="",q="",u="",t="";$.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",url:$("#NewShangpinAccountDomainUrl").val()+"/account/GiftCardCostDetail?giftCardNo="+p+"&f="+Math.random(),success:function(w){q='<table class="cart-costinfo">								<tr>									<td>卡片类型：'+w.CardType+"</td>						  			<td>卡号："+w.GiftCardNo+"</td>									<td>面值："+w.Amount+" </td>								</tr>								<tr>									<td>卡内余额："+w.CurrentAmount+"</td>									<td>卡状态："+w.Status+" </td>									<td>有效期："+w.DateEnd+"</td>								</tr>							</table>";if(w.list.length&&w.list){for(var x=0,y=w.list.length;x<y;x++){var z=UseTypeText(w.list[x].UseType);t+='<tr>							<td><a href="'+w.list[x].LinkUrl+'" class="ac_gold">'+w.list[x].OrderNum+"</a></td>							<td>"+w.list[x].OrderDate+"</td>							<td>"+z+"</td>							<td>"+w.list[x].BeforeVal+"</td>							<td>"+w.list[x].ChangeVal+"</td>							<td>"+w.list[x].AfterVal+"</td>						</tr>"}u='<div class="costinfo-listbox"><table class="costinfo-list">							<thead>								<tr>									<th>订单号</th>									<th>时间</th>									<th>类型</th>									<th>变动前</th>									<th>变动金额</th>									<th>变动后</th>								</tr>							</thead>							<tbody>							'+t+"							</tbody>						</table></div>";s=q+u}else{s=q+"<b>您暂时还没有消费记录</b>"}var v=spWindow({id:"window_"+p+Math.random(),style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"查看卡片消费记录",content:s,bottom:r,closeBtn:".spOrder_window_submit, .title_closeBtn",titleColse:true,backover:true}).show()}});return false});var c='<table id="gift-bingbox"><tbody><tr><td class="txtright" width="180">请输入礼品卡卡号：</td><td width="320"><input type="text" name="" class="normal-input" id="giftCard" /><span class="active_tips"></span></td></tr>';c+='<tr><td class="txtright">请输入礼品卡密码：</td><td><input type="input" name="" class="normal-input" id="passWord" /><span class="active_tips"></span></td></tr>';c+='<tr id="giftCardCode" style="display:none"><td class="txtright">请输入验证码：</td><td><input type="text" name="" class="normal-input short-input" id="verifyCode" /><span class="testcodebox" id="giftcardActive"><img id="verifyCodeImg" src="/login/VerifyGiftCardHandler?type=shangpin_account_vc1" alt="验证码" style="cursor:pointer" onclick="ChangeVerifyCode(1);" /></span></td></tr>';c+='<tr><td colspan="2" class="text_center"><span class="active_tips" id="active_tip"></span></td></tr></tbody></table>';var d='<a href="#" class="spOrder_window_submit" id="btn-active">充&nbsp;&nbsp;值</a> <input type="hidden" id="checkFlag" value="0" />';$(".bandGiftCard").click(function(){var s="";var p="";var r="";if($("#NewShangpinLoginDomainUrl").length>0){s=$("#NewShangpinLoginDomainUrl").val()}if($("#NewShangpinDomainUrl").length>0){r=$("#NewShangpinDomainUrl").val()}if($("#NewShangpinAccountDomainUrl").length>0){p=$("#NewShangpinAccountDomainUrl").val()}var q;$.ajax({type:"get",jsonp:"callback",dataType:"jsonp",url:s+"/login/IsValidateLogin",async:false,success:function(t){var u=0;if(t){u=parseInt(t.IsAuthenticated)}if(u!=1){location.href=s+"/login/logon?returnUrl="+escape(r+"/giftcard")}else{q=spWindow({id:"bindCard",style:{wrapper:{width:"600px",height:"420px"}},title:"实物卡充值",content:c,bottom:d,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){var v=$("#bindCard");v.delegate("#giftCard","blur",function(){$("#giftCard").val(($.trim($("#giftCard").val())))});v.delegate("#passWord","blur",function(){$("#passWord").val(($.trim($("#passWord").val())))});v.find("#btn-active").click(function(){if($("#checkFlag").val()=="0"){if($("#giftCard").val().length==0){$("#active_tip").text("请输入卡号");return false}else{if($("#giftCard").val().length!=16){$("#active_tip").text("您输入的卡号有误");return false}else{if($("#passWord").val().length==0){$("#active_tip").text("请输入密码");return false}else{if($("#passWord").val().length!=10){$("#active_tip").text("您输入的密码有误");return false}else{if(($("#giftCardCode").css("display")!="none")&&$("#verifyCode").val().length==0){$("#active_tip").text("请输入验证码");return false}else{$("#active_tip").text("")}}}}}}n=$(this).attr("showType");var z=$("#checkFlag").val()=="0"?$("#giftCard").val():$("#giftCardNo").val();var A=$("#passWord").val();var B=$("#verifyCode").val();var x=$("#checkFlag").val();var y=1;$.ajax({cache:false,url:b,data:{GiftCardNo:z,PassWord:A,VerifyCode:B,CheckFlag:x,CheckStepFlag:y,MobileNo:"",MobileVerifyCode:"",PayPassWord:""},type:"GET",dataType:"jsonp",jsonp:"callback",success:function(C){if(C.Success){if(C.Result=="1"){if(!q){if(n=="false"){getGiftData("#gift-hookbox",false)}else{getGiftData(".gifts_content",true)}}if(q){$("#gift-bingbox input").val("");ChangeVerifyCode(1)}$("#gift-activebox input").val("");ChangeVerifyCode(1);if(q){q.close(false)}g("cartboxss")}else{if(C.Result.indexOf("|")!=-1&&C.Result.split("|")[0]=="-1"&&C.Result.split("|")[1]=="0"){if(q){q.close(false)}w("bindTell",false)}else{if(C.Result.indexOf("*")!=-1){var D=false;if(C.Result.indexOf("|")!=-1&&C.Result.split("|")[1]=="1"){D=true}if(q){q.close(false)}i("chenggong",D,C.Result.split("|")[0])}else{if(C.Result.indexOf("|")!=-1&&C.Result.split("|")[0]=="-1"&&C.Result.split("|")[1]=="1"){if(q){q.close(false)}w("bindTell",true)}}}}}else{if(C.Result=="1"){if($("#paymentactivecard").length>0){$("#paymentactivecard").text(C.ErrorMsg)}else{if($("#active_tip").length>0){$("#active_tip").text(C.ErrorMsg)}else{$("#btn-active").siblings(".active_tips").text(C.ErrorMsg)}}ChangeVerifyCode(1)}else{$("#active_tip").html(C.ErrorMsg)}}}});function w(G,H){var D=G;var C='<a href="javascript:;" id="send_btn" class="spOrder_window_submit activeComm_btns">确定</a>';var F='<div class="bind_mobile">';F+='<ul class="bind_step clr">';F+='<li class="step1_curr">绑定手机<span class="arrow_50"></span></li>';F+='<li class="step2">设置支付密码<span class="arrow_50"></span></li>';F+='<li class="step3">绑定激活</li>';F+="</ul>";F+='<div id="activate">';F+='<dl class="clr active_step2box">';F+="<dt>请输入手机号：</dt>";F+='<dd><input type="text" id="phone_numb" /><span class="active_tips"></span><p>我们会将礼品卡的消费短信发到您绑定的手机。</p>';F+='<p><a href="javascript:;" class="send_btn activeComm_btns resendBtn" id="numb_btn">获取验证码</a></p></dd>';F+="</dl>";F+='<dl class="clr active_step3box">';F+="<dt>请输入验证码：</dt>";F+='<dd><input type="text" id="txt_msg" /><span class="active_tips"></span></dd>';F+="</dl>";F+="</div>";F+="</div>";var E=spWindow({id:"window_"+D,style:{wrapper:{width:"600px",height:"420px"},content:{"font-size":"12px"}},title:"绑定激活礼品卡",content:F,bottom:C,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#send_btn").css("opacity","0.5");var I=function(K,J){var O=$(K),L=true,S=60,R=null,P=O.find(".active_step2box"),Q=O.find(".active_step3box"),M=false,N=false;$("#window_"+D).delegate("#phone_numb","blur",function(){var T=$("#phone_numb").val(),U=/^1\d{10}$/;if(!U.test(T)){P.find(".active_tips").removeClass("test_ok").text("您输入的手机号码有误");$("#phone_numb").focus();return false}else{P.find(".active_tips").addClass("test_ok").text("")}});O.delegate(".activeComm_btns","click",function(){var T=$(this),W=T.attr("id");var U=$("#phone_numb").val();if(W=="numb_btn"&&L){V=/^1\d{10}$/;if(!V.test(U)){P.find(".active_tips").text("您输入的手机号码有误");$("#phone_numb").focus();return false}else{P.find(".active_tips").addClass("test_ok").text("");$.ajax({type:"GET",dataType:"jsonp",url:a+"/account/GetMobileVerifyCode?mobileNo="+$("#phone_numb").val(),success:function(X){if(!X.Success){P.find(".active_tips").text(X.ErrorMsg)}else{if(X.Success){$("#send_btn").css("opacity","1");P.find(".active_tips2").addClass("test_ok").text("验证码已发送，请注意查收！");M=true;T.prop("disabled",true);$("#numb_btn").show(0,function(){var Y=$(this);Y.val(""+S+"s后重新获取");clearInterval(R);R=null;S=60;Y.val(""+S+"s后重新获取");R=setInterval(function(){S--;Y.val(""+S+"s后重新获取");if(S<0){clearInterval(R);R=null;Y.val("获取验证码");T.prop("disabled",false);P.find(".active_tips2").removeClass("test_ok").text("")}},1000)})}}}})}}if(W=="send_btn"&&M){var U=$("#phone_numb").val(),V=/^1\d{10}$/;if(!V.test(U)){P.find(".active_tips").removeClass("test_ok").text("您输入的手机号码有误");$("#phone_numb").focus();return false}else{$.ajax({type:"GET",dataType:"jsonp",url:b,data:{GiftCardNo:$("#checkFlag").val()=="0"?$("#giftCard").val():$("#giftCardNo").val(),PassWord:$("#passWord").val(),VerifyCode:"",CheckFlag:$("#checkFlag").val(),CheckStepFlag:2,MobileNo:U,MobileVerifyCode:$("#txt_msg").val(),PayPassWord:""},success:function(X){if(!X.Success){Q.find(".active_tips").text(X.ErrorMsg)}else{if(X.Success){if($("#txt_msg").val()==""){Q.find(".active_tips").text("请输入正确的验证码")}else{Q.find(".active_tips").text("");N=true;L=false;clearInterval(R);R=null;$("#numb_btn").val("获取验证码");if(M&&N&&J){J()}}}}}})}}else{if(W=="send_btn"&&!M){return}}return false})};I("#window_"+D,function(){E.close(false);if(H){l("payPassSucc")}else{k("payPassword")}})}}).show(function(){$("#window_"+D).find(".active_tips,.active_tips2").removeClass("test_ok").text("")})}return false})}}).show(function(){$("#gift-bingbox input").val("");ChangeVerifyCode(1);$("#giftCard, #passWord, #verifyCode").siblings(".active_tips").text("")});return false}}})});var o;o="";if($("#wwwSite").length>0){o=$("#wwwSite").val()}var m='<table id="gift-receivebox"><tbody><tr><td class="txtright" width="180">请输入领卡密钥：</td><td " width="320"><input type="text" name="" class="normal-input" id="receiveCard_pwd" /><span class="active_tips"></span></td></tr><tr id="giftCode" style="display:none"><td class="txtright">请输入验证码：</td><td><input type="text" name="" class="normal-input short-input" id="receiveCard_code" /><span class="testcodebox"><img id="verifyCodeImg3" src="'+o+'/login/VerifyLoginHandlerII?type=account_vc3" style="cursor:pointer" alt="验证码" onclick="ChangeVerifyCode(3);" /></span></td></tr><tr><td class="text_center" colspan="2"><span id="active_tip" class="active_tips code_active_tips"></span></td></tr></tbody></table>';var f='<a href="javascript:;" class="spOrder_window_submit" id="receiveSubmit">充&nbsp;&nbsp;值</a>';$(".receiveBtn").click(function(){var r="";var p="";var q="";if($("#NewShangpinDomainUrl").length>0){q=$("#NewShangpinDomainUrl").val()}if($("#NewShangpinLoginDomainUrl").length>0){r=$("#NewShangpinLoginDomainUrl").val()}if($("#NewShangpinAccountDomainUrl").length>0){p=$("#NewShangpinAccountDomainUrl").val()}$.ajax({type:"get",jsonp:"callback",dataType:"jsonp",url:r+"/login/IsValidateLogin",async:false,success:function(s){var t=0;if(s){t=parseInt(s.IsAuthenticated)}if(t!=1){location.href=r+"/login/logon?returnUrl="+escape(q+"/giftcard")}else{var u=spWindow({id:"receiveCard",style:{wrapper:{width:"600px",height:"420px"}},title:"电子卡充值",content:m,bottom:f,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){var v=false;$("#receiveCard_pwd").blur(function(){$("#receiveCard_pwd").val(($.trim($("#receiveCard_pwd").val())))});$("#receiveSubmit").click(function(){if(!v){if($("#receiveCard_pwd").val()==""){$(".code_active_tips").text("请输入领卡密钥");return false}else{if(($("#giftCode").css("display")!="none")&&($("#receiveCard_code").val()=="")){$(".code_active_tips").text("请输入验证码");return false}else{if($("#giftCode").css("display")=="none"){v=true;$.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",url:p+"/account/GetEGiftCardInfoByKey?eGiftCardKey="+$("#receiveCard_pwd").val()+"&verifyCode=0000",success:function(w){if(w.Success){v=false;u.close();location.href=p+"/account/GiftCard/"+w.Result+"/1"}else{v=false;$(".code_active_tips").text(w.ErrorMsg);ChangeVerifyCode(3)}}});return false}else{$("#receiveCard_pwd").siblings(".active_tips").text("");$(".code_active_tips").text("");v=true;$.ajax({type:"GET",dataType:"jsonp",jsonp:"callback",url:p+"/account/GetEGiftCardInfoByKey?eGiftCardKey="+$("#receiveCard_pwd").val()+"&verifyCode="+$("#receiveCard_code").val(),success:function(w){if(w.Success){v=false;u.close();location.href=p+"/account/GiftCard/"+w.Result+"/1"}else{v=false;$(".code_active_tips").text(w.ErrorMsg);$("#receiveCard_pwd").siblings(".active_tips").text("");ChangeVerifyCode(3)}}});return false}}}}else{v=false;if($("#receiveCard_pwd").val()==""){$(".code_active_tips").text("请输入领卡密钥");return false}else{if(($("#verifyCode").css("display")!="none")&&($("#receiveCard_code").val()=="")){$(".code_active_tips").text("请输入验证码");return false}else{$("#receiveCard_pwd, #receiveCard_code").siblings(".active_tips").text("");ChangeVerifyCode(3)}}return false}})}}).show(function(){$("#gift-receivebox input").val("");$("#receiveCard_code, #receiveCard_pwd").siblings(".active_tips").text("");ChangeVerifyCode(3)});return false}}})});if($("#checkFlag").val()=="1"){$("#btn-active").trigger("click")}});function UseTypeText(a){var b="";switch(a){case"1":b="消费";break;case"2":b="退款";break;default:b="调整";break}return b}function CardTypeText(a){var b="";switch(a){case"1":b="礼品卡电子卡（电子卡）";break;case"2":b="礼品卡刮刮卡（实物卡）";break;default:b="礼品卡磁条卡（实物卡）";break}return b}function ChangeVerifyCode(c){var e="";var f="";switch(c){case 1:e="verifyCodeImg";f="shangpin_account_vc1";break;case 2:e="verifyCodeImg2";f="account_vc2";break;case 3:e="verifyCodeImg3";f="account_vc3";break}var d="";var a="";var b="";if($("#NewShangpinDomainUrl").length>0){b=$("#NewShangpinDomainUrl").val()}if($("#NewShangpinLoginDomainUrl").length>0){d=$("#NewShangpinLoginDomainUrl").val()}if($("#NewShangpinAccountDomainUrl").length>0){a=$("#NewShangpinAccountDomainUrl").val()}$("#"+e).attr("src",d+"/login/VerifyGiftCardHandler?type="+f+"&f="+Math.random())}function GetGiftCardInfo(c){var a="";var b=$("#giftCard").val();$.ajax({type:"GET",dataType:"json",url:$("#NewShangpinAccountDomainUrl").val()+"/account/GetGiftCardInfo?giftCardNo="+b+"&verifyCode="+c,success:function(d){if(d){a=d.CurrentAmount+"|"+d.DateEnd}}});return a}function logStatus(){var c="";var a="";var b="";if($("#NewShangpinDomainUrl").length>0){b=$("#NewShangpinDomainUrl").val()}if($("#NewShangpinLoginDomainUrl").length>0){c=$("#NewShangpinLoginDomainUrl").val()}if($("#NewShangpinAccountDomainUrl").length>0){a=$("#NewShangpinAccountDomainUrl").val()}var d=$.ajax({type:"post",url:c+"/login/IsAuthenticated",async:false});return d}$(function(){$(".ztInvite_Top a").css("opacity",0);$("#emailArea").focus(function(){if($(this).val()==this.defaultValue){$(this).val("");$(this).addClass("focus")}}).blur(function(){if($(this).val()==""){$(this).val(this.defaultValue);$(this).removeClass("focus")}});var f=parseInt($("#chartRegNum").attr("data-reg")),e=0;if(f==0){$("#chartRegNum").css("width","0%");$("#scale1").show()}else{if(f==1){$("#chartRegNum").css("width","16%");$("#scale1").show()}else{if(f<15){e=f*4.5+16;$("#chartRegNum").css("width",e+"%");$("#scale1").show()}else{if(f==15){$("#scale1").hide();$("#scale2").show();$("#chartRegNum").css("width","16%")}else{if(f>15&&f<30){$("#scale1").hide();$("#scale2").show();e=(f-15)*4.5+16;$("#chartRegNum").css("width",e+"%")}else{if(f==30){$("#scale2").hide();$("#scale3").show();$("#chartRegNum").css("width","16%")}else{if(f>30&&f<45){$("#scale2").hide();$("#scale3").show();e=(f-30)*4.5+16;$("#chartRegNum").css("width",e+"%")}else{if(f==45){$("#scale3").hide();$("#scale4").show();$("#chartRegNum").css("width","16%")}else{if(f>45&&f<60){$("#scale3").hide();$("#scale4").show();e=(f-45)*4.5+16;$("#chartRegNum").css("width",e+"%")}else{if(f==60){$("#scale4").hide();$("#scale5").show();$("#chartRegNum").css("width","16%")}else{if(f>60&&f<75){$("#scale4").hide();$("#scale5").show();e=(f-60)*4.5+16;$("#chartRegNum").css("width",e+"%")}else{if(f==75){$("#scale5").hide();$("#scale6").show();$("#chartRegNum").css("width","16%")}else{if(f>75&&f<90){$("#scale5").hide();$("#scale6").show();e=(f-75)*4.5+16;$("#chartRegNum").css("width",e+"%")}else{if(f==90){$("#scale6").hide();$("#scale7").show();$("#chartRegNum").css("width","16%")}else{if(f>90){$("#scale6").hide();$("#scale7").show();e=(f-90)*4.5+16;$("#chartRegNum").css("width",e+"%")}}}}}}}}}}}}}}}var b=parseInt($("#chartBuyNum").attr("data-buy")),a=b*2.25+16;if(b==0){$("#chartBuyNum").css("width","0%")}else{if(b==1){$("#chartBuyNum").css("width","16%")}else{$("#chartBuyNum").css("width",a+"%")}}$(".chart_progress p a").hover(function(){var g=$(this),i=g.offset().left+g.width(),j=g.offset().top,h=g.closest("p").siblings(".chart_tips");h.css({left:(i-45)+"px",top:(j+23)+"px"}).show()},function(){var g=$(this),h=g.closest("p").siblings(".chart_tips");h.hide()});if($("#alInvite_linkbox").length>0){var c=null;ZeroClipboard.setMoviePath("/scripts/live/dev/core/plug/ZeroClipboard.swf");function d(j,g,h){var i=arguments.length;c=new ZeroClipboard.Client();c.setHandCursor(true);c.addEventListener("mouseOver",function(k){c.setText(document.getElementById(j).value)});c.addEventListener("complete",function(k,l){if(i==3){document.getElementById(h).innerHTML="复制成功"}else{alert("复制成功: "+l)}});c.glue(g)}d("alInvite_linkbox","submit_btnid")}$("#alInvite_linkbox").click(function(){$(this).select()});$("#exchangeid").click(function(){$(this).attr("disabled","disabled");$(this).text("正在领取...");$.ajax({type:"POST",url:"/account/exchangeamount",dataType:"json",success:function(h){if(h.UserData.Success=="1"){var i="",g="恭喜您领取成功";return spWindow({id:"mxlibao520",title:i,content:g,bottom:"<a href='/account/cashcoupons/0/1' class='myInviteFrom_btn'>立即查看</a>",closeBtn:".title_closeBtn",titleColse:true,binder:function(){$(".title_closeBtn").click(function(){window.location.href=window.location.href})}}).show()}else{$(this).removeAttr("disabled");$(this).text("[立即领取]");alert(h.UserData.Message)}}})});$(".share_btn").delegate("a","click",function(){var g=$(this).attr("class");openShare(g,"",$("#shareArea").val());return false});$("#ztInvite_wrapper_backover").css("opacity",0.45)});var openShare=function(c,b,a){if(b==""){if(c=="renren"||c=="qzone"){b=document.location}else{b=document.location.href}}if(a==""){a=document.title}switch(c){case"weibo":void ((function(l,h,i){try{}catch(i){}var j="http://v.t.sina.com.cn/share/share.php?",m=b,k=["url=",i(m),"&title=",i(a),"&appkey=330242870"].join("");function g(){if(!window.open([j,k].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(l.width-620)/2,",top=",(l.height-450)/2].join(""))){m.href=[j,k].join("")}}if(/Firefox/.test(navigator.userAgent)){setTimeout(g,0)}else{g()}})(screen,document,encodeURIComponent));break;case"douban":void (function(){var f=document,g=encodeURIComponent,j=window.getSelection,k=f.getSelection,l=f.selection,i=j?j():k?k():l?l.createRange().text:"",h="http://www.douban.com/recommend/?url="+g(b)+"&title="+g(a)+"&sel="+g(i)+"&v=1",m=function(){if(!window.open(h,"douban","toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=355,left="+(screen.width-450)/2+",top="+(screen.height-330)/2)){location.href=h+"&r=1"}};if(/Firefox/.test(navigator.userAgent)){setTimeout(m,0)}else{m()}})();break;case"renren":void ((function(n,h,i){if(/renren\.com/.test(b)){return}var j="http://share.renren.com/share/buttonshare.do?link=",o=b,k=a,m=[i(o),"&title=",i(k)].join("");function g(){if(!window.open([j,m].join(""),"xnshare",["toolbar=0,status=0,resizable=1,width=626,height=436,left=",(n.width-626)/2,",top=",(n.height-436)/2].join(""))){o.href=[j,m].join("")}}if(/Firefox/.test(navigator.userAgent)){setTimeout(g,0)}else{g()}})(screen,document,encodeURIComponent));break;case"qzone":window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(b),"qzone","toolbar=0,status=0,width=900,height=760,left="+(screen.width-900)/2+",top="+(screen.height-760)/2);break;case"qweibo":window.open("http://v.t.qq.com/share/share.php?title="+encodeURIComponent(a)+"&url="+encodeURIComponent(b),"tqq","toolbar=0,status=0,width=700,height=360,left="+(screen.width-700)/2+",top="+(screen.height-600)/2)}};function sendEmails(){var a=$("#emailArea").val();$("#sendEmail").siblings(".form_succeed").attr("style","visibility:hidden;");if((a.length<1)||(a=='如果要对多个好友发送邀请Email，请用英文";"、","或回车隔开Email地址。')){windowAlert("提示","请填写Email");return false}$("#sendEmail").attr("disabled",true);$.ajax({type:"POST",url:"/account/invitefromemail",data:{emails:a},dataType:"json",success:function(b){$("#sendEmail").attr("disabled",false);if(b.UserData.Success=="1"){$("#emailArea").val("");$("#inviteSueecess").show();$("#inviteSueecess").find(".form_succeed").attr("style","visibility:visible;");setTimeout(function(){$("#inviteSueecess").find(".form_succeed").attr("style","visibility:hidden;")},2000)}else{windowAlert("提示",b.UserData.Message)}}})}function sendMobile(){var a=$("#mobileArea").val();$("#sendMobiles").siblings(".form_succeed").attr("style","visibility:hidden;");if((a.length<1)||(a=='如果要对多个好友发送邀请短信，请用英文";"、","或回车隔开手机号。')){windowAlert("提示","请填写手机号");return false}$("#sendMobiles").attr("disabled",true);$.ajax({type:"POST",url:'@Url.Action("InviteFromSms")',data:{mobiles:a},dataType:"json",success:function(b){$("#sendMobiles").attr("disabled",false);if(b.UserData.Success=="1"){$("#mobileArea").val("");$("#sendMobiles").siblings(".form_succeed").attr("style","visibility:visible;");setTimeout(function(){$("#sendMobiles").siblings(".form_succeed").attr("style","visibility:hidden;")},2000)}else{windowAlert("提示","发送失败！")}}})}function ActivateUserLevel(a,c,b){var e="/account/ActivateUserLevel?"+new Date().getTime();var d=false;$.ajax({type:"POST",url:e,data:{},timeout:12000,dataType:"json",error:function(g,f){},success:function(f){if(f.UserData.Success=="1"){var h="恭喜您成为"+b;ShowActivateUserLevel(a,c,h);return true}else{var g="您还需要验证手机和邮箱，补充此类信息才可以激活您的会员身份。";ShowActivateUserLevel(a,c,g);return false}}})}function ShowActivateUserLevel(a,c,b){spWindow({id:"window_"+a,style:{wrapper:{width:"380px"}},title:"激活提示",content:b,bottom:'<a href="#" class="spOrder_window_delbtn" onclick="window.location.href = window.location.href;">确定</a>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true}).show()}function CancelOrderFunc(a){var b="/account/CancelOrder?"+new Date().getTime();$.ajax({type:"POST",url:b,data:{OrderNo:a},timeout:12000,dataType:"json",error:function(d,c){},success:function(c){if(c.UserData.Success=="0"){alert("取消失败！");window.location.reload()}else{window.location.reload()}}})}function ConfirmGetGoodsFunc(a){var b="/account/ConfrimGoods?"+new Date().getTime();$.ajax({type:"POST",url:b,data:{OrderNo:a},timeout:12000,dataType:"json",error:function(d,c){},success:function(c){if(c.UserData.Success=="0"){alert("确认失败！");window.location.reload()}else{window.location.reload()}}})}function ChangeOrderView(b){var a=$("#orderView").select().val();window.location.href="/account/OrderList/"+a+"/1"}function ReturnOrderView(){var a=$("#orderView").select().val();if($("#chkOrder").attr("checked")){$("#orderView").attr("enabled",false);window.location.href="/orderlist.html?orderview=status0&list="+a}else{$("#orderView").attr("enabled",true);window.location.href="/orderlist.html?orderview="+a}}function bindmobile1Click(d,a){var c;var b;if((d=="mobile1"||d=="mobile2")&&a!=undefined){c=a}if((d=="email1"||d=="email2")&&a!=undefined){b=a}if((c==null||c==undefined)&&$("#mobile")!=null){c=$.trim($("#mobile").val())}if((b==null||b==undefined)&&$("#email")!=null){b=$.trim($("#email").val())}if(d=="mobile1"){tb_show("验证手机","/account/ModifyMobile?height=150&width=370&SendType=2&IsModify=0&Mobile="+c,false);return false}else{if(d=="mobile2"){tb_show("修改手机","/account/ModifyMobile?height=200&width=370&SendType=2&IsModify=1&Mobile="+c,false);return false}else{if(d=="email1"){tb_show("验证邮箱","/account/BindEmail?height=200&width=370&SendType=1&Email="+b,false);return false}else{if(d=="email2"){tb_show("修改邮箱","/account/ModifyEmail?height=200&width=370&SendType=1&Email="+b,false);return false}}}}}function cancelbindmobileemail(b){var a=$("#mobile").val();if(b=="mobile"){tb_show("解除验证手机","/account/CancelBind?height=120&width=370&SendType=2&Mobile="+$.trim(a),false)}return false}function getOrderProductColorAndSize(a,c,i,g,f,h,b){var e="/account/GetProductColorAndSize?"+new Date().getTime();var d=false;return $.ajax({type:"POST",url:e,data:{productNo:c,skuNo:i,skuAttrText:g,sizeStandard:f,skuHashText:h,productCategoryNo:b},timeout:12000,async:false,dataType:"json",success:function(j){if(j.UserData.Success=="1"){$("span#"+a+i).text(j.UserData.Message)}}})}if(typeof console=="undefined"){console={log:function(){}}}$(function(){$(".sp_newpai").delegate("input[type='text']","keyup",function(l){var n=$(this).val();var m=n.replace(/[^0-9\.]/ig,"");$(this).val(m)});if($("#spTabs").length>0){var j=SP.plug.tab.create({wrapper:"#spTabs",contentWrapper:"#spTabs_content",first:"mytab-1",trigger:"click",effector:"direct",curClass:"hover",auto:false})}if($("#spTabs").length>0){$("#spTabs").spTabs({tabId:"#spTabs_menu",tabTag:"span",conId:"#spTabs_content",conTag:".ac_listcon",curClass:"curr",act:"click"})}if($("#spTabsGift").length>0){var j=SP.plug.tab.create({wrapper:"#spTabsGift",contentWrapper:"#spTabs_contentGift",first:"mytab-1",trigger:"click",effector:"direct",curClass:"curr",auto:false})}$(".share_prod li").delegate("a","hover",function(){$(this).toggleClass("hover")});if($(".share_tips").length>0){$(".share_handle").spTips({tipID:".share_tips",closeID:".no",speed:"200"})}var e=function(l,n){var o=function(){var q=$(this).find("a").attr("bigImg"),s=$(this).offset().left,t=$(this).offset().top,w=$(window).scrollTop(),v=$(window).height(),u=(t-w)>v/2?"top":"bottom";if($(this).next(".bigImgBox").length==0){$(this).after('<div class="bigImgBox"></div>').next(".bigImgBox").append("<img width='240' src=\" "+q+'" />')}else{$(this).next(".bigImgBox").stop(false,true).fadeIn(300)}if(u=="top"){var r=$(this).next(".bigImgBox").find("img").width();var p=$(this).next(".bigImgBox").find("img").height();$(".bigImgBox").css({left:s-85,top:t-(240*p)/r-22})}else{$(".bigImgBox").css({left:s-85,top:t+100})}return false},m=function(){$(this).next(".bigImgBox").stop(false,true).fadeOut(300)};$(l).delegate(n,"mouseenter",o);$(l).delegate(n,"mouseleave",m)};e(".comment_imgs","li.commImg");if($(".favorite_delete").length>0){$(".favorite_delete").spTips({tipID:".favorite_tips",closeID:".no",speed:"200"})}if($(".couponsList td.link p").length>0){$(".couponsList td.link p").hover(function(){$(this).find(".couponsTips").show()},function(){$(this).find(".couponsTips").hide()})}$("input[name='checkall']").click(function(){$("input[name='favproductchecked']").attr("checked",this.checked);$("input[name='checkall']").attr("checked",this.checked)});var c=$("input[name='favproductchecked']");c.click(function(){$("input[name='checkall']").attr("checked",c.length==$("input[name='favproductchecked']:checked").length?true:false)});$(".myInvite_linkFrom").find("input[name='text']").click(function(){$(this).select()});var b=null;if($("#inviteurl").length>0){ZeroClipboard.setMoviePath("/scripts/live/dev/core/plug/ZeroClipboard.swf");function h(o,l,m){var n=arguments.length;b=new ZeroClipboard.Client();b.setHandCursor(true);b.addEventListener("mouseOver",function(p){b.setText(document.getElementById(o).value)});b.addEventListener("complete",function(p,q){if(n==3){document.getElementById(m).innerHTML="复制成功"}else{alert("复制成功: "+q)}});b.glue(l)}h("inviteurl","submit_btnid")}if($("#consigneeCount").val()>=10){$(".newAddr_Btn").hide()}$(".addr_Btn").click(function(){if($("#consigneeCount").val()<10){$(".myinfo_Notice span").text("新增收货地址");$(".newAddr_Btn").hide();$(".new_Addr").show()}else{windowAlert("提示","收货地址最多保存10个有效地址")}});$(".cancel_Btn").click(function(){if($("#consigneeCount").val()<10){$(".newAddr_Btn").show()}$(".new_Addr").hide()});$("#spAccount-myInvite_From textarea").focus(function(){if($(this).val()==this.defaultValue){$(this).val("");$(this).addClass("focus")}}).blur(function(){if($(this).val()==""){$(this).val(this.defaultValue);$(this).removeClass("focus")}});if($(".toActivate")){if($("#active_code")){$("#active_code").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"40px",top:"0px",zIndex:"999"},focStyle:{color:"#ccc",border:"1px solid #999",zIndex:"999"}})}$(".toActivate").bind("click",function(){$(this).hide();$("#active").show()});function a(n,m){var l=$(n);l.delegate("#active_btn","click",function(){var o=/^\w{10}$/i,p=$("#active_code").val();alert(p);if(p==""){$("#active_tipsbox").find("#txtTipsbox").html("请输入优惠券充值码！").end().show();return false}if(!o.test(p)){$("#active_tipsbox").find("#txtTipsbox").html("您输入的优惠券充值码有误，请重新输入!").end().show()}else{$(this).hide();$("#waitting").show();$.ajax({type:"POST",url:"/account/ActiveCashTicket?"+new Date().getTime(),data:{activeCode:p},timeout:12000,dataType:"json",success:function(q){if(q.UserData.Success=="1"){if(m){m(q.UserData.Message)}}else{$("#active_tipsbox").find("#txtTipsbox").html(q.UserData.Message).end().show();if(q.UserData.Data=="bind"){alert(q.UserData.Message);window.location="/account/information"}}$("#waitting").hide();$("#active_btn").show()}});setTimeout(function(){$("#waitting").hide();$("#active_btn").show()},400)}})}a("#active",function(l){$("#active_tipsbox").find("#txtTipsbox").addClass("succeed").html("您共充值成功<em> "+l+" </em>张优惠券").end().show();setTimeout(function(){location.href="/account/CashCoupons/0/1"},1000)});$("#active_tipsbox").delegate("#active_closebtn","click",function(){$(this).parent().hide()})}if($("#once_tipbox").length>0){var k=$("#once_tipbox"),d=k.offset().left+90,i=k.offset().top+8;$("#address_oncebox").css({left:d+"px",top:i+"px"});$("#know_addressinfo").bind("click",function(){$(this).closest(".comm_guidance").remove();return false})}if($(".ac_closebtn").length>0){$(".ac_closebtn,.quit_btn").bind("click",function(){var l=$(this).closest(".comm_guidance").attr("datajs");$(this).closest(".comm_guidance").remove();if(l==0){$("#tellme_set").remove()}else{if(l==1){$("#tellme_set"+l).remove()}}return false})}if($(".j_member_btn").length>0){$(".j_member_btn").bind("mouseenter",function(){var m=$(this).width(),l=$(this).outerHeight(true),n=$(this).offset().left-m/2,o=$(this).offset().top+l;if($(this).hasClass("j_bj")){$(".members_level").eq(1).css({left:n+"px",top:o+"px"}).show()}else{if($(this).hasClass("b_bj")){$(".members_level").eq(2).css({left:n+"px",top:o+"px"}).show()}else{if($(this).hasClass("z_bj")){$(".members_level").eq(3).css({left:n+"px",top:o+"px"}).show()}else{$(".members_level").eq(0).css({left:n+"px",top:o+"px"}).show()}}}}).bind("mouseleave",function(){if($(this).hasClass("j_bj")){$(".members_level").eq(1).hide()}else{if($(this).hasClass("b_bj")){$(".members_level").eq(2).hide()}else{if($(this).hasClass("z_bj")){$(".members_level").eq(3).hide()}else{$(".members_level").eq(0).hide()}}}});$(".members_level").bind({mouseenter:function(){$(this).show()},mouseleave:function(){$(this).hide()}})}if($("#simlar_favbox").length>0){var f=SP.config.lazyload.group("#simlar_favbox","#simlar_favbox img","index_b"),g=SP.plug.scroller.create("#simlar_favbox","#simlar_favbox ul","#simlar_favbox li").screenCount(5,0).up("#ac_leftbar",5,"click",function(){var l=this.count()-(this.screenCount||5);if(this.current()==0){this.current(l+5)}return true},function(l){},function(){f.grouper("index_b").each()}).down("#ac_rightbar",5,"click",function(){var l=this.count()-(this.screenCount||5);if(this.current()==l){this.current(-5)}return true},function(l){},function(){f.grouper("index_b").each()}).auto(5,"#ac_leftbar,#ac_rightbar,#simlar_favbox",false,function(){if(f&&f.grouper("index_b")){f.grouper("index_b").each()}})}});var stopTime={};function setRetime(b,a,e){var d=0,c;if(typeof stopTime[b]==="undefined"){stopTime[b]=false}if(d){return false}else{d=e;if(stopTime[b]==false){$(b).attr({value:"("+e+")"+a,disabled:"disabled"});stopTime[b]=true;c=setInterval(function(){d--;if(d>0){$(b).attr("value","("+d+")"+a)}else{$(b).attr("value",a).removeAttr("disabled");stopTime[b]=false;clearInterval(c);c=null}},1000)}}}function windowAlert(e,c,d,b){if(d==undefined){d=false}if(b==undefined){b="关闭"}var a;if(d){a='<a href="#" class="spOrder_window_delbtn" onclick="window.location.reload();" >'+b+"</a>"}else{a='<a href="#" class="spOrder_window_delbtn">'+b+"</a>"}if(bindWindow!=null){bindWindow.close(false)}spWindow({id:"window_alert"+new Date().getTime(),style:{wrapper:{width:"360px"}},title:e,content:c,bottom:a,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:false}).show()}$(function(){$(".prize_link").click(function(){$(".prize_tips").show();return false});$(".close_prize").click(function(){$(".prize_tips").hide()});$(".mail_table :checkbox").each(function(){$(this).attr("hidefocus","true")});$(".mail_table :checkbox").click(function(){if($(this).attr("checked")){$(this).next().addClass("fc_green").text("[订阅成功，点击取消订阅]")}else{$(this).next().removeClass("fc_green").text("我要订阅")}var e=$(this).val();var c=$(this).attr("Code");var d=1;if($(this).attr("checked")){d=1}else{d=0}b(e,c,d)});function b(e,c,d){var g="/account/MailRss?"+new Date().getTime();var f=false;return $.ajax({type:"POST",url:g,data:{RssType:e,Frequency:c,IsRss:d},timeout:12000,dataType:"json",async:true})}if($(".tellme_set").length>0){var a=$(".tellme_set");a.delegate("a","click",function(){var c=$(this).attr("datajs"),h=$(this).attr("rsstype"),e=$(this).width(),d=$(this).height(),f=$(this).offset().left-355+e,g=$(this).offset().top+d;if(c==0){b(h,1,1);$("#new_tellme").css({left:f+"px",top:g+"px"}).show()}else{if(c==1){b(h,2,1);$("#new_tellme"+c).css({left:f+"px",top:g+"px"}).show()}}return false})}});var stopTime={};function setRetime(b,a,e){var d=0,c;if(typeof stopTime[b]==="undefined"){stopTime[b]=false}if(d){return false}else{d=e;if(stopTime[b]==false){$(b).attr({value:"("+e+")"+a,disabled:"disabled"});stopTime[b]=true;c=setInterval(function(){d--;if(d>0){$(b).attr("value","("+d+")"+a)}else{$(b).attr("value",a).removeAttr("disabled");stopTime[b]=false;clearInterval(c);c=null}},1000)}}}function msgWindow(b,a){spWindow({id:b,style:{wrapper:{width:"400px",height:"260px"},content:{"margin-top":"50px"}},title:"",content:a,bottom:"",closeBtn:".title_closeBtn",titleColse:true,backover:true}).show()}$(function(){if($("#spTabs").length>0){var d=SP.plug.tab.create({wrapper:"#spTabs",contentWrapper:"#spTabs_content",first:"mytab-1",trigger:"click",effector:"direct",curClass:"curr",auto:false})}var b=$(".refund_info td a[prodid]");if(b.length>0){$(".refund_info td").delegate("a[prodid]","click",function(g){var h=$(this).attr("prodid");msgWindow(h,"抱歉！该商品已售罄，暂无可换商品");return false})}var f=null,c=null;$(".form_multitag").delegate("a","click",function(){$(this).addClass("curr").siblings("a").removeClass("curr");$(".form_selecttag").addClass("non");c=false;$(".form_navtag").removeClass("non")});$(".form_navtag").delegate("a","click",function(){var g=$(".form_multitag a.curr").text()+" - "+$(this).text();$(".form_selecttag").removeClass("non").find("em").text('"'+g+'"');$(".form_navtag").addClass("non");$("#refundDetailNo").val($(this).attr("no"));c=true;return false});if($("#spTabs").length>0){var d=SP.plug.tab.create({wrapper:"#spTabs",contentWrapper:"#spTabs_content",first:"mytab-1",trigger:"click",effector:"direct",curClass:"current",auto:false})}var f=null;$(".form_tag").delegate("a","click",function(){$(this).addClass("curr").siblings("a").removeClass("curr");var g=$(this).attr("data-rel");if(g=="1"){f=true}else{f=false}return false});$(".form_txtImg textarea").focus(function(){$(this).siblings("label").hide()}).blur(function(){if($(this).val()==""){$(this).siblings("label").show()}});$("#prodColor").change(function(){var g=$(this).val();$.ajax({type:"GET",dataType:"json",url:"/order/GetSkuList",data:{skuNo:g,r:Math.random()},success:function(h){$("#prodSize").empty();if(h.ok){$(h.li).each(function(){$("#prodSize").append("<option value='"+this.SkuNo+"' >"+this.SecondAttrText+"</option>")})}}})});$(".upload").click(function(){var g=$(".imgList li").length;if(g>=3){msgWindow("uploadErro","抱歉！最多只能传3张图片。")}});$(".imgList").delegate("li a.dot","click",function(){var h=$(this);h.closest("li").remove();var g=$(".imgList li").length;if(g<1){$(".imgList").hide()}else{$(".imgList").show()}if(g>2){$("#file_upload").hide()}else{$("#file_upload").show()}return false});$(".fillProduct li.over").append('<span class="overlay">该商品已退货</span>');var e=$(".fillProduct li.over").outerHeight();$(".applyProduct li.prodBox .overlay").css("height",e+"px");$(".fillProduct").delegate(".prodBox:not(.over)","click",function(){$(this).toggleClass("select");if($(".applyProduct li.select").length>1){$(".applyProduct li.prodDot").addClass("plus")}else{$(".applyProduct li.prodDot").removeClass("plus")}});var a=$(".refundApply_form .imgList");if(a.length>0){$("#file_upload").uploadify({width:76,height:24,multi:true,swf:"/Content/flash/uploadify.swf",uploader:"/Member/ajaxuploadexperiencereportImg",overrideEvents:["onUploadProgress"],fileTypeExts:"*.gif; *.jpg; *.png; *.jpeg",queueSizeLimit:"3",fileSizeLimit:"819200B",onSelectError:function(i,g,h){switch(g){case -100:this.queueData.errorMsg="上传的文件数量已经超出系统限制！";break;case -110:this.queueData.errorMsg="文件 ["+i.name+"] 大小超出系统限制！";return false;break;case -120:this.queueData.errorMsg="文件 ["+i.name+"] 大小异常！";break;case -130:this.queueData.errorMsg="文件 ["+i.name+"] 类型不正确！";break}},onUploadSuccess:function(j,h,n){if(h=="error"){$("#file_upload-queue .uploadprogress").hide();return false}else{var i=h.split("+"),m=0,k=j.id}a.prepend($("<li>").attr({id:"mx_"+k,fno:i[2]}));var k=j.id,g=$("#mx_"+k);if(g.length>0){g.html('<img src="'+i[0]+"\" /><a href='#' class='dot'></a>")}$("#file_upload-queue").html("");var l=$(".imgList li").length;if(l<1){$(".imgList").hide()}else{$(".imgList").show()}if(l>2){$("#file_upload").hide()}else{$("#file_upload").show()}},onUploadProgress:function(g){return false},onUploadStart:function(g){$("#file_upload-queue").html('<span class="uploadprogress">正在上传</span>')}})}$(".refundApply_form").delegate("#applyBtn","click",function(){var q,i=$(".imgList li").length,l=$(".applyProduct li.select").length,g=$("#bankName").val(),r=$("#userName").val(),s=$("#userNum").val(),h=$("#confirmNum").val(),o=$("#refundReson").val();if($(".form_tag a.curr").length==0){q=0}else{q=1}if(c!=true){q=0}else{q=1}if(q==0){msgWindow("tagErro","请选择退货原因!");return false}else{if(o.length!=0&&o.length>100){$("#errMsg").addClass("error").html("字数超出最大限度100!");return false}else{if(f==true&&i==0){msgWindow("imgErro","请上传商品图片!");return false}else{if(l==0){msgWindow("prodErro","请选择退货商品!");return false}else{if(g<0){$("#bankName").closest("td").addClass("error").find("span").html("请选择银行!");return false}else{if(r==""){$("#userName").closest("td").addClass("error").find("span").html("请填写开户人姓名!");$("#bankName").closest("td").removeClass("error").find("span").html("");return false}else{if(s==""){$("#userNum").closest("td").addClass("error").find("span").html("请填写开户银行账号!");$("#userName").closest("td").removeClass("error").find("span").html("");return false}else{if(h==""){$("#confirmNum").closest("td").addClass("error").find("span").html("请确认银行账号!");$("#userNum").closest("td").removeClass("error").find("span").html("");return false}else{if(s!=h){$("#confirmNum").closest("td").addClass("error").find("span").html("两次填写银行账号不一致!");$("#userNum").closest("td").removeClass("error").find("span").html("");return false}else{$("#bankName, #userName, #userNum, #confirmNum").closest("td").removeClass("error").find("span").html("");$("#errMsg").removeClass("error").find("span").html("")}}}}}}}}}var k="";$(".imgList li").each(function(){k+=$(this).attr("fno")+","});var m=$("#refundDetailNo").val();var n=o;var p="";var j="";$(".applyProduct li.select").each(function(){p+=$(this).find("p").attr("sno")+",";j+=$(this).find("p").attr("id")+","});if($("#odetailNo").length>0&&$("#skuno").length>0){p=$("#skuno").val();j=$("#odetailNo").val()}$.ajax({type:"Post",dataType:"json",url:"/order/confirmrefundapply",data:{refundRemarkType:"0",returnReasonDetailNo:m,refundReson:n,picIDs:k,bankID:g,bankUser:r,bankNo:s,consigneeOne:$("#consigneeName").val(),consigneeMobOne:$("#consigneeMobile1").val(),consigneeTwo:$("#newUser").val(),consigneeMobTwo:$("#userTel").val(),skuNos:p,orderdetailNos:j,orderNo:$("#oNo").val()},success:function(t){if(t.Success){window.location.href="/order/refundapplyinfo?RefundApplyNo="+t.Result}else{msgWindow("errMsg",t.ErrorMsg)}}});return false});$(".refundApply_form").delegate("#replaceBtn","click",function(){var r=$(".form_tag a.curr").length,i=$("#prodColor").val(),p=$("#prodSize").val();var q=$("#SkuNo").val();var n=$("#OrderNo").val();if(c!=true){r=0}else{r=1}if(r==0){msgWindow("tagErro","请选择换货原因!");return false}else{if(i<0){msgWindow("colorErro","请选择可换颜色!");return false}else{if(i>0&&p<0){msgWindow("sizeErro","请选择可换尺码!");return false}}}var o=$("#refundDetailNo").val();var g=$("#returnReasonAppendId").val();if(g.length>200){msgWindow("areason","换货原因补充问题描述不可超过200字符");return false}var h=$("#prodSize").val();if(h==null||h.length<1){msgWindow("skuno","抱歉！该商品已下架或售罄，暂无可换商品");return false}var j=$("input[name = 'addr']:checked").val();if(typeof(j)=="undefined"){msgWindow("consignee","请选择快递信息");return false}var s=$("input[name = 'express']").val();var k=$("#newUser").val();var l=$("#userTel").val();var m=$("#OrderDetailNo").val();$.ajax({type:"POST",url:"/order/confirmrefundreplace",data:{ReturnReasonDetailNo:o,ReturnReasonAppendText:g,ChangeSkuNo:h,SkuNo:q,ConsigneeId:j,ChangeTimeType:s,NewContactPerson:k,NewContactPersonMobile:l,OrderNo:n,r:Math.random(),OrderDetailNo:m},dataType:"json",success:function(t){if(t.ok){window.location.href="/order/refundreplaceinfo?applyOrderNo="+t.message+""}else{msgWindow("tagErro2",t.message)}}});return false});$(".returnorder").click(function(){var i=$(this).attr("productno");var h=$(this).attr("orderno");var g=$(this).attr("orderdetailno");var j=$(this).attr("skuno");var k=$(this).attr("type");if(k==2){j=""}$.ajax({type:"Post",url:"/order/validateissubmitreturnorder",data:{productNo:i,orderNo:h,orderDetailNo:g,skuNo:j,type:k},dataType:"json",success:function(l){if(l.success){window.location.href="/order/refundapply/?orderno="+h+"&skuno="+j+"&type="+k}else{msgWindow("tagErro2",l.message)}}});return false});$(".refund_info").delegate(".changeorder","click",function(){var i=$(this).attr("productno");var h=$(this).attr("orderno");var g=$(this).attr("orderdetailno");var j=$(this).attr("skuno");$.ajax({type:"Post",url:"/order/validateIssubmitchangeorder",data:{productNo:i,orderNo:h,orderDetailNo:g,skuNo:j},dataType:"json",success:function(k){if(k.success){window.location.href="/order/refundreplace/"+g+"/"+j}else{msgWindow("tagErro2",k.message)}}});return false})});$(function(){var b='<a href="#" id="sendit" class="spOrder_window_submit">确　认</a><a href="#" class="spOrder_window_delbtn">取消</a>';var a=$("#picBackground").val();var c="<div id='upload_lay'><input id='file_upload' name='file_upload' type='file'><span>仅支持JPG、GIF、PNG图片文件，且文件小于2M</span><dl id='clip_box'><dd id='photo_box'><img id='photo' src='"+a+"' alt='' /></dd><dd id='thumb_box'><div id='thumb'></div>180*180像素<a href='#' id='submit_upload'>确 定</a></dd></dl></div>";var e={left:0,top:0,width:0,height:0};var g=null;$("#avatar_upbtn").bind("click",function(k){var j=$(this).attr("id");var l=spWindow({id:"window_"+j,style:{wrapper:{width:"600px"}},title:"",content:c,closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:true,backover:true,binder:function(){$("#window_"+j).find(".title_closeBtn").on("click",function(){$(".imgareaselect-outer,.imgareaselect-handle").remove();document.location.reload()});$("#file_upload").uploadify({swf:"/Swf/uploadify.swf",uploader:"/member/UploadHeadPic",height:18,width:80,fileTypeExts:"*.gif; *.jpg; *.png; *.jpeg",fileSizeLimit:"2048KB",queueSizeLimit:"1",buttonText:"选择照片",onSelectError:function(p,n,o){switch(n){case -100:this.queueData.errorMsg="上传的文件数量已经超出限制的个数！";break;case -110:this.queueData.errorMsg="文件大小超出限制！";break;case -120:this.queueData.errorMsg="文件大小异常！";break;case -130:this.queueData.errorMsg="文件类型不正确！";break}},onUploadStart:function(n){$("img#photo").attr("src","/images/e.gif").parent().addClass("up_loading")},onUploadSuccess:function(q,p,x){var v=$.parseJSON(p);$("img#photo").parent().removeClass("up_loading");$("#picUrl").val(v.message);$("#picNo").val(v.fileNo);var t=v.message,u=0,s=0,r=new Image();r.src=t;r.complete?n():o();function n(){u=r.width;s=r.height;w()}function o(){r.onload=function(){u=this.width;s=this.height;w()}}function w(){$("#photo").attr("src",t);f("#photo",u,s);if(g){$("#thumb").find("img").attr("src",t)}m()}$("#submit_upload").on("click",function(){var C=e.left;var D=e.top;var B=e.width;var z=e.height;var A=$("#picNo").val();$.ajax({type:"get",url:"/member/ClapPic",data:{picNo:A,x:C,y:D,width:B,height:z,ran:Math.random()},success:function(y){if(y.ok=="1"){var F=y.message;$("#picHead").attr("src",F);var E=y.picNo;doWithPic(E)}else{}},dataType:"json"});$(".imgareaselect-outer,.imgareaselect-handle").remove();l.close();return false})}});function m(){g=$("img#photo").imgAreaSelect({handles:true,maxWidth:280,maxHeight:280,aspectRatio:"1:1",zIndex:2147483647,onInit:d,onSelectStart:d,onSelectChange:i,onSelectEnd:h,instance:true})}}}).show();return false});function f(j,l,k){$(j).each(function(){var s=l,r=k,o=parseInt($(this).parent().css("width")),n=parseInt($(this).parent().css("height")),q=s/r,m=o/n,p=n/q,t=n-p;if(q>=m){$(this).css({width:o+"px",height:"auto","margin-top":parseInt(t/2)+"px"})}else{$(this).css({width:"auto",height:n+"px"})}})}function i(j,m){if(!m.width||!m.height){return}var k=180/m.width,l=180/m.height;$("#thumb img").css({width:Math.round(k*j.width),height:Math.round(l*j.height),marginLeft:-Math.round(k*m.x1),marginTop:-Math.round(l*m.y1)})}function d(j,k){$(j).clone().removeAttr("id style").appendTo($("#thumb").empty())}function h(j,k){e.left=k.x1;e.top=k.y1;e.width=k.width;e.height=k.height;$("#submit_upload").show()}$("#syn_setting").on("click",function(j){SP.weibo.login(function(k){this.getUserInfo(function(l){doWithWeiBo(l.avatar_large,l.screen_name,l.idstr)})})})});function doWithPic(a){$.ajax({type:"get",url:"/account/DoWithHeadPic",data:{pictureNo:a,ran:Math.random()},success:function(b){if(b.ok=="1"){$(".imgareaselect-outer,.imgareaselect-handle").remove();window.location.reload()}else{alert(b.message)}},dataType:"json"})}function doWithWeiBo(b,a,c){$.ajax({type:"get",url:"/account/DoWithWeiBo",data:{headPic:b,nickName:a,weiboUserID:c,ran:Math.random()},success:function(d){if(d.ok=="1"){if(d.message=="00"){$("#picHead").attr("src",b);$("#NickName").val(a)}else{if(d.message=="01"){$("#picHead").attr("src",b)}else{if(d.message=="10"){$("#NickName").val(a)}else{}}}$("#syn_tavatar").hide()}else{}},dataType:"json"})};