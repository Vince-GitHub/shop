var emailcodeurl=$("#NewShangPinLoginDomainUrl").val()+"/login/VerifyLoginHandlerII?type=shangpin_account_bind1&v=";var mobilecodeurl=$("#NewShangPinLoginDomainUrl").val()+"/login/VerifyLoginHandlerII?type=shangpin_account_bind2&v=";$(function(){function m(u,s,p,t,q){if(null==t){t="1900"}if(null==q){q=new Date().getFullYear()}for(;q>=t;q--){$("#"+u).append("<option value="+q+">"+q+"</option>")}for(var r=1;r<=12;r++){$("#"+s).append("<option value="+r+">"+r+"</option>")}if(null!=p){$(function(){$("#"+u).change(function(){g($("#"+u).val(),$("#"+s).val(),p)});$("#"+s).change(function(){g($("#"+u).val(),$("#"+s).val(),p)})});g($("#"+u).val(),$("#"+s).val(),p)}}function h(p){if((p%4==0&&p%100!=0)||(p%400==0)){return true}return false}function g(u,r,t){if(null!=u&&null!=r&&!isNaN(u)&&!isNaN(r)){var s=[31,28,31,30,31,30,31,31,30,31,30,31];var p=(h(u)&&r==2)?s[r-1]+1:s[r-1];$("#"+t+">option").remove();$("#"+t).append("<option value='0'>请选择</option>");for(var q=1;q<=p;q++){$("#"+t).append("<option value="+q+">"+q+"</option>")}}}new m("year","month","day","1900",new Date().getFullYear());var n={},c={},b=function(q,p){if(p.length>0){}},i=function(r){var p={msg:"",prevstr:"",bindto:"",type:""};$.extend(p,r);var t,q,s;if(p.prevstr&&p.bindto){s=$(p.bindto).closest("dd");s.find("[altype='errorbox']").hide();if(!c[p.prevstr]){t=$('<p altype="errorbox"></p>').html("<i></i><em><b></b></em>").addClass("clr");s.append(t);q=c[p.prevstr]=t}else{q=c[p.prevstr]}if(p.type=="error"){s.addClass("error");q.find("i").show();q.find("em").empty().append("<b></b>"+p.msg);q.show();s.find("i.form_succeed").hide()}else{if(p.type=="success"){s.removeClass("error");q.find("i").hide();q.find("em").empty().append("<b></b>"+p.msg);q.hide();if(s.find("i.form_succeed").length==0){s.append('<i class="form_succeed">&nbsp;</i>')}else{s.find("i.form_succeed").show()}}else{if(q.find("em").has("b")){s.removeClass("error");s.find("i.form_succeed").hide();q.find("i").hide();q.find("em").empty().append("<b></b>"+p.msg);q.show()}}}}},j=function(p){c[p]&&c[p].hide()},o=SP.plug.valid;n.group=SP.plug.formcheck.group("userinfo");if($("#info_usernickname").length>0){$("#info_usernickname").bind("focus",function(){i({msg:"此项为必填项",prevstr:"info_usernicknameMsg",bindto:$("#info_usernickname"),type:"normal"})});n.usernickname=n.group.add({elem:"#info_usernickname",event:"blur",check:function(){this.init();var q=$.trim(this.value()),p=this;if(q==""){this.reject("昵称不能为空");return}else{if(q.length<2){this.reject("昵称不得少于2个字");return}else{if(q.length>20){this.reject("昵称不得超过20个字");return}}}this.resolve("昵称填写正确")},done:function(){i({msg:"此项为必填项，方便我们与您联系",prevstr:"info_usernicknameMsg",bindto:$("#info_usernickname"),type:"success"})},fail:function(){i({msg:this.message,prevstr:"info_usernicknameMsg",bindto:$("#info_usernickname"),type:"error"})}})}if($("#info_username").length>0){n.username=n.group.add({elem:"#info_username",event:"blur",check:function(){this.init();var q=$.trim(this.value()),p=this;if(q.length==0){this.resolve("真实姓名填写正确");return}else{if(q.length<2){this.reject("真实姓名不得少于2个字");return}else{if(q.length>20){this.reject("真实姓名不得超过20个字");return}}}this.resolve("真实姓名填写正确")},done:function(){i({msg:"此项为必填项，方便我们与您联系",prevstr:"info_usernameMsg",bindto:$("#info_username"),type:"success"})},fail:function(){i({msg:this.message,prevstr:"info_usernameMsg",bindto:$("#info_username"),type:"error"})}})}if($(".user_month select").length>0){n.month=n.group.add({elem:"#year, #month, #day",event:"change",value:function(){var p=$(".user_month select"),s=-1,t;for(var q=0,r=p.length;q<r;q++){t=$(p[q]).val();if(t==-1){return -1}s=t}return s},check:function(){this.init();var q=this.value(),p=this;if(q==0){this.reject("请选择生日");return}this.resolve("ok")},done:function(){i({msg:"",prevstr:"user_month",bindto:$("#day"),type:"success"})},fail:function(){i({msg:this.message,prevstr:"user_month",bindto:$("#day"),type:"error"})}})}if($("#info_addr").length>0){n.infoaddr=n.group.add({elem:"#info_addr",event:"blur",check:function(){this.init();var q=$.trim(this.value()),p=this;if(q.length==0){}else{if(q.length<5||q.length>100){this.reject("请输入正确联系地址！");return}}this.resolve("联系地址填写正确")},done:function(){i({msg:"",prevstr:"consnee_addrMsg",bindto:$("#info_addr"),type:"success"})},fail:function(){i({msg:this.message,prevstr:"consnee_addrMsg",bindto:$("#info_addr"),type:"error"})}})}if($("#info_code").length>0){n.infocode=n.group.add({elem:"#info_code",event:"blur",check:function(){this.init();var q=$.trim(this.value()),p=this;if(q==""){}else{if(!o(q,"postcode")){this.reject("邮政编码有误，请重新输入");return}else{if(q.length!=6){this.reject("请输入6位邮政编码");return}}}this.resolve("邮编填写正确")},done:function(){i({msg:"",prevstr:"info_codeMsg",bindto:$("#info_code"),type:"success"})},fail:function(){i({msg:this.message,prevstr:"info_codeMsg",bindto:$("#info_code"),type:"error"})}})}if($("#info_submit").length>0){$("#info_submit").bind("click",function(){n.group.submit(function(){InfomationSubmit()})}).hover(function(){n.group.preventAll()},function(){n.group.promiseAll()});$("#info_submit").bind("keypress",function(p){if(p.keyCode==13){p.preventDefault();n.group.submit(function(){InfomationSubmit()})}})}function e(s,r){for(var p=0;p<s.length;p++){var q=s.substr(p,1);if(!o(q,r)){return false}}return true}$(document).delegate(".consumption-log","click",function(){var p=$(this).attr("logid"),r='<a href="javascript:;" id="lookLog" class="spOrder_window_submit activeComm_btns">返回</a>',s="",q="",u="",t="";$.ajax({type:"GET",dataType:"json",url:"/data/cost_log.txt?"+p,success:function(w){q='<table class="cart-costinfo">								<tr>									<td>卡片类型：'+w.info.cartType+"</td>									<td>卡号："+w.info.cartNum+"</td>									<td>面值："+w.info.faceVal+" </td>								</tr>								<tr>									<td>卡内余额："+w.info.left+"</td>									<td>卡状态："+w.info.status+" </td>									<td>有效期："+w.info.indate+"</td>								</tr>							</table>";if(w.list.length&&w.list){for(var x=0,y=w.list.length;x<y;x++){t+='<tr>							<td><a href="'+w.list[x].linkUrl+'" class="ac_gold">'+w.list[x].orderNum+"</a></td>							<td>"+w.list[x].time+"</td>							<td>"+w.list[x].type+"</td>							<td>"+w.list[x].before+"</td>							<td>"+w.list[x].changeVal+"</td>							<td>"+w.list[x].after+"</td>						</tr>"}u='<div class="costinfo-listbox"><table class="costinfo-list">							<thead>								<tr>									<th>订单号</th>									<th>时间</th>									<th>类型</th>									<th>变动前</th>									<th>变动金额</th>									<th>变动后</th>								</tr>							</thead>							<tbody>							'+t+"							</tbody>						</table></div>";s=q+u}else{s=q+"<b>您暂时还没有消费记录</b>"}var v=spWindow({id:"window_"+p+Math.random(),style:{wrapper:{width:"600px"},content:{"font-size":"12px"}},title:"查看卡片消费记录",content:s,bottom:r,closeBtn:".spOrder_window_submit, .title_closeBtn",titleColse:true,backover:true}).show()}});return false});var k=[],l=[],d=0;$(".member_userinfo_mysize").delegate("input[type='text']","keyup",function(p){var r=$(this).val();var q=r.replace(/[^0-9\.]/ig,"");$(this).val(q)});$(document).delegate("input.mysize_editbtn","click",function(){$(this).hide().siblings("input").show().closest("table.member_userinfo_mysize").addClass("member_userinfo_mysizeedit");$(".member_userinfo_mysize").find('input[type="text"],select').attr("disabled",false)});$(document).delegate("input.mysize_savebtn,input.mysize_canlebtn","click",function(){$("input.mysize_savebtn,input.mysize_canlebtn").hide().siblings("input.mysize_editbtn").show().closest("table.member_userinfo_mysize").removeClass("member_userinfo_mysizeedit");if($(this).hasClass("mysize_savebtn")){d=1;for(var p=0;p<k.length;p++){if(k[p].value!=$("[name="+k[p].name+"]").val()){l[p].value=$("[name="+l[p].name+"]").val();d=1}}if(d){$.ajax({type:"POST",url:"/Account/Informations",data:$("#accountfrom").serialize(),beforeSend:function(){$(".member_userinfo_mysize").find('input[type="text"],select').attr("disabled",true);a.text("正在提交数据...").show()},success:function(q){k=l;d=0;a.text("保存成功！").stop(true,true).fadeIn().delay(2000).fadeOut()},error:function(q){a.text("提交失败！").show()}})}else{a.text("未修改！").stop(true,true).fadeIn().delay(2000).fadeOut()}}else{f(k)}$(".member_userinfo_mysize").find('input[type="text"],select').attr("disabled",true)});var f=function(p){for(var q=0;q<p.length;q++){$("[name="+p[q].name+"]").val(p[q].value)}};var a=$("#mysize_msg");a.text("").hide();$(".member_userinfo_mysize").find('input[type="text"],select').attr("disabled",true)});function ShowConsigneeSave(a){spWindow({id:"window_ShowConsigneeSaveSuccess",style:{wrapper:{width:"380px"}},title:"保存提示",content:'<i class="form_succeed">'+a+"</i>",bottom:'<a href="#" onclick="window.location.href=\'/account/Information\';" class="spOrder_window_delbtn">确定</a>',closeBtn:".spOrder_window_delbtn, .title_closeBtn",titleColse:false,backover:true}).show()}function InfomationSubmit(){$.ajax({type:"POST",url:"/Account/AccountInfo",data:$("#accountfrom").serialize(),beforeSend:function(){$(".member_userinfo_mysize").find('input[type="text"],select').attr("disabled",true)},success:function(a){if(a.UserData.Success=="1"){ShowConsigneeSave("保存成功")}else{ShowConsigneeSave(a.UserData.Message)}},error:function(a){ShowConsigneeSave("提交失败")}})};