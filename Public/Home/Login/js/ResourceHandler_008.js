$(function(){var D={},l={},q={},i={},o={},b={},r=function(X,Z,v){var aa,W,n,Y;if(Z&&v){if(!b[Z]){b[Z]=$(v).siblings("span")}Y=b[Z];Y.html(X);Y.css({display:"block"})}},s=function(n){b[n]&&b[n].css({display:"none"})},U=SP.plug.valid;D.group=SP.plug.formcheck.group("signin");l.group=SP.plug.formcheck.group("mailup");q.group=SP.plug.formcheck.group("mobileup");i.group=SP.plug.formcheck.group("forgetPsd");o.group=SP.plug.formcheck.group("mobilecode");var j=function(){if(navigator.appName=="Microsoft Internet Explorer"){var n=event.keyCode}else{var n=j.caller.arguments[0].which}return n};$(".txt_input").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"20px",top:0,display:"block"},focStyle:{color:"#fff",border:"1px solid #666",display:"none"}});D.password=D.group.add({elem:"#spSignin_password",event:"blur",check:function(){this.init();var v=$.trim(this.value()),n=this;if(v==""){this.reject("密码不能为空");return}if(v.length<6){this.reject("密码长度为6-20位");return}if(v.length>20){this.reject("密码长度为6-20位");return}this.resolve("密码正确")},done:function(){r(this.message);s("signin_password")},fail:function(){r(this.message,"signin_password",$("#spSignin_password"))}});D.code=D.group.add({elem:"#spSignin_code",event:"blur",check:function(){this.init();if(!$("#spSignin_code").is(":visible")){this.resolve("验证码正确");return true}var v=$.trim(this.value()),n=this;if(v==""){this.reject("验证码不能为空");return}this.resolve("验证码正确")},done:function(){r(this.message);s("signin_code")},fail:function(){r(this.message,"signin_code",$("#spSignin_code"))}});$("#spSignin_btn").bind("click",function(){D.username=D.group.add({elem:"#spSignin_username",event:"blur",check:function(){this.init();var W=$.trim(this.value()),v=this;if(W==""){this.reject("账号名不能为空");return}else{if(!U(W,"email")&&!U(W,"mobile")){this.reject("请输入正确的邮箱地址或手机号码");return}}this.resolve("账号名填写正确")},done:function(){r(this.message);s("signin_username")},fail:function(){r(this.message,"signin_username",$("#spSignin_username"))}});var n=function(){$("#spSignin_btn").show().closest("dd").find("i").remove()};D.group.submit(function(){$("#spSignin_btn").hide().closest("dd").append('<i class="loading">正在登录...</i>');var v=$("#formlogin").attr("action");$.ajax({type:"POST",url:v,data:$("#formlogin").serialize(),timeout:12000,error:function(X,W){D.password.reject(W);n();return false},success:function(W){if(W.UserData.Success){G(W.UserData);if(window.localStorage){window.localStorage.setItem("lastNicks",$("#spSignin_username").val())}}else{changeCaptchCode();if(W.UserData.ShowValidCode=="1"){$("#spSignin_code_dd").show()}if(W.UserData.ErrCode=="83392ea9"){n();D.username.reject(W.UserData.Message)}else{if(W.UserData.ErrCode=="0c3d5471"){n();D.code.reject(W.UserData.Message)}else{if(W.UserData.ErrCode=="d3777f6a"){$("#spSignin_code_dd").show();n();D.code.reject(W.UserData.Message)}else{n();D.password.reject(W.UserData.Message)}}}}return false},dataType:"JSON"});r("提交成功")});return false}).hover(function(){D.group.preventAll()},function(){D.group.promiseAll()});var Q=$("#spSignin_username"),I,S=$(".username_select ul"),O=S.length,R=$("#userNameListIndex"),P=["qq.com","163.com","126.com","sina.com","hotmail.com","sohu.com","gmail.com","tom.com","139.com","263.com"];S.hide();if(window.localStorage){if(window.localStorage.getItem("lastNicks")&&Q.val()==""){Q.val(window.localStorage.getItem("lastNicks")).parent("div").find("label").hide()}}var z=function(){var W=j();var aa=R.val()==""?-1:R.val();if(W==40||W==38||W==13){var Z;if(W==40){aa++;if(aa==S.find("li").length){aa=0;S.find("li").eq(S.find("li").length-1).css("background-color","")}Z=S.find("li").eq(aa);S.find("li").eq(aa-1).css("background-color","");Z.css("background-color","#eee");R.val(aa);Q.val(Z.text())}else{if(W==38){aa--;if(aa<=-1){aa=S.find("li").length-1;S.find("li").eq(0).css("background-color","")}S.find("li").eq(aa+1).css("background-color","");Z=S.find("li").eq(aa);Z.css("background-color","#eee");R.val(aa);Q.val(Z.text())}else{if(W==13){R.val("-1");var n=S.find("li").eq(aa).text();var ab=Q.val();if(n==ab){Q.val(n)}S.html("");S[0].style.display="none";S.hide();Q.parents("dd").next("dd").find("input").focus()}}}}else{if(Q.val().indexOf("@")>-1&&O>0){var Y=$.trim(Q.val()).split("@")[0];S.show();var ad=Q.val().substr(Q.val().indexOf("@")+1),ac,X=[];if(ad===""&&S.find("li").length==0){S.empty();for(var v=0;v<P.length;v++){S.append("<li>"+Y+"@"+P[v]+"</li>")}return P}for(var v=0;v<P.length;v++){ac=P[v];if(ac.indexOf(ad)===0){X.push(ac)}}if(X.length>0){S.empty();for(var v=0;v<X.length;v++){S.append("<li>"+Y+"@"+X[v]+"</li>")}}else{S.hide()}return X}else{S.hide();R.val("-1")}I=$.trim(Q.val())}};Q.keyup(z);Q.focus(z);Q.blur(function(){if(Q.val!=""&&Q.parents("dd").find("label").is(":hidden")){S.hide();Q.parents("dd").next("dd").find("input").focus()}});S.delegate("li","mouseover",function(n){n.preventDefault();var v=R.val()==""?-1:R.val();if(v<=0){v=0}S.find("li").eq(v).css("background-color","");$(this).css("background-color","#eee");R.val(v);Q.val($(this).text())});S.delegate("li","mouseleave",function(n){n.preventDefault();var v=R.val()==""?-1:R.val();if(v<=0){v=0}$(this).css("background-color","");R.val("-1")});$("#spSignin_username,#spSignin_password,#spSignin_code").bind("keypress",function(n){if(n.keyCode==13){n.preventDefault();if(SP.isWeiboReady&&SP.weibo.sinaData){bindSignInSubmit()}else{$("#spSignin_btn").click()}}});l.password=l.group.add({elem:"#spSignup_password",event:"blur",check:function(){this.init();var v=$.trim(this.value()),n=this;if(v==""){this.reject("密码不能为空");return}if(v.length<6){this.reject("密码长度为6-20位");return}if(v.length>20){this.reject("密码长度为6-20位");return}this.resolve("密码输入成功");return},done:function(){r(this.message);s("mailup_password")},fail:function(){r(this.message,"mailup_password",$("#spSignup_password"))}});l.passwordRecheck=l.group.add({elem:"#spSignup_passwordRecheck",event:"blur",check:function(){this.init();var W=$.trim(this.value()),n=$.trim(l.password.value()),v=this;if(W==""){this.reject("密码不能为空");return}if(W!=n){this.reject("两次密码输入不一致");return}this.resolve("密码校验成功")},done:function(){r(this.message);s("mailup_passwordrecheck")},fail:function(){r(this.message,"mailup_passwordrecheck",$("#spSignup_passwordRecheck"))}});l.code=l.group.add({elem:"#spSignup_code",event:"blur",check:function(){if(y()=="1"){this.resolve("验证码正确");return true}this.init();var v=$.trim(this.value()),n=this;if(v==""){this.reject("验证码不能为空");return}this.resolve("验证码正确")},done:function(){r(this.message);s("mailup_code")},fail:function(){r(this.message,"mailup_code",$("#spSignup_code"))}});l.sex=l.group.add({elem:null,event:null,value:function(){var n=$("input[name='Gender']:checked");return n.length==1?n.val():-1},check:function(){this.init();var v=this.value(),n=this;if(v<0){this.reject("请选择性别");return}this.resolve("ok")},done:function(){s("mailup_sex")},fail:function(){r(this.message,"mailup_sex",$("#spup_sex_man_lab"))}});var E=function(){$("#spup_btn").show().closest("dd").find("i").remove()};$("#spup_btn").bind("click",function(){if(y()=="2"){l.useremail=l.group.add({elem:"#spMailup_email",event:"blur",check:function(){this.init();var v=$.trim(this.value()),n=this;if(v==""){this.reject("邮箱不能为空");return}else{if(!U(v,"email")){this.reject("请输入正确的邮箱地址");return}}this.resolve("邮箱名填写正确")},done:function(){r(this.message);s("spMailup_email")},fail:function(){r(this.message,"spMailup_email",$("#spMailup_email"))}})}l.group.submit(function(){if(y()=="1"){var n="/login/MobileRegisterPreValid?v="+Math.random();$.ajax({type:"POST",url:n,data:$("#formRegist").serialize(),timeout:12000,error:function(W,v){l.sex.reject(v);E();return},success:function(v){if(v.UserData.Success){B()}else{if(v.UserData.ErrCode=="d3777f6b"||v.UserData.ErrCode=="0c3d5471"){changeCaptchMobileCode();$("#divnamemobilevcode").show();E();l.mobileimgnum.reject(v.UserData.Message);return false}else{changeCaptchMobileCode();if(v.UserData.ErrCode=="9d1dfdb4"){l.password.reject(v.UserData.Message);E();return false}}}},dataType:"JSON"});return false}$("#spup_btn").hide().closest("dd").append('<i class="loading">正在提交...</i>');f(y())});return false}).hover(function(){l.group.preventAll()},function(){l.group.promiseAll()});var f=function(n){var v=$("#formRegist").attr("action");$.ajax({type:"POST",url:v,data:$("#formRegist").serialize(),timeout:12000,error:function(X,W){l.sex.reject(W);E();return},success:function(W){if(W.UserData.Success){G(W.UserData)}else{if(W.UserData.ErrCode=="d3777f6c"){changeCaptchMobileIICode();$("#mobileCode_btn").show().closest("dd").find("i").remove();E();o.code.reject(W.UserData.Message);return false}else{if(W.UserData.ErrCode=="d3777f6a"||W.UserData.ErrCode=="0c3d5471"){changeCaptchSignUpCode();$("#spSignup_code_dd").show();E();l.code.reject(W.UserData.Message);return false}else{changeCaptchSignUpCode();if(W.UserData.ErrCode=="f5cb9a37"||W.UserData.ErrCode=="e7d7f715"||W.UserData.ErrCode=="de0718a6"){E();l.useremail.reject(W.UserData.Message);return false}if(W.UserData.ErrCode=="5dce25b3"||W.UserData.ErrCode=="5dce25b4"||W.UserData.ErrCode=="5dce25b5"){E();l.mobile.reject(W.UserData.Message);return false}if(W.UserData.ErrCode=="1dce25b0"||W.UserData.ErrCode=="1dce25b1"){E();$("#mobileCode_btn").show().closest("dd").find("i").remove();o.mobilenum.reject(W.UserData.Message);return false}if(W.UserData.ErrCode=="ef97e9e7"||W.UserData.ErrCode=="a0e4572c"){E();l.password.reject(W.UserData.Message);return false}if(W.UserData.ErrCode=="1dce21c0"||W.UserData.ErrCode=="1dce21c1"){E();l.mobileimgnum.reject(W.UserData.Message);return false}if(W.UserData.ErrCode=="55933d39"){E();l.passwordRecheck.reject(W.UserData.Message);return false}else{l.password.reject(W.UserData.Message);E();return false}}}}},dataType:"JSON"})};var y=function(){return $("#hid_regtype").val()};$("#aggreeSer_lab a, #aggree_lab a").bind("click",function(){spWindow({id:"aggreeSer",style:{wrapper:{width:"680px"}},title:"注册条款",content:$("#spRegServer_txt").html(),closeBtn:".title_closeBtn",titleColse:true,backover:true}).show()});var k=$(".splogin_form"),x=$(".spreg_form"),F=function(n){n.animate({"margin-left":"0",opacity:1},400)},C=function(n){n.animate({"margin-left":"-960px",opacity:0},400)};$("#spReg_new").bind("click",function(){F(x);C(k);$("#spReg_msg").hide();$("#spLogin_msg").show()});$("#splog_new").bind("click",function(){F(k);C(x);$("#spReg_msg").show();$("#spLogin_msg").hide()});var A=window.location.hash;var w=/#signUp/g;if(w.test(A)){$("#spReg_msg").hide();$("#spLogin_msg").show();$("#divnamemobilevcode").show();k.css({"margin-left":"-960px",opacity:0});x.css({"margin-left":"0",opacity:1})}$("#spSignup_password").bind("blur",function(){if($("#spSignup_password").val()==""){$(this).parent("div").siblings("div.testresult").hide()}});var u=$("#spMailup_email"),H,T=$(".email_select ul"),V=T.length,d=$("#emailListIndex"),g=["@qq.com","@163.com","@126.com","@sina.com","@hotmail.com","@sohu.com","@gmail.com","@tom.com","@139.com","@263.com"];T.hide();var h=function(){var W=j();var Z=d.val()==""?-1:d.val();if(W==40||W==38||W==13){var Y;if(W==40){Z++;if(Z==T.find("li").length){Z=0;T.find("li").eq(T.find("li").length-1).css("background-color","")}Y=T.find("li").eq(Z);T.find("li").eq(Z-1).css("background-color","");Y.css("background-color","#eee");d.val(Z);u.val(Y.text())}else{if(W==38){Z--;if(Z<=-1){Z=T.find("li").length-1;T.find("li").eq(0).css("background-color","")}T.find("li").eq(Z+1).css("background-color","");Y=T.find("li").eq(Z);Y.css("background-color","#eee");d.val(Z);u.val(Y.text())}else{if(W==13){d.val("-1");var n=T.find("li").eq(Z).text();var aa=u.val();if(n==aa){u.val(n)}T.html("");T[0].style.display="none";T.hide();u.parents("dd").next("dd").find("input").focus()}}}}else{T.find("li").remove();if(V>0&&u.val().length>1){T.show();var ac="",ab,X=[];H=$.trim(u.val());if(H.indexOf("@")>-1){H=H.split("@")[0]}if(u.val().indexOf("@")>-1){ac=u.val().substr(u.val().indexOf("@")+1);for(var v=0;v<g.length;v++){ab=g[v];if(g[v].substr(1).indexOf(ac)===0){X.push(ab)}}if(X.length>0){T.empty();for(var v=0;v<X.length;v++){T.append("<li>"+H+X[v]+"</li>")}}else{T.hide()}}if(ac===""&&T.find("li").length==0){T.empty();for(var v=0;v<g.length;v++){T.append("<li>"+H+g[v]+"</li>")}return g}return X}else{T.hide();d.val(-1)}}};u.keyup(h);u.focus(h);u.blur(function(){if(u.val!=""&&u.parents("dd").find("label").is(":hidden")){T.hide();u.parents("dd").next("dd").find("input").focus()}});T.delegate("li","mouseover",function(n){var v=d.val()==""?-1:d.val();if(v<=0){v=0}T.find("li").eq(v).css("background-color","");$(this).css("background-color","#EEEEEE");d.val(v);u.val($(this).text())});T.delegate("li","mouseleave",function(){var n=d.val()==""?-1:d.val();if(n<=0){n=0}$(this).css("background-color","");d.val("-1")});if($("#spTab").length>0){var t=SP.plug.tab.create({wrapper:"#spTab",contentWrapper:"#type_change_content",first:"tab-1",trigger:"click",effector:"direct",curClass:"current",auto:false})}var J=$("[tabid='tab-1']"),K=$("[tabid='tab-2']"),M=$("#spSignup_code_dd"),N=$("#divnamemobilevcode");J.bind("click",function(){M.hide();N.show();$("#hid_regtype").val("1")});K.bind("click",function(){M.show();N.hide();$("#hid_regtype").val("2")});var p=$(".mobile_list"),e=$(".email_list"),m=$(".mobile_title"),c=$(".email_title");var L=function(W,v,n){if(W.parent("li").hasClass(v)==false){W.addClass(n)}};m.bind("mouseover",function(){L(m,"current","mobile_title_hover")});m.bind("mouseout",function(){$(this).removeClass("mobile_title_hover")});c.bind("mouseover",function(){L(c,"current","email_title_hover")});c.bind("mouseout",function(){$(this).removeClass("email_title_hover")});var a=$(".mobile_numBtn");l.mobile=l.group.add({elem:"#spMobileup_mibile",event:"blur",check:function(){if(y()=="2"){this.resolve("手机号码校验成功");return true}this.init();var X=$.trim(this.value()),W=this;if(X==""){this.reject("手机不能为空");return}else{var v=$("#hid_oldmobile");if(X!=v.val()){v.val(X);$("#divMobile").html("");$("#isValidimgcode").val("1")}if(!U(X,"mobile")){this.reject("请输入正确的手机号码");return}else{var n=false;$.ajax({type:"post",url:"/login/ValidMobileRegRepeat?v="+Math.random(),data:{mobile:X},async:false,success:function(Y){if(Y=="1"){n=true}}});if(n){this.reject("该手机已被注册");return}W.resolve("手机号码校验成功");if($(".mobile_numBtn").html()=="获取手机验证码"){}}}},done:function(){r(this.message);s("mobileup_mibile")},fail:function(){r(this.message,"mobileup_mibile",$("#spMobileup_mibile"))}});l.mobileimgnum=l.group.add({elem:"#spSignin_mobilecode",event:"blur",check:function(){if(y()=="2"){this.resolve("手机图文验证码校验成功");return true}if($("#spSignin_mobilecode").is(":hidden")){this.resolve("手机图文验证码校验成功");return true}this.init();var v=$.trim(this.value()),n=this;if(v==""){this.reject("验证码不能为空");return}else{n.resolve("手机图文验证码校验成功")}},done:function(){r(this.message);s("mobileup_mibileimgnum")},fail:function(){r(this.message,"mobileup_mibileimgnum",$("#spSignin_mobilecode"))}});$("#spMobileup_mibile,#spMobileup_mibilenum,#spSignup_password,#spSignup_passwordRecheck,#spMailup_email,#spSignup_code,#spSignin_mobilecode").bind("keypress",function(n){if(n.keyCode==13){n.preventDefault();if(SP.isWeiboReady&&SP.weibo.sinaData){bindSignUpSubmit()}else{$("#spup_btn").click()}}});function B(){var n=$("#mobileCode_txt").html();n=n.replace("<b id='spanMobileNo'></b>","<b id='spanMobileNo'>"+$("#spMobileup_mibile").val()+"</b>");spWindow({id:"mobileCode",style:{wrapper:{width:"400px"},title:{"background-color":"#fafafa",padding:"3px 0 3px 15px",border:"1px solid #e7e7e7"}},title:"验证手机号码",content:n,closeBtn:".title_closeBtn",titleColse:true,backover:true,binder:function(){$(".txt_input").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"20px",top:0,display:"block"},focStyle:{color:"#fff",border:"1px solid #666",display:"none"}});o.mobilenum=o.group.add({elem:"#spMobileup_mibilenum",event:"blur",check:function(){if(y()=="2"){this.resolve("手机验证码校验成功");return true}this.init();var Y=$.trim(this.value()),X=this;if(Y==""){this.reject("手机验证码不能为空");return}else{X.resolve("手机验证码校验成功")}},done:function(){r(this.message);s("mobileup_mibilenum")},fail:function(){r(this.message,"mobileup_mibilenum",$("#spMobileup_mibilenum"))}});o.code=o.group.add({elem:"#mobileCode_code",event:"blur",check:function(){this.init();var Y=$.trim(this.value()),X=this;if(Y==""){this.reject("验证码不能为空");return}this.resolve("验证码正确")},done:function(){r(this.message);s("mobileCode_code")},fail:function(){r(this.message,"mobileCode_code",$("#mobileCode_code"))}});$("#mobileCode").delegate("#mobileCode_code","blur",function(){o.code.check()});$("#mobileCode").delegate("#spMobileup_mibilenum","blur",function(){o.mobilenum.check()});var v=60;var W=function(){$(".mobile_numBtn").removeClass("achieve_num").addClass("mobile_numBtn_disabled");if(v==0){$(".mobile_numBtn").removeClass("mobile_numBtn_disabled").addClass("achieve_num");$(".mobile_numBtn").html("重新获取验证码");return}else{$(".mobile_numBtn").html(v+"秒后重新获取验证码");v--}setTimeout(function(){W()},1000)};$("#mobileCode").delegate(".mobile_numBtn","click",function(){if($(this).hasClass("achieve_num")){$.ajax({type:"post",url:"/login/SendRegMobileCode?v="+Math.random(),data:{mobile:$("#spMobileup_mibile").val(),verifyCode:$("#spSignin_mobilecode").val()},success:function(Y){var X=document.getElementById("divInfosm");if(Y==-300){X.innerHTML="您操作过于频繁，请稍后再试";X.style.display="block";return}if(Y>5){X.innerHTML="验证码每天发送不能超过5次";X.style.display="block"}else{$("#isValidimgcode").val("0");X.innerHTML="";changeCaptchMobileIICode();v=60;W()}}})}});$(".mobile_numBtn").click();$("#mobileCode").delegate("#mobileCode_btn","click",function(X){X.returnValue=false;X.preventDefault();o.group.submit(function(){$("#spSignin_mobilecode").val($("#mobileCode_code").val());$("#spMobileup_mibilenumHid").val($("#spMobileup_mibilenum").val());$("#mobileCode_btn").hide().closest("dd").append('<i class="loading">正在提交...</i>');f(y());var Y=setTimeout(function(){$("#mobileCode_btn").show().closest("dd").find("i").remove()},8000);r("提交成功")});return false}).hover(function(){o.group.preventAll()},function(){o.group.promiseAll()})}}).show()}var G=function(n){if(typeof(n.ReturnUrl)=="undefined"){window.location.href="http://www.shangpin.com"}else{window.location.href=n.ReturnUrl}}});