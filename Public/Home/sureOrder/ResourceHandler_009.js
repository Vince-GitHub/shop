var tradeUrl=$("#NewShangpinTradeDomainUrl").val();function GetOrderStatusMsg(){window.location.replace("/payment/paymsg.html?payno="+$("#OrderNo").val())}function ReSelectPayType(){window.location.replace("/payment/paycenter.html?payno="+$("#OrderNo").val())}$(function(){var b;if($("input:radio[name=giftCard][checked]")){b=$("input:radio[name=giftCard][checked]").attr("giftcardnum")}$("input:radio[name=giftCard]").change(function(){g();b=$(this).attr("giftcardnum");c(b);$("#gifts_price").html(b);$(".actualAmount").html(parseInt($(".totalNum:eq(0)").text())-parseInt(b))});function c(h){if(h!=0){$("#installment_payment").hide()}else{$("#installment_payment").find("dd span").each(function(){$(this).removeClass("curr")});$("#installment_payment").show()}}c(b);function g(){$("#lastPayCard").click();$("#spTabs_menu").find("span").eq(0).click();$(".bank_Content_title").find("dt a").removeClass("open").end().find("dd").hide();$(".bank_Content_title").find("dt a").eq(0).click();$(".olPayment_select_instalment").addClass("non")}if($("#spTabs").length>0){var f=SP.plug.tab.create({wrapper:"#spTabs",contentWrapper:"#spTabs_content",first:"mytab-1",trigger:"click",effector:"direct",curClass:"curr",auto:false});if($("#SandStatus").val()=="1"){$("#spTabs_menu span[tabid='mytab-5']").trigger("click")}}$(".bank_Content dd:not(.custom) span:nth-child(5n)").css({"margin-right":"0"});$(".bank_Content dd,.PaymentBank_appoit dd").delegate("span a","click",function(){var h=$(this).closest("span"),j=h.attr("class"),i=h.find("i").clone(),m=$(".bank_Type span.curr").attr("data-id"),l=$(".bank_Type span.curr").html(),k=h.attr("bankname");$(".bank_name").html(k);if(l=="指定支付"||l=="其它支付"){m=l.substr(0,2)}else{m=l}$("#lastPayCard").addClass("noSelected");if(h.hasClass("disable_btn")){return false}else{$(".bank_Content dd span,.PaymentBank_appoit dd span").removeClass("curr");h.addClass("curr");$("#HidePayType").val(h.attr("payno"));var n=$(".bank_Content dd p.bank_txt input[type='radio']:checked").length;if(n>0){$(".bank_Content dd p.bank_txt input").attr("disabled","disabled").prop("checked",false)}if(!h.hasClass("phonepay")&&$("#phoneNtxt").hasClass("non")){$("#phoneNtxt").removeClass("non");$("#phoneForm").addClass("non");if($("#phoneNum").val()!="请输入您的手机号码"){$("#phoneNum").val("请输入您的手机号码").css({color:"#999"})}}if($(".lklpay").hasClass("curr")){$("#Lacarra").removeClass("non")}else{$("#Lacarra").addClass("non")}if(m=="card"){$("#selectCard").html("&nbsp;"+l)}else{$("#selectCard").html("")}if(i.length>0){$("#selectBank").css({visibility:"visible"}).removeAttr("class").addClass(j).html(i)}else{$("#selectBank").css({visibility:"visible"}).removeAttr("class").addClass(j).html("")}return false}});$("#lastPayCard").bind("click",function(){$("#HidePayType").val($(this).attr("payno"));$(this).removeClass("noSelected");$(".bank_Content").find("dd span").each(function(){$(this).removeClass("curr")});$("#selectBank").removeClass("Unionpay")});$(".bank_Content dd").delegate("span.cashpay a","click",function(){var h=$(this).closest("span");if(h.hasClass("disable_btn")){return}else{h.siblings(".bank_txt").find("input").removeAttr("disabled");$("#cash").prop("checked",true);$(".bank_select .cashpay").html("货到付款")}});$(".bank_Content dd").delegate("span.phonepay a","click",function(){var h=$(this).closest("span");if(h.hasClass("disable_btn")){return false}else{$("#phoneNtxt").addClass("non");$("#phoneForm").removeClass("non");$(".bank_select .phonepay").html("电话支付");var h=$(this).closest("span");h.siblings(".bank_txt").find("input").removeAttr("disabled");$("#bank_cmb").prop("checked",true)}});$("#phoneNum").focus(function(){var h=$(this).val();if(h=="请输入您的手机号码"){$(this).val("")}$(this).css({color:"#333"})}).blur(function(){var h=$(this).val();if(h==""){$(this).val("请输入您的手机号码").css({color:"#999"})}});$(".PaymentBank_submit").delegate("a.PaymentSubmit_btn","click",function(){var h=$(".PaymentBank_content dd span[title].curr").length,i=$(".PaymentBank_errorprm"),j=$("#phoneNum").val(),k=/^1\d{10}$/;if(h==0){i.html("请选择支付方式！").show()}else{if($("#phoneNtxt").hasClass("non")&&j=="请输入您的手机号码"){i.html("请输入您的手机号码！").show()}else{if($("#phoneNtxt").hasClass("non")&&!k.test(j)){i.html("请输入正确手机号码！").show()}else{if($("#selectBank").hasClass("Unionpay")&&!e()){i.html("请输入卡号！").show()}else{if($("#selectBank").hasClass("Unionpay")&&!d()){i.html("请先输入短信验证码！").show()}else{i.html("").hide();UpdatePayType()}}}}}return false});$(".bank_Content dd span a").hover(function(){var h=$(this);if(h.parent("span").hasClass("disable_btn")){return false}else{h.siblings(".pop-up").css("display","block");if(h.siblings(".pop-up").outerWidth()+h.parent().position().left+63>=h.closest("dd").outerWidth()){h.siblings(".pop-up").addClass("pop-right")}}},function(){$(this).siblings(".pop-up").css("display","none")});var a=$("dt.mytab-1-list");$("dl.bank_line > dd").hide();a.eq(0).find("a").addClass("open");$("dt.mytab-2-list").eq(0).find("a").addClass("open");a.find("a").click(function(){var h=$(this);if(h.hasClass("open")){h.removeClass("open").parent().siblings("dd").hide()}else{$(".bank_Content:first > dl > dd").hide().siblings("dt").find("a").removeClass("open");h.addClass("open").parent().siblings("dd").show()}});$("#unionNum").placeHolder({defStyle:{color:"#999",left:"8px",fontSize:"12px",top:"0px",zIndex:"999"},focStyle:{color:"#ccc",fontSize:"12px",zIndex:"999"}});$("#unionCode").placeHolder({defStyle:{color:"#999",left:"8px",fontSize:"12px",top:"0px",zIndex:"999"},focStyle:{color:"#ccc",fontSize:"12px",zIndex:"999"}});$("body").delegate("#unionReg",{mouseover:function(){$(".unionTips").stop().fadeIn()},mouseout:function(){setTimeout(function(){$(".unionTips").stop().fadeOut()},5000)}});var e=function(){var h=$("#unionNum").val();if($.trim(h)===""){$("#cardNumError").html("请先输入卡号").css({display:"block"});$("#unionNum").parent().addClass("error");$("#unionNum").addClass("error_border");return false}if(!/^[\d\s]+$/.test(h)){$("#cardNumError").html("请输入正确的卡号").css({display:"block"});$("#unionNum").parent().addClass("error");$("#unionNum").addClass("error_border");return false}$("#cardNumError").hide();$("#unionNum").parent().removeClass("error");$("#unionNum").addClass("error_border");return true};var d=function(){var h=$("#unionCode").val();if($.trim(h)===""){$("#cardCodeError").html("请先输入验证码").css({display:"block"});$("#unionCode").parent().addClass("error");$("#unionCode").addClass("error_border");return false}$("#cardCodeError").hide();$("#unionCode").parent().removeClass("error");$("#unionCode").addClass("error_border");return true};$("body").delegate(".getCode","hover",function(){$(this).toggleClass("curr1")});$(".Unionpay").click(function(){if($(this).index()==0){$(".unionpay_form").removeClass("non")}else{$(".unionpay_form").addClass("non")}});$(".bank_Content dd span").click(function(){if($(this).index()>-1){$(".send_location").removeClass("non")}else{$(".unionpay_form").addClass("non")}});$("#unionNum").keyup(function(i){var h=$(this).val();h=h.replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 ");$(this).val(h);e()}).change(function(){var h=$(this).val().replace(/[ ]/g,"").replace(/(\d{4})(?=\d)/g,"$1 ");$(this).val(h);e()});$("#unionNum").on("blur",function(){e()});$("#unionCode").on("blur",function(){d()});$("body").delegate("#open_card, #open_card1, #open_card2","click",function(){var i=$("#unionNum").val(),h=$("#unionCode").val();i=Trim(i,"g");if(!e()){return false}else{$("#cardCodeError").hide();$("#unionCode").css({border:"1px solid #CBD7E1","background-color":"#fff"});$.ajax({type:"get",url:"/payment/GetUnionPayActiveStatus.html?t="+Math.random(),data:{bankNo:i},dataType:"Json",async:false,success:function(j){if(j.Result=="0"){$("#cardNumError").html("该卡已经开通，请获取短信验证码!").show()}else{$("#union2").html(j.Result);$("#form1").attr("target","_blank");$("#form1").submit();spWindow({id:"window_instalment",style:{wrapper:{width:"450px"},title:{"background-color":"#e1e1e1",color:"#333","font-size":"14px"},content:{"font-size":"14px;","text-align":"center"},bottom:{padding:"20px 0 30px 0","text-align":"center"}},title:'银联支付 <a class="title_closeBtn red_title" href="#">[关闭]</a>',content:"您将进入新页面进行开通验证,<br />在后继支付时仅需输入卡号、手机验证码完成支付。",bottom:'<a href="http://online.unionpay.com/static/help/index.html" target="_blank" class="olOrder_window_submit">开通遇到问题</a><a href="#" class="olOrder_window_delbtn">完成开通，继续支付</a>',closeBtn:".olOrder_window_submit, .olOrder_window_delbtn, .title_closeBtn",titleColse:false,backover:true}).show()}}})}return false});$("body").delegate(".getCode","click",function(){var j=$("#unionNum").val(),i=$("#unionCode").val();var h=$(this),k=null,l=60;if(!e()){return false}else{j=Trim(j,"g");$.ajax({type:"Post",url:"/payment/checksendunionsms.html?t="+Math.random(),data:{orderNo:$("#OrderNo").val(),bankNo:j},async:true,cache:false,dataType:"json",success:function(m){if(m.Result=="-1"){$("#cardNumError").html(m.Msg).show()}else{if(m.Result=="1"){$("#cardNumError").html('该银行卡未开通银联2.0支付，您可以<a id="open_card1" href="javascript:;">点此正式开通</a>银联在线支付').show()}else{if(m.Result=="2"){$("#cardNumError").html('该银行卡未在银行预留手机号，您可以<a id="open_card2" href="javascript:;">点此正式开通</a>银联在线支付').show()}else{if(m.Result=="3"){$("#cardNumError").html(m.Msg).show()}}}}if(m.Result=="0"){clearInterval(k);h.val(""+l+"s后重新获取");h.prop("disabled",true);k=setInterval(function(){l--;h.val(""+l+"s后重新获取");if(l<0){clearInterval(k);k=null;h.val("获取验证码");h.prop("disabled",false)}},1000)}}})}return false});$("a#instalmentInfo").click(function(){spWindow({id:"window_instalment11",style:{wrapper:{width:"460px"},title:{"background-color":"#e1e1e1","font-size":"14px"},content:{"font-size":"14px;","text-align":"left","padding-bottom":"30px",color:"#333","line-height":"24px"},bottom:{padding:"20px 0 20px 0"}},title:'分期规则 <a class="title_closeBtn red_title" href="#">[关闭]</a>',content:"1、请注意信用卡剩余额度需大于总计金额<br />2、每期还款=（应付金额+手续费）/期数<br />3、金额计算采用四舍五入方式，显示小数点后2位<br />4、每期还款金额是根据订单金额估算得出，实际金额以银行账单为准",bottom:"",closeBtn:".title_closeBtn",titleColse:false,backover:true}).show();return false});$("input[name='cashPay']").change(function(){$("#PayType").val($(this).val())});$(".change_bank").bind("click",function(){var h=$(this).parent("dd").attr("id");$(".olPayment_bankbox").removeClass("non").addClass("inlb");$(".payment_bank").html($("#"+h+"_box").html());if($("input:radio[name=instalment][checked]")){$("#HidePayType").val($(this).attr("payno"));$("#PayType").val($(this).attr("payno"));AjaxBankFQData($("#amountPayment").html(),$("input:radio[name=instalment][checked]").val())}$(".orderPrice").html($("#amountPayment").html());$("input:radio[name=instalment]").change(function(){$("#HidePayType").val($(this).attr("payno"));$("#PayType").val($(this).attr("payno"));AjaxBankFQData($("#amountPayment").html(),$("input:radio[name=instalment][checked]").val())})});$(".bank_Content_title dd span a").hover(function(){var h=$(this);h.siblings(".pop_up_border3").css("display","block");h.parent().css("z-index","999");if(h.siblings(".pop_up_border3").outerWidth()+h.parent().position().left+63>=h.closest("dd").outerWidth()){h.siblings(".pop_up_border3").addClass("pop-right")}},function(){$(this).siblings(".pop_up_border3").css("display","none");$(this).parent().css("z-index","1")})});function UpdatePayType(){var b=$("#PayType").val();if(b==""){$(".error_message").css("visibility","visible").html("请选择支付方式")}var f=b.split("_")[0];var d=b.split("_")[1];var c=b.split("_")[2];var e=parseInt(f);if(e==3){b=$("input[name='phonepay']").attr("payno");$("#PayType").val(b)}var a="payType="+b+"&orderNo="+$("#OrderNo").val()+"&telNo="+$("#phoneNum").val();$.ajax({url:"/Payment/UpdatePayType.html?t="+Math.random(),type:"Post",dataType:"json",async:false,data:a,success:function(g){if(g!=null&&g.Success=="true"){$("#immediatePayBtn").show();$("#immediatePay").hide();if(e==4){window.location.replace("/payment/paymsg.html?payno="+$("#OrderNo").val())}else{if(e==2||e==3||e==8){$("#confirmordermsg").attr("target","_parent")}else{$("#confirmordermsg").attr("target","_blank")}if(e==2||e==3){$("#confirmordermsg").attr("method","get");$("#confirmordermsg").attr("action","/payment/paymsg.html")}else{$("#confirmordermsg").attr("method","post");$("#confirmordermsg").attr("action","/payment/payapi.html?r="+Math.random());WindowTip()}$("#PayTypeId").val(g.PayTypeId);$("#Status").val(g.Status);$("#OnlineAmount").val(g.OnlineAmount);$("#Signature").val(g.Signature);$("#ProductInfo").val(g.ProductOther);$("#TotalQuantity").val(g.TotalQuantity);$("#ListingOutletFlag").val(g.ListingOutletFlag);if($("#unionNum").length>0){$("#bNo").val(Trim($("#unionNum").val(),"g"))}if($("#unionCode").length>0){$("#code").val(Trim($("#unionCode").val(),"g"))}if(e==3){$("#telNo").val($("#phoneNum").val())}$("#submitBtn").click();if(e==2){$("#confirmordermsg").attr("target","_blank");$("#confirmordermsg").attr("method","post");$("#confirmordermsg").attr("action","/payment/payapi.html?r="+Math.random());$("#submitBtn").click()}}}else{$("#immediatePayBtn").show();$("#immediatePay").hide();$(".error_message").css("visibility","visible").html(g.Msg)}},beforeSend:function(){$("#immediatePayBtn").hide();$("#immediatePay").show()}})}function WindowTip(){spWindow({id:"window_payment",style:{wrapper:{width:"450px"}},title:'支付提示窗口 <a class="title_closeBtn red_title" href="#">[关闭]</a>',content:"<span class='error'>&nbsp;</span>请您在新打开的页面完成支付<br />付款完成前请不要关闭此窗口",bottom:'<a href="#" class="olOrder_window_submit"  onclick="GetOrderStatusMsg()">已完成付款</a><a href="#"  onclick="ReSelectPayType()" class="olOrder_window_delbtn">重新选择支付方式</a>',closeBtn:".olOrder_window_submit, .olOrder_window_delbtn, .title_closeBtn",titleColse:false,backover:true}).show()}function GetReceivingInfo(){$.ajax({url:tradeUrl+"/PaymentNew/PayGetOrderBaseInfo?t="+Math.random(),data:{OrderNo:$("#OrderNo").val()},cache:false,dataType:"jsonp",success:function(a){var b='<h2>收货信息<a href="javascript:;" id="updateAddress" class="update_address">修改收货地址</a></h2><div class="receive_information">';b+='<p><span class="title">收货信息：</span><label id="deliveryAddress">'+a.ReceivingInfo.ConsigneeName+'<i class="padl20">'+a.ReceivingInfo.ConsigneeMobile+"</i>&nbsp;&nbsp;&nbsp;&nbsp;"+a.ReceivingInfo.ConsigneeProvinceName+a.ReceivingInfo.ConsigneeCityName+a.ReceivingInfo.ConsigneeTownName+a.ReceivingInfo.ConsigneeAddress+"&nbsp;&nbsp;&nbsp;&nbsp;"+a.ReceivingInfo.ConsigneePostCode+"</label></p>";b+='<p>送货时间：&nbsp;&nbsp;&nbsp;&nbsp;<span id="deliveryTime">'+a.ExpressInfo+"</span></p></div>";$(".collect_address").html(b);$(".collect_address").css("display","block")},error:function(){}})}function Trim(c,a){var b;b=c.replace(/(^\s+)|(\s+$)/g,"");if(a.toLowerCase()=="g"){b=b.replace(/\s/g,"")}return b}function AjaxBankFQData(b,c){var d=tradeUrl;var a=document.domain.toLocaleLowerCase();if(a.indexOf("aolai")>0){d="http://"+a}$.ajax({async:false,url:d+"/paymentnew/ComputeFQ",data:{OrderAmount:b,Periods:c},dataType:"jsonp",success:function(e){$(".interest").html(e.Interest);$(".repaymentPer").html(e.RepaymentPer);$(".periods").html(e.Periods);$(".orderAllPrice").html(e.TotalAmount_fq)},error:function(){}})};