var invoiceProviceText="";var invoiceCityText="";var invoiceAreaText="";var invoiceTownText="";$(function(){if($("#isAlipay").val()=="5"){getAlipayAddress();GetIsJump();GetIsAlipay()}InitGoodsTime();$("input[name='express']").bind("click",function(){TimeRequest()});InitInvoiceInfo()});function getAlipayAddress(){var buyType=$("#buyType").val();var buyKey=$("#buyKey").val();$.ajax({async:false,type:"POST",url:"/trade/ReadAlipayAddressUrl?isOutside=1&buyType="+buyType+"&buyKey="+buyKey+"&r="+Math.random(),data:{},success:function(msg){var result=eval(msg);$("#alipayaddress").attr("href",result.AlipayUrl)}})}function GetIsJump(){$.ajax({async:false,type:"POST",url:"/trade/GetAlipayIsJump",data:{},success:function(msg){var result=eval(msg);if(result.IsJump=="true"){AddAlipayAddr()}else{return}}})}function GetIsAlipay(){$.ajax({async:false,type:"POST",url:"/trade/GetAlipayIsShow",data:{},success:function(msg){var result=eval(msg);if(result.IsAlipayAddr=="true"){$(".olOrder_newConsignee p").hide();$(".consignee_Addr").show();GetAlipayAddrValue()}else{return}}})}function AddAlipayAddr(){$.ajax({async:false,type:"POST",url:"/Cart/GetAlipayAddress",data:{},success:function(a){}})}function GetAlipayAddrValue(){$.ajax({async:false,type:"POST",url:"/trade/GetAlipayAddr/",data:{},success:function(msg){var result=eval(msg);if(result.Success==1){$("#consnee_name").val(result.FullName);strIsAlipay="1";fillProvince(result.ProvinceId);fillCity(result.CityId);fillArea(result.AreaId);fillTown(0);GetTopAddress();$("#consnee_addr").val(result.Address);$("#consnee_code").val(result.AddressCode);$("#consnee_mobile").val(result.MobilePhone);var consigneePhone=result.Phone;if(consigneePhone=="--"){$("#consnee_phone").val("")}else{var phones=consigneePhone.split("-");if(phones.length==3){$("#consnee_phone1").val(phones[0]);$("#consnee_phone2").val(phones[1]);$("#consnee_phone3").val(phones[2])}if(phones.length==2){$("#consnee_phone1").val(phones[0]);$("#consnee_phone2").val(phones[1]);$("#consnee_phone3").val("")}$("#consnee_phone").val(consigneePhone)}}}})}function InitGoodsTime(){switch($("#formOrderConfirm_TimeRequest").val()){case ("3"):$("#formOrderConfirm_TimeRequest").val("2");break;case ("2"):$("#formOrderConfirm_TimeRequest").val("0");break;case ("1"):$("#formOrderConfirm_TimeRequest").val("1");break}var a="";$("input[name='express']").each(function(b,c){if($("#formOrderConfirm_TimeRequest").val()==b){$(c).attr("checked","checked");$(c).parent().addClass("order_express curr");switch(b){case (2):a="3";break;case (1):a="1";break;case (0):a="2";break}}});$("#formOrderConfirm_TimeRequest").val(a)}function TimeRequest(){var a="";$("input[name='express']").each(function(b,c){if($(c).attr("checked")=="checked"){switch(b){case (2):a="3";$(c).val(a);break;case (1):a="1";$(c).val(a);break;case (0):a="2";$(c).val(a);break}}$("#formOrderConfirm_TimeRequest").val(a)})}function fillProvince(a){$("#ProvinceId").contents().remove();$("#ProvinceId").append("<option value='-1'>请选择</option>");$(provinces).each(function(c,b){if(a==0){$("#ProvinceId").append("<option value='"+b[1]+"'>"+b[2]+"</option>")}else{if(b[1]==a){$("#ProvinceId").append("<option selected value='"+b[1]+"'>"+b[2]+"</option>")}else{$("#ProvinceId").append("<option value='"+b[1]+"'>"+b[2]+"</option>")}}})}function fillCity(a){var b=$("#ProvinceId").val();$("#CityId").contents().remove();$("#CityId").append("<option value='-1'>请选择</option>");if(b!=""){$(citys).each(function(e,c){if(c[0]==b){if(c[1]==a){$("#CityId").append("<option selected='selected' value='"+c[1]+"'>"+c[2]+"</option>")}else{$("#CityId").append("<option value='"+c[1]+"'>"+c[2]+"</option>")}}})}}function fillArea(b){var a=$("#CityId").val();$("#AreaId").contents().remove();$("#AreaId").append("<option value='-1'>请选择</option>");if(a!=""){$(areas).each(function(e,c){if(c[0]==a){if(c[1]==b){$("#AreaId").append("<option selected='selected' value='"+c[1]+"'>"+c[2]+"</option>")}else{$("#AreaId").append("<option value='"+c[1]+"'>"+c[2]+"</option>")}}})}}function fillTown(id){var aid=$("#AreaId").val();$("#TownId").contents().remove();$("#TownId").append("<option value='-1'>请选择</option>");if(aid=="0"){return}else{if(aid!=""){var str="areaId="+aid;$.ajax({url:"/trade/SelectTownListByAreaId",type:"POST",data:str,error:function(){},success:function(msg){var result=eval(msg);$(result.invoiceTown).each(function(idx,d){if(d.areaId==aid){if(d.id==id){$("#TownId").append("<option selected='selected' value='"+d.id+"'>"+d.name+"</option>")}else{$("#TownId").append("<option value='"+d.id+"'>"+d.name+"</option>")}}})}})}}}function GetTopAddress(){var f=$("#ProvinceId>option:selected").text();var g="";if(f!="请选择"){g=f}else{g=""}var d=$("#CityId>option:selected").text();var e="";if(d!="请选择"){e=d}else{e=""}var b=$("#AreaId>option:selected").text();var c="";if(b!="请选择"){c=b}else{c=""}var h=$("#TownId>option:selected").text();var i="";if(h!="请选择"){i=h}else{i=""}var a=g+e+c+i;$("#consnee_topaddr").html(a)}function InitInvoiceInfo(){if($("#formOrderConfirm_InvoiceFlag").val()=="0"||$("#formOrderConfirm_InvoiceFlag").val().length==0){$("#formOrderConfirm_InvoiceFlag").val("1")}if($("#formOrderConfirm_InvoiceType").val()=="0"||$("#formOrderConfirm_InvoiceType").val().length==0){$("#formOrderConfirm_InvoiceType").val("1")}if($("#formOrderConfirm_InvoiceFlag").val()=="2"){$("input[name='invoice']").eq(1).attr("checked","checked");$(".olOrder_invoice dd:not(.invoice_saveBox)").hide();$(".olOrder_invoice dd input, .olOrder_invoice dd select").attr("disabled","disabled");$("input[name=title]").prop("checked",false).siblings("input").hide();$("input[name=title]").siblings("label[for='org']").hide();$("input[name=addr]").prop("checked",false);$(".invoice_Addr, .invoice_saveBox").hide();$("#same_Addr").prop("checked",false)}else{$("input[name='invoice']").eq(0).attr("checked","checked");$(".olOrder_invoice dd:not(.invoice_saveBox)").show();$(".olOrder_invoice .msgBox").hide();$(".olOrder_invoice dd input, .olOrder_invoice dd select").removeAttr("disabled");$("#invoice_person").prop("checked",true).siblings("input").show();$("#invoice_person").siblings("label[for='org']").show();$("#same_Addr").prop("checked",true);if($("#formOrderConfirm_InvoiceType").val()=="2"){$("input[name='titles']").eq(1).attr("checked","checked");$("#invoice_org_title").val($("#formOrderConfirm_InvoiceTitle").val());$("#invoice_org_title")[0].style.display="inline";$(this).siblings("input").show();$("input#invoice_person").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_person").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}}else{$(this).siblings("input").show();$("input#invoice_org").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_org").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}$("#formOrderConfirm_InvoiceTitle").val("")}}}function insInvoiceAddr(){var lastFlag=0;var str="ConsigneeName="+$("#invoice_name").val();str+="&ConsigneeProvinceId="+$("#fpProvinceId").val();str+="&ConsigneeCityId="+$("#fpCityId").val();str+="&ConsigneeAreaId="+$("#fpAreaId").val();str+="&ConsigneeTownId="+$("#fpTownId").val();str+="&ConsigneeAddress="+$("#invoice_addr").val();str+="&ConsigneePostCode="+$("#invoice_code").val();str+="&ConsigneeMobile="+$("#invoice_mobile").val();str+="&ConsigneePhone="+$("#invoice_phone1").val()+"-"+$("#invoice_phone2").val()+"-"+$("#invoice_phone3").val();str+="&LastFlag="+lastFlag;$.ajax({url:"/trade/AddInvoiceConsignAddr",type:"POST",data:str,error:function(){alert("添加失败")},success:function(msg){var result=eval(msg);if(result.Success=="1"){$(".new_invoice").hide();$("#formOrderConfirm_fpConsigneeId").val(result.Message);$("#fpConsigneeId").val(result.Message);invoiceProviceText=$("#fpProvinceId  option:selected").text();invoiceCityText=$("#fpCityId  option:selected").text();invoiceAreaText=$("#fpAreaId  option:selected").text();invoiceTownText=$("#fpTownId  option:selected").text();$("#other_name").html($("#invoice_name").val());var address=invoiceProviceText+invoiceCityText+invoiceAreaText+invoiceTownText+$("#invoice_addr").val();var strPhone=$("#invoice_mobile").val();if($("#invoice_mobile").val()==""){if($("#invoice_phone1").val()!=""){strPhone+=$("#invoice_phone1").val()+"-"}if($("#invoice_phone2").val()!=""){strPhone+=$("#invoice_phone2").val()}if($("#invoice_phone3").val()!=""){strPhone+="-"+$("#invoice_phone3").val()}}strOtherAddress="<dd><label>"+$("#invoice_name").val()+'<i class="padl20">'+strPhone+"</i> <br>"+address+"<br>"+$("#invoice_code").val()+"</label></dd>"}else{}}})}function getInvoiceAddr(){var str="ConsigneeId="+$("#fpConsigneeId").val();$.ajax({url:"/trade/GetInvoiceAddrExt",data:str,type:"POST",async:false,dataType:"json",success:function(msg){var result=eval(msg);if(result.Success=="1"){$("#formOrderConfirm_fpConsigneeId").val(result.ConsigneeId);$("#fpConsigneeId").val(result.ConsigneeId);$("#invoice_name").val(result.ConsigneeName);fillInvoiceProvince(result.ConsigneeProvinceId);fillInvoiceCity(result.ConsigneeCityId);fillInvoiceArea(result.ConsigneeAreaId);fillInvoiceTown(result.ConsigneeTownId);invoiceProviceText=$("#fpProvinceId  option:selected").text();invoiceCityText=$("#fpCityId  option:selected").text();invoiceAreaText=$("#fpAreaId  option:selected").text();invoiceTownText=$("#fpTownId  option:selected").text();$("#invoice_addr").val(result.ConsigneeAddress);$("#invoice_code").val(result.ConsigneePostCode);$("#invoice_mobile").val(result.ConsigneeMobile);var inovicePhone=result.ConsigneePhone;if(inovicePhone=="--"){$("#invoice_phone").val("")}else{var invoicePhones=inovicePhone.split("-");if(invoicePhones.length==3){$("#invoice_phone1").val(invoicePhones[0]);$("#invoice_phone2").val(invoicePhones[1]);$("#invoice_phone3").val(invoicePhones[2])}if(invoicePhones.length==2){$("#invoice_phone1").val(invoicePhones[0]);$("#invoice_phone2").val(invoicePhones[1]);$("#invoice_phone3").val("")}$("#consnee_phone").val(inovicePhone)}}else{$("#formOrderConfirm_fpConsigneeId").val("0");$("#fpConsigneeId").val("0")}}})}function updInvoiceAddr(){var str="ConsigneeId="+$("#formOrderConfirm_fpConsigneeId").val();str+="&ConsigneeName="+$("#invoice_name").val();str+="&ConsigneeProvinceId="+$("#fpProvinceId").val();str+="&ConsigneeCityId="+$("#fpCityId").val();str+="&ConsigneeAreaId="+$("#fpAreaId").val();str+="&ConsigneeTownId="+$("#fpTownId").val();str+="&ConsigneeAddress="+$("#invoice_addr").val();str+="&ConsigneePostCode="+$("#invoice_code").val();str+="&ConsigneeMobile="+$("#invoice_mobile").val();str+="&ConsigneePhone="+$("#invoice_phone1").val()+"-"+$("#invoice_phone2").val()+"-"+$("#invoice_phone3").val();str+="&ConsigneeEmail=";str+="&memo=";$.ajax({url:"/trade/SaveInvoiceConsigneeAddress",type:"POST",data:str,success:function(msg){var result=eval(msg);if(result.Success=="1"){$(".new_invoice").hide();$("#formOrderConfirm_fpConsigneeId").val(result.Message);$("#fpConsigneeId").val(result.Message);invoiceProviceText=$("#fpProvinceId  option:selected").text();invoiceCityText=$("#fpCityId  option:selected").text();invoiceAreaText=$("#fpAreaId  option:selected").text();invoiceTownText=$("#fpTownId  option:selected").text();$("#other_name").html($("#invoice_name").val());var address=invoiceProviceText+invoiceCityText+invoiceAreaText+invoiceTownText+$("#invoice_addr").val();var strPhone=$("#invoice_mobile").val();if($("#invoice_mobile").val()==""){if($("#invoice_phone1").val()!=""){strPhone+=$("#invoice_phone1").val()+"-"}if($("#invoice_phone2").val()!=""){strPhone+=$("#invoice_phone2").val()}if($("#invoice_phone3").val()!=""){strPhone+="-"+$("#invoice_phone3").val()}}strOtherAddress="<dd><label>"+$("#invoice_name").val()+'<i class="padl20">'+strPhone+"</i> <br>"+address+"<br>"+$("#invoice_code").val()+"</label></dd>"}}})}function fillInvoiceProvince(a){$("#fpProvinceId").contents().remove();$("#fpProvinceId").append("<option value='-1'>请选择</option>");$(provinces).each(function(c,b){if(a==0){$("#fpProvinceId").append("<option value='"+b[1]+"'>"+b[2]+"</option>")}else{if(b[1]==a){$("#fpProvinceId").append("<option selected='selected' value='"+b[1]+"'>"+b[2]+"</option>")}else{$("#fpProvinceId").append("<option value='"+b[1]+"'>"+b[2]+"</option>")}}})}function fillInvoiceCity(a){var b=$("#fpProvinceId").val();$("#fpCityId").contents().remove();$("#fpCityId").append("<option value='-1'>请选择</option>");if(b!=""){$(citys).each(function(e,c){if(c[0]==b){if(c[1]==a){$("#fpCityId").append("<option selected='selected' value='"+c[1]+"'>"+c[2]+"</option>")}else{$("#fpCityId").append("<option value='"+c[1]+"'>"+c[2]+"</option>")}}})}}function fillInvoiceArea(b){var a=$("#fpCityId").val();$("#fpAreaId").contents().remove();$("#fpAreaId").append("<option value='-1'>请选择</option>");if(a!=""){$(areas).each(function(e,c){if(c[0]==a){if(c[1]==b){$("#fpAreaId").append("<option selected='selected' value='"+c[1]+"'>"+c[2]+"</option>")}else{$("#fpAreaId").append("<option value='"+c[1]+"'>"+c[2]+"</option>")}}})}}function fillInvoiceTown(id){var aid=$("#fpAreaId").val();$("#fpTownId").contents().remove();$("#fpTownId").append("<option value='-1'>请选择</option>");if(aid=="-1"){return}else{if(aid!=""){var str="areaId="+aid;$.ajax({url:"/trade/SelectTownListByAreaId",type:"POST",data:str,async:false,error:function(){},success:function(msg){var result=eval(msg);$(result.invoiceTown).each(function(idx,d){if(d.areaId==aid){if(d.id==id){$("#fpTownId").append("<option selected='selected' value='"+d.id+"'>"+d.name+"</option>")}else{$("#fpTownId").append("<option value='"+d.id+"'>"+d.name+"</option>")}}})}})}}}function GetInvoiceAddress(){var f=$("#fpProvinceId>option:selected").text();var g="";if(f!="请选择"){g=f}else{g=""}var d=$("#fpCityId>option:selected").text();var e="";if(d!="请选择"){e=d}else{e=""}var b=$("#fpAreaId>option:selected").text();var c="";if(b!="请选择"){c=b}else{c=""}var h=$("#fpTownId>option:selected").text();var i="";if(h!="请选择"){i=h}else{i=""}var a=g+e+c+i;$("#invoice_topaddr").html(a)}function RemoveInvoiceInsAddr(){$("#invoice_name").val("");fillInvoiceProvince(0);fillInvoiceCity(0);fillInvoiceArea(0);fillInvoiceTown(0);$("#invoice_addr").val("");$("#invoice_code").val("");$("#invoice_mobile").val("");$("#invoice_phone1").val("");$("#invoice_phone2").val("");$("#invoice_phone3").val("")}function invoiceAddrHender(){$(".invoice_list dd").delegate("label","click",function(){$(".invoice_list dd").removeClass("cur");$(this).parent().addClass("cur");$(this).siblings("input").prop("checked",true)});$(".invoice_list input").change(function(){$(".invoice_list dd").removeClass("cur");$(this).parent().addClass("cur")});$(".invoice_list dd").hover(function(){$(this).addClass("cur").find("span").show()},function(){$(this).find("span").hide();if($(this).find("input").prop("checked")){return false}else{$(this).removeClass("cur")}});var a=$(".invoice_list").find("dd").length;$(".invoice_list").find("dd:lt(5)").show();if(a>5){$(".invoice_list").find("dd:gt(4)").hide()}else{$(".invoice_Addr p a.allInvie_btn").hide()}if(a>=10){$(".invoice_Addr p").show();$(".invoice_Addr p a.newInvie_btn").hide();$(".invoice_Addr p a.allInvie_btn").show()}else{if(a!=0){$(".invoice_Addr p").show();$(".invoice_Addr p a.newInvie_btn").show()}}$(".invoice_Addr").find(".allInvie_btn").click(function(){$(".invoice_list").find("dd").show();$(this).hide();if(a==10){$(this).siblings("span").show()}return false});$(".invoice_Addr p a.newInvie_btn").click(function(){$(".new_invoice .myinfo_Notice span").text("新增发票地址");$(".invoice_Addr p").hide();$(".new_invoice,.invoice_Addr_new").show();$(".addr_form .form_succeed, .addr_form dd p").hide();$(".addr_form dd").removeClass("error");RemoveInvoiceInsAddr();return false});$("#invoice_save").click(function(){$(".invoice_saveBox").show();$(".invoice_Addr").hide();getOneInvoiceAddr();return false});$(".invoice_list").delegate("a.delete_invoice","click",function(){$(".invoice_Addr p").show();var b=$(this).attr("invceid");$(".invoice_list dd[id="+b+"]").remove();$(".new_invoice").hide();if($(".invoice_list dd").length==0){$(".invoice_Addr p").hide();$(".new_invoice,.invoice_Addr_new").show()}if($(".invoice_list dd").length<=5){$(".invoice_list").find("dd").show();$(".invoice_Addr p a.allInvie_btn").hide()}$(".invoice_Addr p a.newInvie_btn").show();$(".invoice_Addr p span").hide();delInvoiceAddr(b);return false});$(".invoice_list").delegate("a.change_invoice","click",function(){var b=$(this).attr("invceid");$(".new_invoice .myinfo_Notice span").text("修改发票地址");$(this).closest("dd").find("input").prop("checked",true);$(".new_invoice,.invoice_Addr_new").show();$(".invoice_Addr p").hide();$(".addr_form .form_succeed, .addr_form dd p").hide();$(".addr_form dd").removeClass("error");getInvoiceAddr(b);return false});$(".invoice_Addr .cancel_Btn").click(function(){$(".new_invoice").hide();$(".invoice_Addr p").show();$(".invoice_list .delete_invoice").show()})}$(function(){$(".alCart_proList dl.proOver").find("img").css("opacity",".4");$("#ProvinceId").change(function(){fillCity(0);fillArea(0);fillTown(0);GetTopAddress()});$("#CityId").change(function(){fillArea(0);fillTown(0);GetTopAddress()});$("#AreaId").change(function(){fillTown(0);GetTopAddress()});$("#TownId").change(function(){GetTopAddress()});$("#fpProvinceId").change(function(){fillInvoiceCity(0);fillInvoiceArea(0);GetInvoiceAddress()});$("#fpCityId").change(function(){fillInvoiceArea(0);GetInvoiceAddress()});$("#fpAreaId").change(function(){GetInvoiceAddress()});$("input#invoice_yes").change(function(){$(".olOrder_invoice dd:not(.invoice_saveBox)").show();$(".olOrder_invoice .msgBox").hide();$(".olOrder_invoice dd input, .olOrder_invoice dd select").removeAttr("disabled");$("#invoice_person").prop("checked",true).siblings("input").show();$("#invoice_person").siblings("label[for='org']").show();$("#same_Addr").prop("checked",true);$("#formOrderConfirm_InvoiceFlag").val("1");if($("#formOrderConfirm_InvoiceType").val()=="2"){$("input[name='titles']").eq(1).attr("checked","checked");$("#invoice_org_title").val($("#formOrderConfirm_InvoiceTitle").val());$("#invoice_org_title")[0].style.display="inline";$(this).siblings("input").show();$("input#invoice_person").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_person").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}}else{$(this).siblings("input").show();$("input#invoice_org").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_org").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}}});$("input#invoice_no").click(function(){$(".olOrder_invoice dd:not(.invoice_saveBox)").hide();$(".olOrder_invoice dd input, .olOrder_invoice dd select").attr("disabled","disabled");$("input[name=title]").prop("checked",false).siblings("input").hide();$("input[name=title]").siblings("label[for='org']").hide();$("input[name=addr]").prop("checked",false);$(".invoice_Addr, .invoice_saveBox").hide();$("#same_Addr").prop("checked",false);$(".olOrder_newConsignee .new_invoice").css("display","none");$("#formOrderConfirm_InvoiceFlag").val("2")});$("input#invoice_zeng").click(function(){$(".olOrder_invoice dd:not(.invoice_saveBox)").hide();$(".olOrder_invoice .msgBox").show();$(".olOrder_invoice dd input, .olOrder_invoice dd select").attr("disabled","disabled");$("input[name=title]").prop("checked",false).siblings("input").hide();$("input[name=title]").siblings("label[for='org']").hide();$("input[name=addr]").prop("checked",false);$(".invoice_Addr, .invoice_saveBox").hide();$("#same_Addr").prop("checked",false)});if($(".org_title").length>0){$(".org_title").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"57px",top:"2px",zIndex:"999"},focStyle:{color:"#ccc",border:"1px solid #999",zIndex:"999"}});$("label[for='org']").css("line-height","25px")}$("#invoice_org_title").change(function(){$("#formOrderConfirm_InvoiceTitle").val($("#invoice_org_title").val());$("#hidInvoiceTitle").val($("#invoice_org_title").val())});$("input#invoice_person").change(function(){$(this).siblings("input").show();$("input#invoice_org").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_org").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}$("#formOrderConfirm_InvoiceType").val("1");$("#formOrderConfirm_InvoiceTitle").val("")});$("input#invoice_org").change(function(){if($("#hidInvoiceTitle").val()=="个人"){$("#invoice_org_title").val("");$("#formOrderConfirm_InvoiceTitle").val("单位")}else{$("#formOrderConfirm_InvoiceTitle").val($("#hidInvoiceTitle").val())}$(this).siblings("input").show();$("input#invoice_person").siblings("input").hide();$(this).siblings("label[for='org']").show();$("input#invoice_person").siblings("label[for='org']").hide();if($(this).siblings("input").val()!=""){$(this).siblings("label[for='org']").hide()}$("#formOrderConfirm_InvoiceType").val("2")});$("#InvoiceContent").change(function(){$("#formOrderConfirm_InvoiceContent").val($(this).children("option:selected").val())});$("#other_Addr").change(function(){$("#invoiceAddr").show();$(".new_invoice .myinfo_Notice span").text("修改发票地址");$(".new_invoice,.invoice_Addr_new").show();$(".invoice_Addr p").hide();$(".addr_form .form_succeed, .addr_form dd p").hide();$(".addr_form dd").removeClass("error");getInvoiceAddr();if($("#fpConsigneeId").val()!="0"){$("#invoice_submit").hide();$("#invoice_save_submit").show()}else{$("#invoice_submit").show();$("#invoice_save_submit").hide();$("#formOrderConfirm_fpConsigneeId").val("0")}});$("#same_Addr").change(function(){$(".invoice_Addr, .invoice_saveBox,.invoice_Addr_new").hide();$("#formOrderConfirm_fpConsigneeId").val($("#formOrderConfirm_ConsigneeId").val())});fillInvoiceProvince(0);fillInvoiceCity(0);fillInvoiceArea(0);fillInvoiceTown(0);$("#fpProvinceId").change(function(){fillInvoiceCity(0);fillInvoiceArea(0);fillInvoiceTown(0);GetInvoiceAddress()});$("#fpCityId").change(function(){fillInvoiceArea(0);fillInvoiceTown(0);GetInvoiceAddress()});$("#fpAreaId").change(function(){fillInvoiceTown(0);GetInvoiceAddress()});$("#fpTownId").change(function(){GetInvoiceAddress()});$(".alCart_couponList").delegate("input","click",function(){usePreferential();$("#formOrderConfirm_CashTicketFlag").val("1");$("#formOrderConfirm_CashTicketNo").val($(this).attr("tNo"));$(".alCart_couponList").hide();var ordervalue=$(this).attr("ordervalue");var ticketvalue=$(this).attr("ticketvalue");var usevalue=$(this).attr("uvalue");if(ordervalue=="0"){cashType="1";cashTypeStr="现金券";cashDesc=ticketvalue+"元&nbsp;&nbsp;现金券"}else{cashType="2";cashTypeStr="优惠券";cashDesc="满"+ordervalue+"元减"+ticketvalue+"&nbsp;&nbsp;优惠券"}$("#couponData").html("已使用&nbsp;&nbsp;"+cashDesc+"一张，已优惠"+usevalue+'元&nbsp;&nbsp;<a href="javascript:;" id="couponCancel">取消使用</a>').show();$(".alCart_coupon span em").hide();$(".alCart_coupon input").attr({disabled:"disabled"});$(".toActivate_container").hide();$(".tabBox table tr").removeClass("over");$(".discount_menu").hide();$(".discount_content").css("border","0");$("#bank_ccb_hsy").hide();$("#couponPrice").show();$("#couponPrice").children("i").html("优惠券");$("#couponNum").html("-&yen;"+usevalue);var totalNum=parseInt($("#prodNum").text())-parseInt(usevalue)<0?0:parseInt($("#prodNum").text())-parseInt(usevalue);$.ajax({type:"Get",url:"/trade/CheckFreight",data:{totalAmount:totalNum,buyKey:$("#buyKey").val()},success:function(data){if(data.Result==0){$("#isShowFreight").show()}else{$("#isShowFreight").hide()}$("#payNum").val(totalNum+parseInt(data.Result));payment()}});$("#couponCancel").click(function(){$("#formOrderConfirm_CashTicketFlag").val("");$("#formOrderConfirm_CashTicketNo").val("");usePreferential();$(".alCart_couponList input").prop("checked",false);$(".alCart_couponList").show();$("#couponData, .couponPrice").hide();var totalNum=parseInt($("#prodNum").text());$.ajax({type:"Get",url:"/trade/CheckFreight",data:{totalAmount:totalNum,buyKey:$("#buyKey").val()},success:function(data){if(data.Result==0){$("#isShowFreight").show()}else{$("#isShowFreight").hide()}$("#payNum").val(totalNum+parseInt(data.Result));payment()}});$(".alCart_coupon input").removeAttr("disabled");$(".toActivate_container").show();$("#couponPrice").hide();$("#couponPrice").children("i").html("");$(".discount_menu").show();$(".discount_content").removeAttr("style");$("#bank_ccb_hsy").show();$("#active").show();return false});return false});$(".tabBox table").delegate("tr, i","hover",function(){$(this).toggleClass("over")});$(".continue_btn").click(function(){if($("#coupon").prop("checked")){$("#coupon").prop("checked",true);$(".alCart_coupon span em").show();$(".alCart_couponList").show()}$(this).hide();$(".data_ajax").show();return false});if($(".order_activeBox")){if($("#active_code")){$("#active_code").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"9px",top:"1px",zIndex:"999"},focStyle:{color:"#ccc",border:"1px solid #999",zIndex:"999"}})}if($("#couponCode_code")){$("#couponCode_code").placeHolder({defStyle:{color:"#999",border:"1px solid #b1adaa",left:"9px",top:"1px",zIndex:"999"},focStyle:{color:"#ccc",border:"1px solid #999",zIndex:"999"}})}function activateFn(el,callback){var _self=$(el);_self.delegate("#active_btn","click",function(){var re=/^\w{10}$/i,str=$("#active_code").val();if(str.replace(/(^\s*)|(\s*$)/g,"")==""){$("#active_tipsbox").find("#txtTipsbox").html("优惠券激活码不能为空!").end().show()}else{if(!re.test(str)){$("#active_tipsbox").find("#txtTipsbox").html("您输入的优惠券激活码有误，请重新输入!").end().show()}else{$(".toActivate_container").find(".coupon_ajax").show();var detailIds="";var array=new Array();$(".alCart_proList_content ul:not('.fail')").each(function(){var myId=$(this).attr("olboxid");array.push(myId);detailIds=array.join(",")});detailIds=detailIds.replace(new RegExp(",",("g")),"|");$.ajax({type:"POST",url:"/trade/ActiveCashTicket",data:{cashTicketNo:str,detailIds:detailIds,buyKey:$("#buyKey").val()},dataType:"JSON",success:function(data){if(data.Success){$("#active_tipsbox").hide();$("#active_code").val("");if(callback){callback(data)}}else{$("#active_tipsbox").find("#txtTipsbox").text(data.Err).end().show();$(".toActivate_container").find(".zom").show();$(".toActivate_container").find(".coupon_ajax").hide();$("#active, #active_tipsbox").show()}}})}}$("#txtTipsbox").removeClass("succeed")})}activateFn("#active",function(data){prodCoupon(data)});$("#active_tipsbox").delegate("#active_closebtn","click",function(){$(this).parent().hide();$("#txtTipsbox").removeClass("succeed")})}function couponCodeFn(el,callback){var _self=$(el);_self.delegate("#couponCode_active_btn","click",function(){var detailIds="";var array=new Array();$(".alCart_proList_content ul:not('.fail')").each(function(){var myId=$(this).attr("olboxid");array.push(myId);detailIds=array.join(",")});detailIds=detailIds.replace(new RegExp(",",("g")),"|");var re=/^\w{10}$/i,str=$("#couponCode_code").val();if(str.replace(/(^\s*)|(\s*$)/g,"")==""){$("#couponCode_tipsbox").find("#couponCode_txtTipsbox").html("优惠码不能为空!").end().show()}else{$("#couponCode_container").find(".zom").hide();$("#couponCode_container").find(".coupon_ajax").show();$("#couponsCodeTip").hide();$.ajax({type:"GET",url:"/trade/ActivePromotionCode",data:{promotionCode:str,detailIds:detailIds,buyKey:$("#buyKey").val()},async:true,cache:false,dataType:"json",success:function(data){var result=eval(data);if(result.Success){$("#couponCode_tipsbox").hide();$("#couponCode_code").val("");$("#formOrderConfirm_CashTicketNo").val(result.Result.PromotionCodeNo);$("#formOrderConfirm_CashTicketFlag").val("2");if(callback){callback(result.Result)}}else{$("#couponCode_tipsbox").find("#couponCode_txtTipsbox").text(result.Err).end().show();$("#couponCode_container").find(".zom").show();$("#couponCode_container").find(".coupon_ajax").hide();$("#couponCode_tipsbox").show()}}})}})}couponCodeFn("#couponCode_active",function(result){couponCode(result)});$("#couponCode_tipsbox").delegate("#couponCode_closebtn","click",function(){$(this).parent().hide()});$("#couponCode_code").focus(function(){$("#couponCode_tipsbox").hide()});$(".order_express").click(function(){$(this).addClass("curr").siblings().removeClass("curr")});if($("#spTab").length>0){var mytab=SP.plug.tab.create({wrapper:"#spTab",contentWrapper:"#spTab_cont",first:"mytab-1",trigger:"click",effector:"direct",curClass:"curr",auto:false})}var giftcardnum=0;if($("input:radio[name=giftCard][checked]").length>0){giftcardnum=$("input:radio[name=giftCard][checked]").attr("giftcardnum")}setTimeout(function(){},300);$("input:radio[name=giftCard]").change(function(){usePreferential();payment()});$(".alCart_couponList").delegate(".explain","mouseover",function(){var thisLeft=parseInt($(this).offset().left)+100;var thisTop=parseInt($(this).offset().top)+30;$(this).find("div").show();$(this).find("div").css({left:thisLeft,top:thisTop})});$(".alCart_couponList").delegate(".explain","mouseout",function(){$(this).find("div").hide()});var itemImgHover=null,itemImgOut=null,imgHideLeave=null,imgHideId="";$(".alCart_proList_content").delegate(".td_item_img","mouseover",function(){var $this=$(this),$tr=$this.parents("ul"),proid=$tr.attr("olboxid");if("item_img_hide_proid"+proid==imgHideId){clearTimeout(imgHideLeave)}if(!$("#item_img_hide_proid"+proid).length){$("body").append('<div id="item_img_hide_proid'+proid+'" class="item_img_hide"><a href="'+$this.find("a").attr("href")+'"><img src="'+$this.find("img").attr("bigimg")+'" width="210" height="280" /></a><span class="item_img_icon"></span></div>')}itemImgHover=setTimeout(function(){$("#item_img_hide_proid"+proid).css({top:$this.offset().top-36,left:$this.offset().left+102}).show()},300)});$(".alCart_proList_content").delegate(".td_item_img","mouseout",function(){var $this=$(this),$tr=$this.parents("ul"),proid=$tr.attr("olboxid");clearTimeout(itemImgHover);itemImgOut=setTimeout(function(){$("#item_img_hide_proid"+proid).hide()},300)});$("body").delegate(".item_img_hide",{mouseenter:function(){clearTimeout(itemImgOut);clearTimeout(imgHideLeave)},mouseleave:function(e){imgHideId=e.currentTarget.id;imgHideLeave=setTimeout(function(){$(".item_img_hide").hide()},300)}});$(".useCoupons").click(function(){$(this).hide();$(".useCouponsOpen").removeClass("non");$("#spTab").show()});$(".useCouponsOpen").click(function(){$(this).addClass("non");$(".useCoupons").show();$("#spTab").hide()});$(".bank_Content").each(function(){var $this=$(this);$this.find("dd").find("span").click(function(){var $this=$(this);if(!$this.parent().hasClass("ccb_choice")){$(".ccb_choice_card").children("div").hide()}})});$(".ccb_choice span").click(function(){var $this=$(this);$thisIndex=$this.index();$(".ccb_choice_card").children("div").eq($thisIndex).show().siblings().hide();$(".card_select").each(function(){var that=$(this);that.find("option").eq(0).attr("selected","selected")});$(".card_image").children("div").hide()});$(".card_select").change(function(){var $thisVal=$(this).find("option:selected").val();var $thisId=$thisVal.split("-")[1];var $imageCard=$(this).next("div.card_image");if($thisId>0){$imageCard.children("div").eq($thisId-1).show().siblings().hide()}else{$imageCard.children("div").hide()}});function showBigCommentImg($this){var outBoxLeft=$this.offset().left,outBoxTop=$this.offset().top,winScTop=$(window).scrollTop(),winHeight=$(window).height(),outPosi=(outBoxTop-winScTop)>winHeight/2?"top":"bottom";imgHeight=$this.height();$this.next(".imgBigBox").show();var imgDivWidth=$this.next(".imgBigBox").find("img").width(),imgDivHeight=$this.next(".imgBigBox").find("img").height();if(outPosi=="top"){$this.next(".imgBigBox").css({left:(outBoxLeft),top:outBoxTop-imgDivHeight-26})}else{$this.next(".imgBigBox").css({left:(outBoxLeft),top:outBoxTop+imgHeight+4})}return false}function hideBigCommentImg($this){$this.next(".imgBigBox").hide()}$(".image_card_big").mouseover(function(){showBigCommentImg($(this))});$(".image_card_big").mouseout(function(){hideBigCommentImg($(this))})});function usePreferential(){$("#lastPayCard").click();$("#spTabs_menu").find("span").eq(0).click();$(".bank_Content_title").find("dt a").removeClass("open").end().find("dd").hide();$(".bank_Content_title").find("dt a").eq(0).click();$(".olPayment_select_instalment").addClass("non")}var couponCode=function(d){var a=d.CouponPrice;var c=d.PromotionCodeNo;$("#couponCode_container").find(".zom").show();$("#couponCode_container").find(".coupon_ajax").hide();usePreferential();$("#couponCodeData").html("已使用折扣码&nbsp;&nbsp;"+c+"，已优惠<em>"+a+' </em>元&nbsp;&nbsp;<a href="javascript:;" id="couponCodeCancel">取消使用</a>').addClass("end").show();$(".alCart_coupon span em").hide();$(".alCart_coupon input").attr({disabled:"disabled"});$("#couponCode_active").hide();$("#bank_ccb_hsy").hide();$(".discount_menu, .explain_couponCode").hide();$(".discount_content").css("border","0");if(d.SkuNos.length>0){if(parseInt(a)!=0){var e=d.SkuNos.split(",");for(var b=0;b<e.length;b++){if($("#"+e[b]).length>0){$("#"+e[b]).css("display","block")}}}}$("#couponNum").html("-&yen;"+a);$("#couponPrice").show();$("#couponPrice").children("i").html("折扣码");var f=parseInt($("#prodNum").text())-parseInt(a)<0?0:parseInt($("#prodNum").text())-parseInt(a);$.ajax({type:"Get",url:"/trade/CheckFreight",data:{totalAmount:f,buyKey:$("#buyKey").val()},success:function(g){if(g.Result==0){$("#isShowFreight").show()}else{$("#isShowFreight").hide()}$("#payNum").val(f+parseInt(g.Result));payment()}});$("#couponCodeCancel").click(function(){if(d.SkuNos.length>0){var h=d.SkuNos.split(",");for(var g=0;g<h.length;g++){if($("#"+h[g]).length>0){$("#"+h[g]).css("display","none")}}}$("#couponsCodeTip").show();$("#formOrderConfirm_CashTicketFlag").val("");$("#formOrderConfirm_CashTicketNo").val("");$("#couponCodeData, .couponPrice").hide();$("#couponPrice").hide();$("#couponPrice").children("i").html("");$("#bank_ccb_hsy").show();$(".discount_menu, .explain_couponCode").show();$(".discount_content").removeAttr("style");var j=parseInt($("#prodNum").text());$.ajax({type:"Get",url:"/trade/CheckFreight",data:{totalAmount:j,buyKey:$("#buyKey").val()},datatype:"json",success:function(i){if(i.Result==0){$("#isShowFreight").show()}else{$("#isShowFreight").hide()}$("#payNum").val(j+parseInt(i.Result));payment()}});$(".alCart_coupon input").removeAttr("disabled");$("#couponCode_active").show();return false});return false};function payment(){var d=parseInt($("#payNum").val());var b=parseInt($("#giftCardNum").val());var c=0;var a=0;$(".totalNum").text(d);if($("input:radio[name=giftCard][checked]").val()=="1"){c=b;if(b>d){c=d}$("#giftPayment").html(c);$("#gifts_price").html(c);a=d-c;$(".actualAmount,#actualAmount").html(a);$("#amountPayment").html(a)}else{$("#giftPayment").html("0");$("#gifts_price").html("0");c=0;$(".actualAmount,#actualAmount").html(d);$("#amountPayment").html(d)}if(c!=0){$("#installment_payment").hide()}else{$("#installment_payment").find("dd span").each(function(){$(this).removeClass("curr")});if($("#amountPayment").html()<300){$("#installment_payment").hide()}else{$("#installment_payment").show()}}};